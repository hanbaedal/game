<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ν¬μΈνΈ μ¶©μ „</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        console.warn = function() {};
        console.error = function() {};
    </script>
</head>
<body class="bg-gray-900 text-white flex flex-col min-h-screen">
    <!-- μƒλ‹¨ λ„¤λΉ„κ²μ΄μ… -->
    <nav class="fixed top-0 left-0 right-0 bg-gray-800 p-4 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <h1 class="text-xl font-bold">ν¬μΈνΈ μ¶©μ „</h1>
                <span id="userNameDisplay" class="text-gray-300">λ΅λ”© μ¤‘...</span>
            </div>
            <div class="flex items-center space-x-4">
                <span id="currentPoints" class="text-yellow-400 font-bold">0P</span>
                <button id="homeButton" onclick="window.location.href='index.html'" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg">
                    <i class="fas fa-home mr-2"></i>ν™μΌλ΅
                </button>
                <button id="loginButton" onclick="window.location.href='login.html'" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg">
                    <i class="fas fa-sign-in-alt mr-2"></i>λ΅κ·ΈμΈ
                </button>
            </div>
        </div>
    </nav>

    <!-- λ©”μΈ μ»¨ν…μΈ  -->
    <div class="w-full px-2 py-2 flex-1 overflow-y-auto pt-20 pb-20">


        <!-- λΉ λλ‚μΈ μ†κ° λ™μμƒ -->
        <div class="grid grid-cols-1 gap-2 mb-2">
            <div id="videoOption" class="bg-gradient-to-br from-sky-400 to-sky-500 rounded-lg p-3 text-center cursor-pointer hover:from-sky-500 hover:to-sky-600 transition-all duration-300">
                <div class="mb-2">
                    <img src="/img/mascot.png" alt="λΉ λλ‚μΈ λ§μ¤μ½”νΈ" class="w-14 h-14 mx-auto rounded-full border-2 border-white shadow-lg">
                </div>
                <h3 class="text-base font-bold mb-1 text-white">λΉ λλ‚μΈ μ†κ° λ™μμƒ</h3>
                <p class="text-lg font-bold text-yellow-300 mb-1">1,000P</p>
                <p class="text-xs text-gray-200">ν΄λ¦­ν•μ—¬ μ‹μ²­</p>
            </div>
            <div id="videoOption2" class="bg-gradient-to-br from-green-400 to-green-500 rounded-lg p-3 text-center cursor-pointer hover:from-green-500 hover:to-green-600 transition-all duration-300">
                <div class="mb-2">
                    <img src="/img/mascot.png" alt="λΉ λλ‚μΈ λ§μ¤μ½”νΈ" class="w-14 h-14 mx-auto rounded-full border-2 border-white shadow-lg">
                </div>
                <h3 class="text-base font-bold mb-1 text-white">λΉ λλ‚μΈ μ†κ° λ™μμƒ</h3>
                <p class="text-lg font-bold text-yellow-300 mb-1">1,000P</p>
                <p class="text-xs text-gray-200">ν΄λ¦­ν•μ—¬ μ‹μ²­</p>
            </div>
            <div id="videoOption3" class="bg-gradient-to-br from-yellow-600 to-yellow-700 rounded-lg p-3 text-center cursor-pointer hover:from-yellow-700 hover:to-yellow-800 transition-all duration-300">
                <div class="mb-2">
                    <img src="/img/mascot.png" alt="λΉ λλ‚μΈ λ§μ¤μ½”νΈ" class="w-14 h-14 mx-auto rounded-full border-2 border-white shadow-lg">
                </div>
                <h3 class="text-base font-bold mb-1 text-white">λΉ λλ‚μΈ μ†κ° λ™μμƒ</h3>
                <p class="text-lg font-bold text-yellow-300 mb-1">1,000P</p>
                <p class="text-xs text-gray-200">ν΄λ¦­ν•μ—¬ μ‹μ²­</p>
            </div>
        </div>




    </div>

    <!-- ν•λ‹¨ λ„¤λΉ„κ²μ΄μ… -->
    <nav class="fixed bottom-0 left-0 right-0 bg-black text-white py-3 border-t border-gray-700 z-50">
        <div class="flex justify-evenly">
            <div class="text-center cursor-pointer" onclick="location.href='invite.html'">
                <i class="fas fa-user-plus text-2xl"></i>
                <p class="text-[0.4rem]">μ΄λ€</p>
            </div>
            <div class="text-center cursor-pointer" onclick="location.href='attendance.html'">
                <i class="fas fa-calendar-alt text-2xl"></i>
                <p class="text-[0.4rem]">μ¶μ„λ¶€</p>
            </div>
                        <div class="text-center cursor-pointer" onclick="location.href='board.html'">
                <i class="fas fa-clipboard text-2xl"></i>
                <p class="text-[0.4rem]">κ²μ‹ν</p>
            </div>
            <div class="text-center cursor-pointer" onclick="location.href='charge.html'">
                <i class="fas fa-coins text-2xl"></i>
                <p class="text-[0.4rem]">ν¬μΈνΈμ¶©μ „</p>
            </div>
        </div>
    </nav>

    <!-- λ™μμƒ λ¨λ‹¬ -->
    <div id="videoModal" class="fixed inset-0 bg-black bg-opacity-90 hidden items-center justify-center z-50">
        <div class="w-full h-full flex flex-col">
            <!-- μƒλ‹¨ λ‹«κΈ° λ²„νΌ -->
            <div class="flex justify-end p-4">
                <button onclick="closeVideoModal()" class="text-white hover:text-gray-300 text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- λ™μμƒ ν”λ μ΄μ–΄ -->
            <div class="flex-1 flex items-center justify-center p-4">
                <video id="mascotVideo" class="w-full max-w-4xl rounded-lg" controls>
                    <source src="/img/mascot.mp4" type="video/mp4">
                    λΈλΌμ°μ €κ°€ λ™μμƒμ„ μ§€μ›ν•μ§€ μ•μµλ‹λ‹¤.
                </video>
            </div>
            
            <!-- ν•λ‹¨ μ•λ‚΄ -->
            <div class="text-center p-4 text-white">
                <p class="text-base mb-2">λ™μμƒ μ‹μ²­ μ™„λ£ μ‹ 1,000ν¬μΈνΈκ°€ μ§€κΈ‰λ©λ‹λ‹¤</p>
                <p class="text-sm text-gray-300">λ™μμƒμ„ λκΉμ§€ μ‹μ²­ν•΄μ£Όμ„Έμ”</p>
            </div>
        </div>


    <!-- 500ν¬μΈνΈ μ΄κ³Ό κ²½κ³  λ¨λ‹¬ -->
    <div id="warningModal" class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center z-50">
        <div class="bg-red-800 rounded-lg p-6 max-w-md w-full mx-4 text-center">
            <div class="text-4xl mb-4">
                <i class="fas fa-exclamation-triangle text-yellow-400"></i>
            </div>
            <h3 class="text-xl font-bold mb-4 text-white">ν¬μΈνΈ μ¶©μ „ μ ν•</h3>
            <p class="text-gray-200 mb-6">
                ν„μ¬ λ³΄μ  ν¬μΈνΈκ°€ 500μ„ μ΄κ³Όν•μ—¬<br>
                ν¬μΈνΈ μ¶©μ „μ΄ μ ν•λ©λ‹λ‹¤.
            </p>
            <div class="text-sm text-gray-300">
                <p>5μ΄ ν›„ λ©”μΈ νμ΄μ§€λ΅ μ΄λ™ν•©λ‹λ‹¤...</p>
                <p id="countdownText" class="text-yellow-400 font-bold text-lg mt-2">5</p>
            </div>
        </div>
    </div>

    <!-- λ™μμƒ μ‹μ²­ μ™„λ£ λ¨λ‹¬ -->
    <div id="completionModal" class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center z-50">
        <div class="bg-green-800 rounded-lg p-6 max-w-md w-full mx-4 text-center">
            <div class="text-4xl mb-4">
                <i class="fas fa-check-circle text-green-400"></i>
            </div>
            <h3 class="text-xl font-bold mb-4 text-white">λ™μμƒ μ‹μ²­ μ™„λ£!</h3>
            <p class="text-gray-200 mb-4" id="completionMessage">
                λΉ λλ‚μΈ μ†κ° λ™μμƒ μ‹μ²­μ΄ μ™„λ£λμ—μµλ‹λ‹¤.
            </p>
            <p class="text-yellow-400 font-bold text-lg mb-6" id="pointsMessage">
                1,000ν¬μΈνΈκ°€ μ§€κΈ‰λμ—μµλ‹λ‹¤.
            </p>
            <button onclick="closeCompletionModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-bold">
                ν™•μΈ
            </button>
        </div>
    </div>

    <script>
        let currentUser = null;
        let speechQueue = [];
        let isSpeaking = false;

        // νμ΄μ§€ λ΅λ“ μ‹ μ‹¤ν–‰
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const storedUser = localStorage.getItem('currentUser');
                if (storedUser) {
                    currentUser = JSON.parse(storedUser);
                    
                    // userIdκ°€ μ—†λ” κ²½μ° κΈ°λ³Έκ°’ μ„¤μ •
                    if (!currentUser.userId) {
                        currentUser.userId = currentUser.name || 'guest_' + Date.now();
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    }
                    
                    console.log('π” λ΅λ“λ μ‚¬μ©μ μ •λ³΄:', currentUser);
                    
                    // μ‚¬μ©μ μ •λ³΄ ν‘μ‹
                    document.getElementById('userNameDisplay').textContent = `${currentUser.name}λ‹`;
                    document.getElementById('currentPoints').textContent = `${currentUser.points}P`;
                    document.getElementById('loginButton').style.display = 'none';
                    document.getElementById('homeButton').style.display = 'block';

                    // 500ν¬μΈνΈ μ΄κ³Ό μ²΄ν¬
                    if (currentUser.points > 500) {
                        showWarningModal();
                        return;
                    }

                    // λ™μμƒ λ²„νΌ ν™μ„±ν™”
                    enableVideoButton();
                } else {
                    // λ΅κ·ΈμΈν•μ§€ μ•μ€ μ‚¬μ©μ
                    document.getElementById('userNameDisplay').textContent = 'κ²μ¤νΈ μ‚¬μ©μ';
                    document.getElementById('currentPoints').textContent = '0P';
                    document.getElementById('loginButton').style.display = 'block';
                    document.getElementById('homeButton').style.display = 'none';
                    
                    // λ™μμƒ λ²„νΌ λΉ„ν™μ„±ν™”
                    disableVideoButton();
                }
            } catch (error) {
                console.error('μ‚¬μ©μ μ •λ³΄ λ΅λ“ μ‹¤ν¨:', error);
                disableVideoButton();
            }
        });

        // λ™μμƒ λ²„νΌ ν™μ„±ν™”
        function enableVideoButton() {
            document.getElementById('videoOption').onclick = () => watchVideo();
            document.getElementById('videoOption2').onclick = () => watchVideo2();
            document.getElementById('videoOption3').onclick = () => watchVideo3();
        }

        // λ™μμƒ λ²„νΌ λΉ„ν™μ„±ν™”
        function disableVideoButton() {
            const videoButton = document.getElementById('videoOption');
            const videoButton2 = document.getElementById('videoOption2');
            const videoButton3 = document.getElementById('videoOption3');
            
            videoButton.onclick = null;
            videoButton2.onclick = null;
            videoButton3.onclick = null;
            
            videoButton.classList.add('opacity-50', 'cursor-not-allowed');
            videoButton2.classList.add('opacity-50', 'cursor-not-allowed');
            videoButton3.classList.add('opacity-50', 'cursor-not-allowed');
            videoButton.classList.remove('cursor-pointer');
            videoButton2.classList.remove('cursor-pointer');
            videoButton3.classList.remove('cursor-pointer');
        }



        // λ™μμƒ μ‹μ²­ (μ²« λ²μ§Έ λ©”λ‰΄)
        async function watchVideo() {
            if (!currentUser) {
                alert('λ΅κ·ΈμΈ ν›„ λ™μμƒμ„ μ‹μ²­ν•΄μ£Όμ„Έμ”.');
                window.location.href = 'login.html';
                return;
            }

            // 500ν¬μΈνΈ μ΄κ³Ό μ²΄ν¬
            if (currentUser.points > 500) {
                alert('ν¬μΈνΈκ°€ 500μ„ μ΄κ³Όν•μ—¬ λ™μμƒ μ‹μ²­μ΄ μ ν•λ©λ‹λ‹¤.');
                return;
            }

            // λ©”λ‰΄ λΉ„ν™μ„±ν™”
            const videoButton = document.getElementById('videoOption');
            videoButton.onclick = null;
            videoButton.classList.add('opacity-50', 'cursor-not-allowed');
            videoButton.classList.remove('cursor-pointer');

            // λ™μμƒ λ¨λ‹¬ ν‘μ‹
            const modal = document.getElementById('videoModal');
            const video = document.getElementById('mascotVideo');
            
            modal.style.display = 'flex';
            video.currentTime = 0;
            video.play();

            // λ™μμƒ μ™„λ£ μ΄λ²¤νΈ λ¦¬μ¤λ„
            let completed = false;
            video.onended = async function() {
                if (completed) return;
                completed = true;
                
                modal.style.display = 'none';
                video.pause();

                // ν¬μΈνΈ μ§€κΈ‰ μ²λ¦¬
                try {
                    const points = 1000;
                    const response = await fetch('/api/update-points', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            userId: currentUser.userId, 
                            addPoints: points
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            currentUser.points = data.points;
                            localStorage.setItem('currentUser', JSON.stringify(currentUser));
                            document.getElementById('currentPoints').textContent = `${currentUser.points}P`;
                            
                            speakText(`λ™μμƒ μ‹μ²­μ΄ μ™„λ£λμ—μµλ‹λ‹¤. ${points.toLocaleString()}ν¬μΈνΈκ°€ μ§€κΈ‰λμ—μµλ‹λ‹¤.`);
                            alert(`λ™μμƒ μ‹μ²­ μ™„λ£!\n${points.toLocaleString()}ν¬μΈνΈκ°€ μ§€κΈ‰λμ—μµλ‹λ‹¤.`);
                        } else {
                            alert('ν¬μΈνΈ μ§€κΈ‰μ— μ‹¤ν¨ν–μµλ‹λ‹¤. λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”.');
                        }
                    } else {
                        alert('μ„λ²„ μ—°κ²°μ— μ‹¤ν¨ν–μµλ‹λ‹¤. λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”.');
                    }
                } catch (error) {
                    console.error('ν¬μΈνΈ μ§€κΈ‰ μ¤λ¥:', error);
                    alert('ν¬μΈνΈ μ§€κΈ‰ μ¤‘ μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤. λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”.');
                }
            }
        }

        // λ™μμƒ μ‹μ²­ (λ‘ λ²μ§Έ λ©”λ‰΄)
        async function watchVideo2() {
            if (!currentUser) {
                alert('λ΅κ·ΈμΈ ν›„ λ™μμƒμ„ μ‹μ²­ν•΄μ£Όμ„Έμ”.');
                window.location.href = 'login.html';
                return;
            }

            // 500ν¬μΈνΈ μ΄κ³Ό μ²΄ν¬
            if (currentUser.points > 500) {
                alert('ν¬μΈνΈκ°€ 500μ„ μ΄κ³Όν•μ—¬ λ™μμƒ μ‹μ²­μ΄ μ ν•λ©λ‹λ‹¤.');
                return;
            }

            // λ©”λ‰΄ λΉ„ν™μ„±ν™”
            const videoButton = document.getElementById('videoOption2');
            videoButton.onclick = null;
            videoButton.classList.add('opacity-50', 'cursor-not-allowed');
            videoButton.classList.remove('cursor-pointer');

            // λ™μμƒ λ¨λ‹¬ ν‘μ‹
            const modal = document.getElementById('videoModal');
            const video = document.getElementById('mascotVideo');
            
            modal.style.display = 'flex';
            video.currentTime = 0;
            video.play();

            // λ™μμƒ μ™„λ£ μ΄λ²¤νΈ λ¦¬μ¤λ„
            let completed = false;
            video.onended = async function() {
                if (completed) return;
                completed = true;
                
                modal.style.display = 'none';
                video.pause();

                // ν¬μΈνΈ μ§€κΈ‰ μ²λ¦¬
                try {
                    const points = 1000;
                    const response = await fetch('/api/update-points', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            userId: currentUser.userId, 
                            addPoints: points
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            currentUser.points = data.points;
                            localStorage.setItem('currentUser', JSON.stringify(currentUser));
                            document.getElementById('currentPoints').textContent = `${currentUser.points}P`;
                            
                            speakText(`λ™μμƒ μ‹μ²­μ΄ μ™„λ£λμ—μµλ‹λ‹¤. ${points.toLocaleString()}ν¬μΈνΈκ°€ μ§€κΈ‰λμ—μµλ‹λ‹¤.`);
                            alert(`λ™μμƒ μ‹μ²­ μ™„λ£!\n${points.toLocaleString()}ν¬μΈνΈκ°€ μ§€κΈ‰λμ—μµλ‹λ‹¤.`);
                        } else {
                            alert('ν¬μΈνΈ μ§€κΈ‰μ— μ‹¤ν¨ν–μµλ‹λ‹¤. λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”.');
                        }
                    } else {
                        alert('μ„λ²„ μ—°κ²°μ— μ‹¤ν¨ν–μµλ‹λ‹¤. λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”.');
                    }
                } catch (error) {
                    console.error('ν¬μΈνΈ μ§€κΈ‰ μ¤λ¥:', error);
                    alert('ν¬μΈνΈ μ§€κΈ‰ μ¤‘ μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤. λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”.');
                }
            }
        }

        // λ™μμƒ μ‹μ²­ (μ„Έ λ²μ§Έ λ©”λ‰΄)
        async function watchVideo3() {
            if (!currentUser) {
                alert('λ΅κ·ΈμΈ ν›„ λ™μμƒμ„ μ‹μ²­ν•΄μ£Όμ„Έμ”.');
                window.location.href = 'login.html';
                return;
            }

            // 500ν¬μΈνΈ μ΄κ³Ό μ²΄ν¬
            if (currentUser.points > 500) {
                alert('ν¬μΈνΈκ°€ 500μ„ μ΄κ³Όν•μ—¬ λ™μμƒ μ‹μ²­μ΄ μ ν•λ©λ‹λ‹¤.');
                return;
            }

            // λ©”λ‰΄ λΉ„ν™μ„±ν™”
            const videoButton = document.getElementById('videoOption3');
            videoButton.onclick = null;
            videoButton.classList.add('opacity-50', 'cursor-not-allowed');
            videoButton.classList.remove('cursor-pointer');

            // λ™μμƒ λ¨λ‹¬ ν‘μ‹
            const modal = document.getElementById('videoModal');
            const video = document.getElementById('mascotVideo');
            
            modal.style.display = 'flex';
            video.currentTime = 0;
            video.play();

            // λ™μμƒ μ™„λ£ μ΄λ²¤νΈ λ¦¬μ¤λ„
            let completed = false;
            video.onended = async function() {
                if (completed) return;
                completed = true;
                
                modal.style.display = 'none';
                video.pause();

                // ν¬μΈνΈ μ§€κΈ‰ μ²λ¦¬
                try {
                    const points = 1000;
                    const response = await fetch('/api/update-points', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            userId: currentUser.userId, 
                            addPoints: points
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            currentUser.points = data.points;
                            localStorage.setItem('currentUser', JSON.stringify(currentUser));
                            document.getElementById('currentPoints').textContent = `${currentUser.points}P`;
                            
                            speakText(`λ™μμƒ μ‹μ²­μ΄ μ™„λ£λμ—μµλ‹λ‹¤. ${points.toLocaleString()}ν¬μΈνΈκ°€ μ§€κΈ‰λμ—μµλ‹λ‹¤.`);
                            alert(`λ™μμƒ μ‹μ²­ μ™„λ£!\n${points.toLocaleString()}ν¬μΈνΈκ°€ μ§€κΈ‰λμ—μµλ‹λ‹¤.`);
                        } else {
                            alert('ν¬μΈνΈ μ§€κΈ‰μ— μ‹¤ν¨ν–μµλ‹λ‹¤. λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”.');
                        }
                    } else {
                        alert('μ„λ²„ μ—°κ²°μ— μ‹¤ν¨ν–μµλ‹λ‹¤. λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”.');
                    }
                } catch (error) {
                    console.error('ν¬μΈνΈ μ§€κΈ‰ μ¤λ¥:', error);
                    alert('ν¬μΈνΈ μ§€κΈ‰ μ¤‘ μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤. λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”.');
                }
            }
        }

        // 500ν¬μΈνΈ μ΄κ³Ό κ²½κ³  λ¨λ‹¬ ν‘μ‹
        function showWarningModal() {
            const modal = document.getElementById('warningModal');
            modal.style.display = 'flex';
            
            let countdown = 5;
            const countdownElement = document.getElementById('countdownText');
            
            const timer = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(timer);
                    window.location.href = 'index.html';
                }
            }, 1000);
        }

        // μμ„± ν μ²λ¦¬ ν•¨μ
        function processSpeechQueue() {
            if (speechQueue.length === 0 || isSpeaking) {
                return;
            }
            isSpeaking = true;
            const { text, rate, pitch } = speechQueue.shift();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ko-KR';
            utterance.rate = rate || 0.9;
            utterance.pitch = pitch || 1.1;
            utterance.volume = 0.9;
            utterance.onstart = () => { console.log('π¤ μμ„± μ¬μƒ μ‹μ‘:', text); };
            utterance.onend = () => {
                console.log('π¤ μμ„± μ¬μƒ μ™„λ£:', text);
                isSpeaking = false;
                setTimeout(() => processSpeechQueue(), 100);
            };
            utterance.onerror = (event) => {
                console.log('π¤ μμ„± μ¬μƒ μ¤λ¥:', event.error);
                isSpeaking = false;
                setTimeout(() => processSpeechQueue(), 100);
            };
            speechSynthesis.speak(utterance);
            console.log('π¤ μμ„± μ¬μƒ μ”μ²­ μ™„λ£:', text);
        }

        // μμ„± μ¬μƒ ν•¨μ
        function speakText(text, rate = 0.9) {
            console.log('π¤ μμ„± μ¬μƒ μ‹λ„:', text);
            if ('speechSynthesis' in window) {
                speechQueue.push({ text, rate, pitch: 1.1 });
                console.log('π¤ μμ„± νμ— μ¶”κ°€λ¨:', text);
                processSpeechQueue();
            } else {
                console.log('π¤ μμ„± ν•©μ„± APIλ¥Ό μ§€μ›ν•μ§€ μ•μµλ‹λ‹¤.');
            }
        }

        // λ™μμƒ μ‹μ²­ (μ²« λ²μ§Έ λ©”λ‰΄)
        async function watchVideo() {
            if (!currentUser) {
                alert('λ΅κ·ΈμΈ ν›„ λ™μμƒμ„ μ‹μ²­ν•΄μ£Όμ„Έμ”.');
                window.location.href = 'login.html';
                return;
            }

            // 500ν¬μΈνΈ μ΄κ³Ό μ²΄ν¬
            if (currentUser.points > 500) {
                alert('ν¬μΈνΈκ°€ 500μ„ μ΄κ³Όν•μ—¬ λ™μμƒ μ‹μ²­μ΄ μ ν•λ©λ‹λ‹¤.');
                return;
            }

            // λ™μμƒ λ¨λ‹¬ ν‘μ‹
            const modal = document.getElementById('videoModal');
            const video = document.getElementById('mascotVideo');
            
            modal.style.display = 'flex';
            video.currentTime = 0; // λ™μμƒ μ²μλ¶€ν„° μ¬μƒ
            video.play();

            // λ™μμƒ μ™„λ£ μ΄λ²¤νΈ λ¦¬μ¤λ„
            let completed = false;
            video.onended = async function() {
                if (completed) return;
                completed = true;
                
                modal.style.display = 'none';
                video.pause();

                // ν¬μΈνΈ μ¶©μ „ μ²λ¦¬
                try {
                    const points = 1000;
                    console.log('π” ν„μ¬ μ‚¬μ©μ μ •λ³΄:', currentUser);
                    
                    const response = await fetch('/api/charge', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            userId: currentUser.userId,
                            userName: currentUser.name,
                            amount: points,
                            paymentMethod: 'video_ad',
                            videoType: 'advertisement',
                            videoTitle: 'λΉ λλ‚μΈ μ†κ° λ™μμƒ',
                            videoDuration: 30
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            // μ„λ²„ μ—…λ°μ΄νΈ μ„±κ³µ
                            currentUser.points = data.data.totalPoints;
                            localStorage.setItem('currentUser', JSON.stringify(currentUser));
                            document.getElementById('currentPoints').textContent = `${currentUser.points}P`;
                            
                            // λ™μμƒ μ‹μ²­ μ™„λ£ μμ„±
                            speakText(`λΉ λλ‚μΈ μ†κ° λ™μμƒ μ‹μ²­μ΄ μ™„λ£λμ—μµλ‹λ‹¤. ${points.toLocaleString()}ν¬μΈνΈκ°€ μ§€κΈ‰λμ—μµλ‹λ‹¤.`);
                            
                            // μ™„λ£ λ¨λ‹¬ ν‘μ‹
                            showCompletionModal(points.toLocaleString());
                            
                            // ν¬μΈνΈ μ¶©μ „ ν›„μ—λ” κ²½κ³  λ¨λ‹¬ λ€μ‹  μ„±κ³µ λ©”μ‹μ§€λ§ ν‘μ‹
                            if (currentUser.points > 500) {
                                console.log('β… ν¬μΈνΈ μ¶©μ „ μ™„λ£ - 500ν¬μΈνΈ μ΄κ³Όλ΅ λ” μ΄μƒ μ¶©μ „ λ¶κ°€');
                            }
                        } else {
                            showErrorModal('ν¬μΈνΈ μ¶©μ „μ— μ‹¤ν¨ν–μµλ‹λ‹¤. λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”.');
                        }
                    } else {
                        showErrorModal('μ„λ²„ μ—°κ²°μ— μ‹¤ν¨ν–μµλ‹λ‹¤. λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”.');
                    }
                } catch (error) {
                    console.error('ν¬μΈνΈ μ¶©μ „ μ¤λ¥:', error);
                    showErrorModal('ν¬μΈνΈ μ¶©μ „ μ¤‘ μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤. λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”.');
                }
            }
        }

        // λ™μμƒ μ‹μ²­ (λ‘ λ²μ§Έ λ©”λ‰΄)
        async function watchVideo2() {
            if (!currentUser) {
                alert('λ΅κ·ΈμΈ ν›„ λ™μμƒμ„ μ‹μ²­ν•΄μ£Όμ„Έμ”.');
                window.location.href = 'login.html';
                return;
            }

            // 500ν¬μΈνΈ μ΄κ³Ό μ²΄ν¬
            if (currentUser.points > 500) {
                alert('ν¬μΈνΈκ°€ 500μ„ μ΄κ³Όν•μ—¬ λ™μμƒ μ‹μ²­μ΄ μ ν•λ©λ‹λ‹¤.');
                return;
            }

            // λ™μμƒ λ¨λ‹¬ ν‘μ‹
            const modal = document.getElementById('videoModal');
            const video = document.getElementById('mascotVideo');
            
            modal.style.display = 'flex';
            video.currentTime = 0; // λ™μμƒ μ²μλ¶€ν„° μ¬μƒ
            video.play();

            // λ™μμƒ μ™„λ£ μ΄λ²¤νΈ λ¦¬μ¤λ„
            let completed = false;
            video.onended = async function() {
                if (completed) return;
                completed = true;
                
                modal.style.display = 'none';
                video.pause();

                // ν¬μΈνΈ μ§€κΈ‰ μ²λ¦¬
                try {
                    const points = 1000;
                    console.log('π” ν„μ¬ μ‚¬μ©μ μ •λ³΄:', currentUser);
                    console.log('π” μ „μ†΅ν•  λ°μ΄ν„°:', { userId: currentUser.userId, addPoints: points });
                    
                    const response = await fetch('/api/update-points', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            userId: currentUser.userId, 
                            addPoints: points
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            // μ„λ²„ μ—…λ°μ΄νΈ μ„±κ³µ
                            currentUser.points = data.points;
                            localStorage.setItem('currentUser', JSON.stringify(currentUser));
                            document.getElementById('currentPoints').textContent = `${currentUser.points}P`;
                            
                            // λ™μμƒ μ‹μ²­ μ™„λ£ μμ„±
                            speakText(`λΉ λλ‚μΈ μ†κ° λ™μμƒ μ‹μ²­μ΄ μ™„λ£λμ—μµλ‹λ‹¤. ${points.toLocaleString()}ν¬μΈνΈκ°€ μ§€κΈ‰λμ—μµλ‹λ‹¤.`);
                            alert(`λ™μμƒ μ‹μ²­ μ™„λ£!\n${points.toLocaleString()}ν¬μΈνΈκ°€ μ§€κΈ‰λμ—μµλ‹λ‹¤.`);
                            
                            // ν¬μΈνΈ μ¶©μ „ ν›„μ—λ” κ²½κ³  λ¨λ‹¬ λ€μ‹  μ„±κ³µ λ©”μ‹μ§€λ§ ν‘μ‹
                            if (currentUser.points > 500) {
                                console.log('β… ν¬μΈνΈ μ¶©μ „ μ™„λ£ - 500ν¬μΈνΈ μ΄κ³Όλ΅ λ” μ΄μƒ μ¶©μ „ λ¶κ°€');
                            }
                        } else {
                            alert('ν¬μΈνΈ μ§€κΈ‰μ— μ‹¤ν¨ν–μµλ‹λ‹¤. λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”.');
                        }
                    } else {
                        alert('μ„λ²„ μ—°κ²°μ— μ‹¤ν¨ν–μµλ‹λ‹¤. λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”.');
                    }
                } catch (error) {
                    console.error('ν¬μΈνΈ μ§€κΈ‰ μ¤λ¥:', error);
                    alert('ν¬μΈνΈ μ§€κΈ‰ μ¤‘ μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤. λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”.');
                }
            }
        }

        // λ™μμƒ μ‹μ²­ (μ„Έ λ²μ§Έ λ©”λ‰΄)
        async function watchVideo3() {
            if (!currentUser) {
                alert('λ΅κ·ΈμΈ ν›„ λ™μμƒμ„ μ‹μ²­ν•΄μ£Όμ„Έμ”.');
                window.location.href = 'login.html';
                return;
            }

            // 500ν¬μΈνΈ μ΄κ³Ό μ²΄ν¬
            if (currentUser.points > 500) {
                alert('ν¬μΈνΈκ°€ 500μ„ μ΄κ³Όν•μ—¬ λ™μμƒ μ‹μ²­μ΄ μ ν•λ©λ‹λ‹¤.');
                return;
            }

            // λ™μμƒ λ¨λ‹¬ ν‘μ‹
            const modal = document.getElementById('videoModal');
            const video = document.getElementById('mascotVideo');
            
            modal.style.display = 'flex';
            video.currentTime = 0; // λ™μμƒ μ²μλ¶€ν„° μ¬μƒ
            video.play();

            // λ™μμƒ μ™„λ£ μ΄λ²¤νΈ λ¦¬μ¤λ„
            let completed = false;
            video.onended = async function() {
                if (completed) return;
                completed = true;
                
                modal.style.display = 'none';
                video.pause();

                // ν¬μΈνΈ μ§€κΈ‰ μ²λ¦¬
                try {
                    const points = 1000;
                    console.log('π” ν„μ¬ μ‚¬μ©μ μ •λ³΄:', currentUser);
                    console.log('π” μ „μ†΅ν•  λ°μ΄ν„°:', { userId: currentUser.userId, addPoints: points });
                    
                    const response = await fetch('/api/update-points', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            userId: currentUser.userId, 
                            addPoints: points
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            // μ„λ²„ μ—…λ°μ΄νΈ μ„±κ³µ
                            currentUser.points = data.points;
                            localStorage.setItem('currentUser', JSON.stringify(currentUser));
                            document.getElementById('currentPoints').textContent = `${currentUser.points}P`;
                            
                            // λ™μμƒ μ‹μ²­ μ™„λ£ μμ„±
                            speakText(`λΉ λλ‚μΈ μ†κ° λ™μμƒ μ‹μ²­μ΄ μ™„λ£λμ—μµλ‹λ‹¤. ${points.toLocaleString()}ν¬μΈνΈκ°€ μ§€κΈ‰λμ—μµλ‹λ‹¤.`);
                            alert(`λ™μμƒ μ‹μ²­ μ™„λ£!\n${points.toLocaleString()}ν¬μΈνΈκ°€ μ§€κΈ‰λμ—μµλ‹λ‹¤.`);
                            
                            // ν¬μΈνΈ μ¶©μ „ ν›„μ—λ” κ²½κ³  λ¨λ‹¬ λ€μ‹  μ„±κ³µ λ©”μ‹μ§€λ§ ν‘μ‹
                            if (currentUser.points > 500) {
                                console.log('β… ν¬μΈνΈ μ¶©μ „ μ™„λ£ - 500ν¬μΈνΈ μ΄κ³Όλ΅ λ” μ΄μƒ μ¶©μ „ λ¶κ°€');
                            }
                        } else {
                            alert('ν¬μΈνΈ μ§€κΈ‰μ— μ‹¤ν¨ν–μµλ‹λ‹¤. λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”.');
                        }
                    } else {
                        alert('μ„λ²„ μ—°κ²°μ— μ‹¤ν¨ν–μµλ‹λ‹¤. λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”.');
                    }
                } catch (error) {
                    console.error('ν¬μΈνΈ μ§€κΈ‰ μ¤λ¥:', error);
                    alert('ν¬μΈνΈ μ§€κΈ‰ μ¤‘ μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤. λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”.');
                }
            }
        }

        // λ™μμƒ λ¨λ‹¬ λ‹«κΈ°
        function closeVideoModal() {
            const modal = document.getElementById('videoModal');
            const video = document.getElementById('mascotVideo');
            
            modal.style.display = 'none';
            video.pause();
            video.currentTime = 0;
        }

        // μ™„λ£ λ¨λ‹¬ ν‘μ‹
        function showCompletionModal(points) {
            const modal = document.getElementById('completionModal');
            const pointsMessage = document.getElementById('pointsMessage');
            
            pointsMessage.textContent = `${points}ν¬μΈνΈκ°€ μ§€κΈ‰λμ—μµλ‹λ‹¤.`;
            modal.style.display = 'flex';
        }

        // μ™„λ£ λ¨λ‹¬ λ‹«κΈ°
        function closeCompletionModal() {
            const modal = document.getElementById('completionModal');
            modal.style.display = 'none';
        }

        // μ—λ¬ λ¨λ‹¬ ν‘μ‹
        function showErrorModal(message) {
            alert(message); // μ„μ‹λ΅ alert μ‚¬μ© (μ—λ¬ λ¨λ‹¬μ€ λ‚μ¤‘μ— μ¶”κ°€ κ°€λ¥)
        }

        // μμ„± ν•©μ„± ν•¨μ
        function speakText(text, rate = 0.9) {
            if ('speechSynthesis' in window) {
                // μ΄μ „ μμ„± μ¤‘μ§€
                speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'ko-KR';
                utterance.rate = rate;
                utterance.pitch = 1.1;
                utterance.volume = 0.9;
                
                // μμ„± μ™„λ£ μ΄λ²¤νΈ
                utterance.onend = () => {
                    console.log('π¤ μμ„± μ¬μƒ μ™„λ£:', text);
                };
                
                utterance.onerror = (event) => {
                    console.log('π¤ μμ„± μ¬μƒ μ¤λ¥:', event.error);
                };
                
                speechSynthesis.speak(utterance);
            }
        }
    </script>
</body>
</html> 
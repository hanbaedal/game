<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°°íŒ… í˜ì´ì§€</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio"></script>
    <script>
        // Tailwind CSS CDN ê²½ê³  ìˆ¨ê¸°ê¸°
        console.warn = function() {};
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body class="bg-black text-white flex flex-col min-h-screen">

    <!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
    <header class="fixed top-0 left-0 right-0 bg-black text-white flex justify-between items-center px-6 py-4 border-b border-gray-700 z-50">
        <div class="flex items-center space-x-3">
            <a href="https://ppadun9-home.netlify.app/" class="cursor-pointer" target="_blank">
                <img src="/img/logo.png" width="40" height="8" alt="PPADUN ë¡œê³ ">
            </a>
            <span id="userNameDisplay" class="text-xs font-bold text-blue-200"></span>
        </div>
        <div class="flex space-x-6">
            <div id="loginButton" class="text-center cursor-pointer" onclick="location.href='/login.html'" style="display: block;">
                <i class="fas fa-sign-in-alt text-2xl"></i>
                <p class="text-sm mt-1">ë¡œê·¸ì¸</p>
            </div>
            <div id="logoutButton" class="text-center cursor-pointer" onclick="logout()" style="display: none;">
                <i class="fas fa-sign-out-alt text-2xl"></i>
                <p class="text-[0.4rem] mt-1">ë¡œê·¸ì•„ì›ƒ</p>
            </div>
            <div class="text-center cursor-pointer" onclick="location.href='settings.html'">
                <i class="fas fa-cog text-2xl"></i>
                <p class="text-[0.4rem] mt-1">ì„¤ì •</p>
            </div>

        </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <main class="p-4 flex-1 overflow-y-auto pt-20 pb-16">
        <div class="bg-gray-800 max-w-lg mx-auto p-6 rounded-lg">
            <p class="text-right text-gray-300 mb-4" id="currentDate"></p>

            <!-- ë°°íŒ… í¼ -->
            <div class="space-y-4">
                <div class="flex items-center space-x-3">
                    <img src="/img/mascot.png" width="50" height="50" alt="ê²½ê¸° ì´ë¯¸ì§€" class="rounded-full shadow-lg border border-gray-300 transform hover:scale-105 transition-all duration-200" style="filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));">
                    <div class="flex-1">
                        <p class="text-sm">ê²½ê¸°ì„ íƒ</p>
                        <div id="gameSelectionContainer" class="flex overflow-x-auto space-x-2 bg-gray-800 rounded p-2 border border-gray-600">
                            <!-- ê²½ê¸° ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
                        </div>

                    </div>
                </div>

                <!-- ê²Œì„ì„ íƒ + ë°°íŒ…í¬ì¸íŠ¸ í•œ ì¤„ ë°°ì¹˜ -->
                <div class="flex items-center space-x-6 mb-4">
                    <!-- ê²Œì„ì„ íƒ(íƒ€ì) -->
                <div class="flex items-center space-x-3">
                    <div style="width: 50px; height: 30px;"></div>
                    <div class="flex-1">
                        <p class="text-sm">ê²Œì„ì„ íƒ</p>
                            <div class="grid grid-cols-1 gap-1 mt-1">
                            <button id="batterBtn" class="game-type-btn bg-yellow-500 hover:bg-yellow-600 text-black text-xs py-1 px-3 rounded active" data-type="batter" onclick="selectGameType(this)">
                                íƒ€ì
                            </button>
                            </div>
                        </div>
                    </div>
                    <!-- ë°°íŒ…í¬ì¸íŠ¸(ì œëª©+100) -->
                    <div class="flex items-center space-x-3">
                        <div style="width: 50px; height: 30px;"></div>
                        <div class="flex-1">
                            <p class="text-sm">ë°°íŒ…í¬ì¸íŠ¸</p>
                            <div class="grid grid-cols-1 gap-1 mt-1">
                                <button class="bet-amount-btn bg-yellow-500 text-black text-xs py-1 px-1 rounded" data-amount="100" disabled>
                                    100 (ê³ ì •)
                            </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex items-start space-x-3">
                    <img src="/img/mascot.png" width="50" height="50" alt="ë°°íŒ… ì´ë¯¸ì§€" class="rounded-full shadow-lg border border-gray-300 transform hover:scale-105 transition-all duration-200" style="filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3)); margin-top: 20px;">
                    <div class="flex-1">
                        <p class="text-sm">ë°°íŒ…ì„ íƒ</p>
                        <div id="bettingSection" class="space-y-2 mt-2">
                            <!-- ë°°íŒ… ì„ íƒ ëª¨ë‹¬ ë°”ë¡œ í‘œì‹œ -->
                            <div id="bettingOptionsContainer" class="space-y-2" style="display: none;">
                                <button class="bet-choice-btn w-full p-3 bg-gray-700 rounded cursor-pointer hover:bg-gray-600 transition-colors text-left" onclick="selectBetChoiceFromModal('1ë£¨')">
                                    <div class="flex items-center">
                                        <div class="w-4 h-4 rounded-full bg-pink-300 mr-3"></div>
                                        <div class="flex-1">
                                            <div class="font-bold text-pink-300">1ë£¨</div>
                                            <div class="text-xs text-gray-400">ì•ˆíƒ€</div>
                                        </div>
                                    </div>
                                </button>
                                <button class="bet-choice-btn w-full p-3 bg-gray-700 rounded cursor-pointer hover:bg-gray-600 transition-colors text-left" onclick="selectBetChoiceFromModal('2ë£¨')">
                                    <div class="flex items-center">
                                        <div class="w-4 h-4 rounded-full bg-orange-300 mr-3"></div>
                                        <div class="flex-1">
                                            <div class="font-bold text-orange-300">2ë£¨</div>
                                            <div class="text-xs text-gray-400">2ë£¨íƒ€</div>
                                        </div>
                                    </div>
                                </button>
                                <button class="bet-choice-btn w-full p-3 bg-gray-700 rounded cursor-pointer hover:bg-gray-600 transition-colors text-left" onclick="selectBetChoiceFromModal('3ë£¨')">
                                    <div class="flex items-center">
                                        <div class="w-4 h-4 rounded-full bg-yellow-300 mr-3"></div>
                                        <div class="flex-1">
                                            <div class="font-bold text-yellow-300">3ë£¨</div>
                                            <div class="text-xs text-gray-400">3ë£¨íƒ€</div>
                                        </div>
                                    </div>
                                </button>
                                <button class="bet-choice-btn w-full p-3 bg-gray-700 rounded cursor-pointer hover:bg-gray-600 transition-colors text-left" onclick="selectBetChoiceFromModal('í™ˆëŸ°')">
                                    <div class="flex items-center">
                                        <div class="w-4 h-4 rounded-full bg-green-300 mr-3"></div>
                                        <div class="flex-1">
                                            <div class="font-bold text-green-300">í™ˆëŸ°</div>
                                            <div class="text-xs text-gray-400">í™ˆëŸ°</div>
                                        </div>
                                    </div>
                                </button>
                                <button class="bet-choice-btn w-full p-3 bg-gray-700 rounded cursor-pointer hover:bg-gray-600 transition-colors text-left" onclick="selectBetChoiceFromModal('ì•„ì›ƒ')">
                                    <div class="flex items-center">
                                        <div class="w-4 h-4 rounded-full bg-purple-300 mr-3"></div>
                                        <div class="flex-1">
                                            <div class="font-bold text-purple-300">ì•„ì›ƒ</div>
                                            <div class="text-xs text-gray-400">ì•„ì›ƒ</div>
                                        </div>
                                    </div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <p class="mt-4 text-sm">ë³´ìœ  í¬ì¸íŠ¸ : <span id="userPoints" class="font-bold">0í¬ì¸íŠ¸</span> 
                    <span id="afterBettingPoints" class="text-yellow-400 ml-2" style="display: none;">
                        â†’ <span class="font-bold">0í¬ì¸íŠ¸</span>
                    </span>
                </p>

                <!-- ë°°íŒ… ìƒíƒœ í‘œì‹œ -->
                <div id="bettingStatusDisplay" class="mt-4 p-3 rounded-lg" style="display: none;">
                    <div class="flex items-center space-x-3">
                        <div id="bettingStatusIndicator" class="w-4 h-4 rounded-full"></div>
                        <span id="bettingStatusText" class="font-bold text-sm"></span>
                    </div>
                </div>



                <!-- ë°°íŒ… ê²°ê³¼ í‘œì‹œ -->
                <div id="bettingResultDisplay" class="mt-4 p-3 rounded-lg" style="display: none;">
                    <h4 class="font-bold mb-2">ë°°íŒ… ê²°ê³¼</h4>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-gray-300">ì‹¤ì œ ê²°ê³¼:</span>
                            <span id="actualResult" class="font-bold"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-300">ë‚´ ì˜ˆì¸¡:</span>
                            <span id="myPrediction" class="font-bold"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-300">ê²°ê³¼:</span>
                            <span id="bettingResult" class="font-bold"></span>
                        </div>
                        <div id="winAmountDisplay" class="flex justify-between" style="display: none;">
                            <span class="text-gray-300">íšë“ í¬ì¸íŠ¸:</span>
                            <span id="winAmount" class="font-bold text-green-400"></span>
                        </div>
                    </div>
                </div>

                <button id="betBtn" class="flex items-center justify-center space-x-2 w-full py-3 mt-4 bg-yellow-300 text-black font-bold rounded">
                    <i class="fas fa-user-tie"></i>
                    <span>ì˜ˆì¸¡í•˜ê¸°</span>
                </button>

                <button id="resultBtn" class="flex items-center justify-center space-x-2 w-full py-3 mt-2 bg-blue-500 text-white font-bold rounded hidden">
                    <i class="fas fa-chart-line"></i>
                    <span>ê²°ê³¼ í™•ì¸</span>
                </button>

            </div>

            <!-- ëŒ€ê¸° ëª¨ë‹¬ (ë°°íŒ… ì¤‘ì§€ ì‹œ) -->
            <div id="waitingModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
                <div class="bg-gray-800 rounded-lg p-6 max-w-sm w-full mx-4 text-center">
                    <div class="mb-4">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-yellow-300 mx-auto"></div>
                        </div>
                    <h3 class="text-lg font-bold text-white mb-2">ê¸°ë‹¤ë¦¬ì„¸ìš”</h3>
                    <p class="text-gray-300">íƒ€ìê°€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤!</p>
                            </div>
                        </div>

            <!-- ìŠ¹ë¦¬ í¬ì¸íŠ¸ ê¸°ë¶€ ëª¨ë‹¬ -->
            <div id="donationModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
                <div class="bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4">
                    <h3 class="text-lg font-bold mb-4">ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! ì˜ˆì¸¡ ì„±ê³µ!</h3>
                    <p class="text-gray-300 mb-4">ìŠ¹ë¦¬ í¬ì¸íŠ¸ì˜ ì¼ë¶€ë¥¼ ë‹¤ë¥¸ ì‚¬ìš©ìë“¤ê³¼ ë‚˜ëˆ„ì‹œê² ìŠµë‹ˆê¹Œ?</p>
                    
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <button class="donation-btn bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded selected" data-percent="10">
                            10% ê¸°ë¶€
                        </button>
                        <button class="donation-btn bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded" data-percent="20">
                            20% ê¸°ë¶€
                        </button>
                        <button class="donation-btn bg-purple-500 hover:bg-purple-600 text-white py-2 px-4 rounded" data-percent="30">
                            30% ê¸°ë¶€
                        </button>
                        <button class="donation-btn bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded" data-percent="50">
                            50% ê¸°ë¶€
                        </button>
                    </div>

                    <button id="donateNoBtn" class="w-full bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded">
                        ê¸°ë¶€í•˜ì§€ ì•Šê¸°
                    </button>
                    
                    <!-- ê¸°ë¶€ í™•ì¸ ì„¹ì…˜ -->
                    <div id="donationConfirm" class="mt-4 p-3 bg-gray-700 rounded hidden">
                        <p class="text-sm text-gray-300 mb-3">
                            <span id="selectedPercent"></span>ë¥¼ ê¸°ë¶€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
                        </p>
                        <div class="flex space-x-2">
                            <button id="confirmYesBtn" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded text-sm">
                                ì˜ˆ
                            </button>
                            <button id="confirmNoBtn" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded text-sm">
                                ì•„ë‹ˆì˜¤
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- íŒ¨ë°° ê²°ê³¼ ëª¨ë‹¬ -->
            <div id="loseModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
                <div class="bg-gray-800 p-6 rounded-lg max-w-sm w-full mx-4">
                    <div class="text-center mb-6">
                        <i class="fas fa-times-circle text-red-500 text-5xl mb-4"></i>
                        <p class="font-bold text-xl mb-2">íŒ¨ë°°</p>
                        <p class="text-sm text-gray-300">ì•„ì‰½ê²Œë„ íŒ¨ë°°í•˜ì˜€ìŠµë‹ˆë‹¤.<br>ë‹¤ìŒ ê¸°íšŒë¥¼ ë…¸ë ¤ë³´ì„¸ìš”!</p>
                    </div>
                    <button id="loseConfirmBtn" class="w-full bg-blue-500 px-6 py-2 rounded hover:bg-blue-600">
                        í™•ì¸
                    </button>
                </div>
            </div>

            <!-- ê²ŒìŠ¤íŠ¸ ìŠ¹ë¦¬ ëª¨ë‹¬ -->
            <div id="guestWinModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
                <div class="bg-gray-800 p-6 rounded-lg max-w-sm w-full mx-4">
                    <div class="text-center mb-6">
                        <i class="fas fa-trophy text-yellow-500 text-5xl mb-4"></i>
                        <p class="font-bold text-xl mb-2">ì¶•í•˜í•©ë‹ˆë‹¤!</p>
                        <p class="text-sm text-gray-300">ìŠ¹ë¦¬í•˜ì…¨ìŠµë‹ˆë‹¤!</p>
                    </div>
                    <button id="guestWinConfirmBtn" class="w-full bg-blue-500 px-6 py-2 rounded hover:bg-blue-600">
                        í™•ì¸
                    </button>
                </div>
            </div>

            <!-- ê¸°ë¶€ ì™„ë£Œ ëª¨ë‹¬ -->
            <div id="donationCompleteModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
                <div class="bg-gray-800 p-6 rounded-lg max-w-sm w-full mx-4">
                    <div class="text-center mb-6">
                        <i class="fas fa-heart text-red-500 text-5xl mb-4"></i>
                        <p class="font-bold text-xl mb-2">ê¸°ë¶€ ì™„ë£Œ</p>
                        <p class="text-sm text-gray-300" id="donationCompleteMessage"></p>
                    </div>
                    <button id="donationCompleteBtn" class="w-full bg-blue-500 px-6 py-2 rounded hover:bg-blue-600">
                        í™•ì¸
                    </button>
                </div>
            </div>

            <!-- ê²ŒìŠ¤íŠ¸ ì•Œë¦¼ ëª¨ë‹¬ -->
            <div id="guestModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
                <div class="bg-gray-800 p-6 rounded-lg max-w-sm w-full mx-4">
                    <div class="text-center">
                        <p class="text-lg font-bold mb-4 text-red-500">ê²ŒìŠ¤íŠ¸ëŠ” í•´ë‹¹ì‚¬í•­ì´ ì•„ë‹™ë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>

            <!-- í˜¼ìì„œ ìŠ¹ë¦¬ ì‹œ ì•ˆë‚´ ëª¨ë‹¬ -->
            <div id="soloWinModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
                <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                    <h3 class="text-xl font-bold text-center mb-4 text-red-600">ğŸ¯ í˜¼ìì„œ ê²Œì„í•˜ì…¨êµ°ìš”!</h3>
                    
                    <div class="space-y-3 mb-6">
                        <p class="text-red-600 font-semibold text-center">ì´ ê²Œì„ì€ ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜ ì¦ê¸°ëŠ” ê²Œì„ì…ë‹ˆë‹¤.</p>
                        <p class="text-red-600 font-semibold text-center">í˜¼ìì„œëŠ” ìŠ¹ë¦¬ìˆ˜ë‹¹ê³¼ ê¸°ë¶€ê°€ ê³„ì‚°ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
                        <p class="text-red-600 font-semibold text-center">ì¹œêµ¬ë“¤ì„ ì´ˆëŒ€í•´ì„œ ë” ì¬ë¯¸ìˆê²Œ ê²Œì„í•´ë³´ì„¸ìš”!</p>
                    </div>

                    <div class="bg-gray-100 p-3 rounded-lg mb-4">
                        <p class="text-sm text-gray-700 text-center">
                            <strong>ê²Œì„ ê·œì¹™:</strong><br>
                            â€¢ 2ëª… ì´ìƒ ì°¸ê°€ ì‹œ ìŠ¹ë¦¬ìˆ˜ë‹¹ ê³„ì‚°<br>
                            â€¢ íŒ¨ìì˜ ë°°íŒ… í¬ì¸íŠ¸ë¥¼ ìŠ¹ë¦¬ìë“¤ì´ ë¶„ë°°<br>
                            â€¢ ìŠ¹ë¦¬ìˆ˜ë‹¹ì—ì„œ ê¸°ë¶€ ê°€ëŠ¥
                        </p>
                    </div>

                    <div class="space-y-2">
                        <button id="inviteFriendsBtn" class="w-full bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 font-semibold">
                            ğŸ”— ì¹œêµ¬ ì´ˆëŒ€í•˜ê¸°
                        </button>
                        <button id="nextGameBtn" class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 font-semibold">
                            ğŸ® ë‹¤ìŒ ê²Œì„í•˜ê¸°
                        </button>
                    </div>
                </div>
            </div>


        </div>
    </main>

    <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="fixed bottom-0 left-0 right-0 bg-black text-white py-3 border-t border-gray-700 z-50">
        <div class="flex justify-evenly">
            <div class="text-center cursor-pointer" onclick="location.href='invite.html'">
                <i class="fas fa-user-plus text-2xl"></i>
                <p class="text-[0.4rem]">ì´ˆëŒ€</p>
            </div>
            <div class="text-center cursor-pointer" onclick="checkAttendance()">
                <i class="fas fa-calendar-alt text-2xl"></i>
                <p class="text-[0.4rem]">ì¶œì„ë¶€</p>
            </div>
            <div class="text-center cursor-pointer" onclick="location.href='board.html'">
                <i class="fas fa-clipboard text-2xl"></i>
                <p class="text-[0.4rem]">ê²Œì‹œíŒ</p>
            </div>
            <div class="text-center cursor-pointer" onclick="location.href='charge.html'">
                <i class="fas fa-coins text-2xl"></i>
                <p class="text-[0.4rem]">í¬ì¸íŠ¸ì¶©ì „</p>
            </div>
        </div>
    </nav>

    <script>
        // ì „ì—­ ë³€ìˆ˜ë“¤
        let currentUser = null;
        let selectedGameType = 'íƒ€ì';
        let selectedBetAmount = 100;
        let selectedBetChoice = null; // ë°°íŒ… ì„ íƒ ì €ì¥ ë³€ìˆ˜ ì¶”ê°€
        let isBetting = false;
        let currentWinPoints = 0; // í˜„ì¬ ìŠ¹ë¦¬ í¬ì¸íŠ¸ ì €ì¥ìš©

        // ì„ íƒëœ ê²Œì„ ë³€ìˆ˜
        let selectedGame = null;
        let selectedChoice = null;
        let selectedAmount = 100; // ê³ ì •ê°’

        // í•œêµ­ í˜„ì¬ ë‚ ì§œ í•¨ìˆ˜ (2025ë…„ 7ì›” 19ì¼)
        function getCurrentKoreaDate() {
            return "2025-07-19";
        }

        // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ í•¨ìˆ˜


        // ì‚¬ìš©ì ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ë° UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function checkUserLoginStatus() {
            const userData = JSON.parse(localStorage.getItem('currentUser') || '{}');
            const userNameDisplay = document.getElementById('userNameDisplay');
                    const loginButton = document.getElementById('loginButton');
                    const logoutButton = document.getElementById('logoutButton');
            const userPointsDisplay = document.getElementById('userPoints');
            
            if (userData && userData.userId && !userData.isGuest) {
                // ë¡œê·¸ì¸ëœ ì‚¬ìš©ì
                currentUser = userData; // ì „ì—­ ë³€ìˆ˜ ì„¤ì •
                
                if (userNameDisplay) {
                    userNameDisplay.textContent = `${userData.name || userData.userName || 'ì‚¬ìš©ì'}ë‹˜`;
                    userNameDisplay.style.display = 'block';
                }
                    if (loginButton) loginButton.style.display = 'none';
                    if (logoutButton) logoutButton.style.display = 'block';
                    
                // í¬ì¸íŠ¸ í‘œì‹œ ì—…ë°ì´íŠ¸
                if (userPointsDisplay && userData.points !== undefined) {
                    userPointsDisplay.textContent = `${userData.points}í¬ì¸íŠ¸`;
                    console.log('ğŸ’° í¬ì¸íŠ¸ í‘œì‹œ ì—…ë°ì´íŠ¸:', userData.points);
                }
                
                console.log('âœ… ë¡œê·¸ì¸ëœ ì‚¬ìš©ì:', userData.name || userData.userName, 'í¬ì¸íŠ¸:', userData.points);
                } else {
                // ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ì‚¬ìš©ì
                currentUser = null; // ì „ì—­ ë³€ìˆ˜ ì´ˆê¸°í™”
                
                if (userNameDisplay) {
                    userNameDisplay.textContent = '';
                    userNameDisplay.style.display = 'none';
                }
                    if (loginButton) loginButton.style.display = 'block';
                    if (logoutButton) logoutButton.style.display = 'none';
                
                // í¬ì¸íŠ¸ í‘œì‹œ ì´ˆê¸°í™”
                if (userPointsDisplay) {
                    userPointsDisplay.textContent = '0í¬ì¸íŠ¸';
                }
                
                console.log('âŒ ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ì‚¬ìš©ì');
            }
        }

        // ë¸Œë¼ìš°ì € ì¢…ë£Œ ì‹œ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ ì„¤ì • (ë¹„í™œì„±í™”)
        function setupBrowserCloseLogout() {
            // ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ ë¹„í™œì„±í™” - ë¶ˆí•„ìš”í•œ API í˜¸ì¶œ ë°©ì§€
            console.log('ğŸ” ë¸Œë¼ìš°ì € ì¢…ë£Œ ì‹œ ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ ë¹„í™œì„±í™”ë¨');
            
            // beforeunload ì´ë²¤íŠ¸ (ë¸Œë¼ìš°ì € íƒ­/ì°½ ë‹«ê¸°) - ë¹„í™œì„±í™”
            // window.addEventListener('beforeunload', function(e) {
            //     if (currentUser && !currentUser.isGuest && currentUser.userId) {
            //         console.log('ğŸ” ë¸Œë¼ìš°ì € ì¢…ë£Œ ì‹œ ë¡œê·¸ì•„ì›ƒ:', currentUser.userId);
            //         navigator.sendBeacon('/api/logout', JSON.stringify({
            //             userId: currentUser.userId
            //         }));
            //     }
            // });
            
            // pagehide ì´ë²¤íŠ¸ (í˜ì´ì§€ ìˆ¨ê¹€, ëª¨ë°”ì¼ì—ì„œ ë” ì•ˆì •ì ) - ë¹„í™œì„±í™”
            // window.addEventListener('pagehide', function(e) {
            //     if (currentUser && !currentUser.isGuest && currentUser.userId) {
            //         console.log('ğŸ” í˜ì´ì§€ ìˆ¨ê¹€ ì‹œ ë¡œê·¸ì•„ì›ƒ:', currentUser.userId);
            //         navigator.sendBeacon('/api/logout', JSON.stringify({
            //             userId: currentUser.userId
            //         }));
            //     }
            // });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', async function() {
            // ì‚¬ìš©ì ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ë° UI ì—…ë°ì´íŠ¸
            checkUserLoginStatus();
            
            updateCurrentDate();
            await loadSimpleGames(); // ìƒˆë¡œìš´ ê°„ë‹¨í•œ ê²½ê¸° ë¡œë“œ
            setupButtonEventListeners();
            setupBrowserCloseLogout();
        });

        // ê°„ë‹¨í•œ ê²½ê¸° ëª©ë¡ ë¡œë“œ
        async function loadSimpleGames() {
            try {
                const response = await fetch('/api/team-games');
                if (response.ok) {
                    const data = await response.json();
                    const games = data.games || [];
                    
                    // ê²Œì„ ë°ì´í„° ë³€í™˜
                    const simpleGames = games.map(game => ({
                        id: game._id || game.id,
                        gameNumber: game.gameNumber || game.number,
                        homeTeam: game.homeTeam || '',
                        awayTeam: game.awayTeam || '',
                        matchup: game.matchup || `${game.homeTeam || ''} vs ${game.awayTeam || ''}`,
                        date: game.date || '',
                        startTime: game.startTime || '',
                        progressStatus: game.progressStatus || 'ê²½ê¸°ì „',
                        bettingStart: game.bettingStart || '',
                        bettingStop: game.bettingStop || '',
                        predictionResult: game.predictionResult || ''
                    }));
                    
                    window.allGamesData = simpleGames;
                    
                    // ê²Œì„ ì„ íƒ ëª¨ë‹¬ í‘œì‹œ (ìë™ ì„ íƒ ì œê±°)
                    showSimpleGameSelection(simpleGames);
                    
                    console.log('âœ… ê°„ë‹¨í•œ ê²½ê¸° ëª©ë¡ ë¡œë“œ ì™„ë£Œ:', simpleGames);
                } else {
                    console.error('âŒ ê²½ê¸° ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', response.status);
                }
            } catch (error) {
                console.error('âŒ ê²½ê¸° ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ê°„ë‹¨í•œ ê²½ê¸° ì„ íƒ UI
        function showSimpleGameSelection(games) {
            const container = document.getElementById('gameSelectionContainer');
            if (!container) return;
            
            container.innerHTML = `
                <div class="w-full">
                    <h4 class="text-white font-bold mb-3">ğŸŸï¸ ê²½ê¸° ì„ íƒ</h4>
                    <div class="grid gap-2">
                        ${games.map(game => {
                            // DBì—ì„œ ì½ì–´ì˜¨ ë°ì´í„°ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš© (ì‹œê°„ ê³„ì‚° ì‚­ì œ)
                            const progressStatus = game.progressStatus || 'ê²½ê¸°ì „';
                            const startTime = game.startTime || 'ì‹œê°„ ë¯¸ì •';
                            const isSelectable = progressStatus === 'ê²½ê¸°ì¤‘'; // ê²½ê¸°ì¤‘ë§Œ ì„ íƒ ê°€ëŠ¥
                            
                            // í˜„ì¬ ì„ íƒëœ ê²½ê¸°ì¸ì§€ í™•ì¸
                            const isSelected = selectedGame && (
                                selectedGame.gameNumber === game.gameNumber || 
                                selectedGame.number === game.number ||
                                selectedGame._id === game._id ||
                                selectedGame.id === game.id
                            );
                            
                            // ì„ íƒ ìƒíƒœì— ë”°ë¥¸ ìŠ¤íƒ€ì¼ ê²°ì •
                            let buttonClass, statusText, statusIcon;
                            
                            if (isSelected) {
                                buttonClass = 'bg-green-600 hover:bg-green-700 text-white border-2 border-green-400';
                                statusText = 'ì„ íƒë¨';
                                statusIcon = 'âœ…';
                            } else if (isSelectable) {
                                buttonClass = 'bg-blue-600 hover:bg-blue-700 text-white';
                                statusText = 'ì„ íƒ ê°€ëŠ¥';
                                statusIcon = 'ğŸŸ¢';
                            } else {
                                buttonClass = 'bg-gray-500 text-gray-300 cursor-not-allowed';
                                statusText = 'ì„ íƒ ë¶ˆê°€';
                                statusIcon = 'âŒ';
                            }
                            
                            return `
                                <button 
                                    onclick="selectSimpleGame('${game._id || game.id}', '${game.gameNumber || game.number}', '${game.matchup.replace(/'/g, "\\'")}')"
                                    class="w-full p-3 rounded text-left ${buttonClass} text-xs whitespace-nowrap"
                                    ${!isSelectable ? 'disabled' : ''}
                                >
                                    <div class="flex justify-between items-center">
                                        <div class="flex-1 min-w-0">
                                            <div class="font-bold truncate">${game.gameNumber || game.number}ê²½ê¸°</div>
                                            <div class="text-xs opacity-75 truncate">${getMatchupWithLogos(game.matchup)}</div>
                                        </div>
                                        <div class="text-xs ml-2 flex-shrink-0 flex items-center">
                                            <span class="mr-1">${statusIcon}</span>
                                            <span>${statusText}</span>
                                        </div>
                                    </div>
                                </button>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        // ëª¨ë“  ë°°íŒ… ë°ì´í„° í´ë¦¬ì–´ í•¨ìˆ˜
        async function clearAllBettingData() {
            try {
                console.log('ğŸ§¹ ê²½ê¸° ì„ íƒ ì‹œ ë°°íŒ… ë°ì´í„° í´ë¦¬ì–´ ì‹œì‘...');
                
                // ì„œë²„ì— ì™„ì „ ì´ˆê¸°í™” ìš”ì²­
                const response = await fetch('/api/clear-all-betting-data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                if (data.success) {
                    console.log('âœ… ë°°íŒ… ë°ì´í„° í´ë¦¬ì–´ ì™„ë£Œ:', data.message);
                    
                    // í´ë¼ì´ì–¸íŠ¸ ì¸¡ ë³€ìˆ˜ë„ ì´ˆê¸°í™”
                    window.selectedChoice = null;
                    selectedGame = null;
                    selectedChoice = null;
                    selectedAmount = 100;
                    
                    // ë°°íŒ… ì„ íƒ ì´ˆê¸°í™”
                    const selectedBettingText = document.getElementById('selectedBettingText');
                    const bettingSelectionBtn = document.getElementById('bettingSelectionBtn');
                    if (selectedBettingText) {
                        selectedBettingText.textContent = 'ë°°íŒ… ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”';
                        selectedBettingText.className = 'font-bold text-gray-300';
                    }
                    if (bettingSelectionBtn) {
                        bettingSelectionBtn.className = 'w-full p-3 bg-gray-700 rounded cursor-pointer hover:bg-gray-600 transition-colors text-left';
                        bettingSelectionBtn.disabled = true;
                        bettingSelectionBtn.classList.add('opacity-50', 'cursor-not-allowed');
                        bettingSelectionBtn.classList.remove('cursor-pointer');
                    }
                    
                    // ì˜ˆì¸¡í•˜ê¸° ë²„íŠ¼ ë¹„í™œì„±í™”
                    const betBtn = document.getElementById('betBtn');
                    if (betBtn) {
                        betBtn.disabled = true;
                        betBtn.classList.add('opacity-50', 'cursor-not-allowed');
                        betBtn.classList.remove('cursor-pointer');
                    }
                    
                    console.log('âœ… í´ë¼ì´ì–¸íŠ¸ ì¸¡ ë³€ìˆ˜ë„ ì´ˆê¸°í™” ì™„ë£Œ');
                } else {
                    console.error('âŒ ë°°íŒ… ë°ì´í„° í´ë¦¬ì–´ ì‹¤íŒ¨:', data.message);
                }
            } catch (error) {
                console.error('âŒ ë°°íŒ… ë°ì´í„° í´ë¦¬ì–´ ì˜¤ë¥˜:', error);
            }
        }

        // ìŒì„± í ì‹œìŠ¤í…œ
        let speechQueue = [];
        let isSpeaking = false;

        // ìŒì„± í ì²˜ë¦¬ í•¨ìˆ˜
        function processSpeechQueue() {
            if (speechQueue.length === 0 || isSpeaking) {
                return;
            }

            isSpeaking = true;
            const { text, rate, pitch } = speechQueue.shift();
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ko-KR';
            utterance.rate = rate || 0.9;
            utterance.pitch = pitch || 1.1;
            utterance.volume = 0.9;
            
            // ìŒì„± ì‹œì‘ ì´ë²¤íŠ¸
            utterance.onstart = () => {
                console.log('ğŸ¤ ìŒì„± ì¬ìƒ ì‹œì‘:', text);
            };
            
            // ìŒì„± ì™„ë£Œ ì´ë²¤íŠ¸
            utterance.onend = () => {
                console.log('ğŸ¤ ìŒì„± ì¬ìƒ ì™„ë£Œ:', text);
                isSpeaking = false;
                // íì— ë‚¨ì€ ìŒì„±ì´ ìˆìœ¼ë©´ ë‹¤ìŒ ìŒì„± ì¬ìƒ
                setTimeout(() => processSpeechQueue(), 100);
            };
            
            utterance.onerror = (event) => {
                console.log('ğŸ¤ ìŒì„± ì¬ìƒ ì˜¤ë¥˜:', event.error);
                isSpeaking = false;
                // ì˜¤ë¥˜ ë°œìƒ ì‹œì—ë„ ë‹¤ìŒ ìŒì„± ì¬ìƒ
                setTimeout(() => processSpeechQueue(), 100);
            };
            
            speechSynthesis.speak(utterance);
            console.log('ğŸ¤ ìŒì„± ì¬ìƒ ìš”ì²­ ì™„ë£Œ:', text);
        }

        // ìŒì„± í•©ì„± í•¨ìˆ˜ (í ì‹œìŠ¤í…œ ì‚¬ìš©)
        function speakText(text, rate = 0.9) {
            console.log('ğŸ¤ ìŒì„± ì¬ìƒ ì‹œë„:', text);
            
            if ('speechSynthesis' in window) {
                // ì¶•í•˜í•˜ëŠ” ìŒì„±ì¸ì§€ í™•ì¸
                const isCelebration = text.includes('ì¶•í•˜í•©ë‹ˆë‹¤') || text.includes('ì™€!');
                const isFailure = text.includes('ì•„ì‰½ë„¤ìš”') || text.includes('ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
                const isUrgent = text.includes('ë°°íŒ…ì„ íƒì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤');
                const isStrict = text.includes('ë°°íŒ…ì„ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                
                let finalRate = rate;
                let finalPitch = 1.1;
                
                if (isCelebration) {
                    finalRate = 1.1;
                    finalPitch = 1.3; // ì¶•í•˜í•  ë•ŒëŠ” ë” ë†’ì€ ìŒì¡°
                } else if (isFailure) {
                    finalRate = 0.7;
                    finalPitch = 0.8; // ì‹¤íŒ¨í•  ë•ŒëŠ” ë” ë‚®ì€ ìŒì¡°
                } else if (isUrgent) {
                    finalRate = 1.3;
                    finalPitch = 1.2; // ê¸‰í•œ ëª©ì†Œë¦¬ëŠ” ë¹ ë¥¸ ì†ë„, ì•½ê°„ ë†’ì€ ìŒì¡°
                } else if (isStrict) {
                    finalRate = 0.8;
                    finalPitch = 0.9; // ì—„ê²©í•œ ëª©ì†Œë¦¬ëŠ” ëŠë¦° ì†ë„, ë‚®ì€ ìŒì¡°
                }
                
                // ìŒì„±ì„ íì— ì¶”ê°€ (íŠ¹ë³„ ì²˜ë¦¬)
                speechQueue.push({ text, rate: finalRate, pitch: finalPitch });
                let logSuffix = '';
                if (isCelebration) logSuffix = '(ì¶•í•˜ ìŒì„±)';
                else if (isFailure) logSuffix = '(ì‹¤íŒ¨ ìŒì„±)';
                else if (isUrgent) logSuffix = '(ê¸‰í•œ ìŒì„±)';
                else if (isStrict) logSuffix = '(ì—„ê²©í•œ ìŒì„±)';
                console.log('ğŸ¤ ìŒì„± íì— ì¶”ê°€ë¨:', text, logSuffix);
                
                // í ì²˜ë¦¬ ì‹œì‘
                processSpeechQueue();
            } else {
                console.log('ğŸ¤ ìŒì„± í•©ì„± APIë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
        }

        // DB ë°ì´í„°ë¥¼ ì‚¬ìš©í•œ ê²½ê¸° ì„ íƒ í•¨ìˆ˜
        let gameSelectionInProgress = false; // ê²½ê¸° ì„ íƒ ì§„í–‰ ì¤‘ í”Œë˜ê·¸
        
        async function selectSimpleGame(gameId, gameNumber, matchup) {
            console.log(`ğŸ¯ ê²½ê¸° ì„ íƒ: ${gameNumber}ê²½ê¸° ${matchup}`);
            
            // ì´ë¯¸ ê²½ê¸° ì„ íƒì´ ì§„í–‰ ì¤‘ì´ë©´ ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
            if (gameSelectionInProgress) {
                console.log('ğŸ¯ ì´ë¯¸ ê²½ê¸° ì„ íƒì´ ì§„í–‰ ì¤‘, ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€');
                return;
            }
            
            gameSelectionInProgress = true;
            
            // ê²½ê¸° ì„ íƒ ì‹œ ìŒì„± ì•ˆë‚´ ì œê±° (ìš”ì²­ì— ë”°ë¼ ë¹„í™œì„±í™”)
            
            // ê²½ê¸° ì„ íƒ ì‹œ ë°°íŒ… ë°ì´í„° ì´ˆê¸°í™” ìš”ì²­(ë°±ê·¸ë¼ìš´ë“œ, UI ë¸”ë¡œí‚¹ ì—†ìŒ)
            try {
                fetch('/api/clear-all-betting-data', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                })
                .then(res => res.json())
                .then(data => console.log('ğŸ§¹ ê°•ì œ ì´ˆê¸°í™” ì‘ë‹µ:', data))
                .catch(err => console.warn('âš ï¸ ê°•ì œ ì´ˆê¸°í™” í˜¸ì¶œ ê²½ê³ :', err));
            } catch (error) {
                console.warn('âš ï¸ ê°•ì œ ì´ˆê¸°í™” í˜¸ì¶œ ì˜¤ë¥˜(ë¬´ì‹œ):', error);
            }
            
            // í¬ì¸íŠ¸ ì´ˆê¸°í™” í”Œë˜ê·¸ ë¦¬ì…‹
            pointsInitialized = false;
            
            // ì „ì²´ ê²½ê¸° ë°ì´í„°ì—ì„œ í•´ë‹¹ ê²½ê¸° ì°¾ê¸°
            const allGames = window.allGamesData || [];
            const selectedGameData = allGames.find(game => 
                (game._id === gameId) || 
                (game.id === gameId) || 
                (game.gameNumber === gameNumber)
            );
            
            if (selectedGameData) {
                // ì„ íƒëœ ê²½ê¸° ì •ë³´ ì €ì¥ (ì›ë³¸ DB ë°ì´í„° ì‚¬ìš©, date/gameNumber ë³´ì¥)
                selectedGame = {
                    ...selectedGameData,
                    _id: selectedGameData._id || selectedGameData.id,
                    id: selectedGameData.id || selectedGameData._id,
                    date: selectedGameData.date || selectedGameData.gameDate || '',
                    gameNumber: selectedGameData.gameNumber || selectedGameData.number || '',
                    bettingStart: selectedGameData.bettingStart || '',
                    bettingStop: selectedGameData.bettingStop || ''
                };
                
                // ê²½ê¸° ì„ íƒ ëª¨ë‹¬ì„ ì„ íƒëœ ê²½ê¸°ë§Œ í‘œì‹œí•˜ë„ë¡ ë³€ê²½ (ì •ê·œí™”ëœ selectedGame ì‚¬ìš©)
                showSelectedGameOnly(gameNumber, matchup, selectedGame);
                
                // ë² íŒ… ì„ íƒ í™œì„±í™” (ë¨¼ì €)
                enableBettingSelection();
                
                // ë°°íŒ… ìƒíƒœ ì‹¤ì‹œê°„ í™•ì¸ ë° ì—…ë°ì´íŠ¸
            checkBettingStatus();
                
                // ë°°íŒ… ìƒíƒœ í™•ì¸ì„ ì£¼ê¸°ì ìœ¼ë¡œ ì‹¤í–‰
                if (window.bettingStatusInterval) {
                    clearInterval(window.bettingStatusInterval);
                }
                window.bettingStatusInterval = setInterval(checkBettingStatus, 500); // 0.5ì´ˆë§ˆë‹¤ í™•ì¸
                
                // ë°°íŒ… ì„ íƒ ë²„íŠ¼ í™œì„±í™” (ì¦‰ì‹œ ì‹¤í–‰)
                enableBettingChoices();
                
                // ë°°íŒ… í¬ì¸íŠ¸ ì„ íƒ í™œì„±í™” (ë‚˜ì¤‘ì—)
                enableBettingPoints();
                
                console.log('âœ… ê²½ê¸° ì„ íƒ ì™„ë£Œ:', selectedGame);
                // í”Œë˜ê·¸ ì¦‰ì‹œ í•´ì œ (ì²« í´ë¦­ ì¦‰ì‹œ ë°˜ì‘)
                gameSelectionInProgress = false;
            } else {
                console.error('âŒ ì„ íƒëœ ê²½ê¸° ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                alert('ê²½ê¸° ì„ íƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                gameSelectionInProgress = false; // ì˜¤ë¥˜ ì‹œì—ë„ í”Œë˜ê·¸ ë¦¬ì…‹
            }
            if (typeof enableGameTypeSelection === 'function') enableGameTypeSelection();
            if (typeof enableBettingPoints === 'function') enableBettingPoints();
        }

        // ì„ íƒëœ ê²½ê¸°ë§Œ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
        function showSelectedGameOnly(gameNumber, matchup, gameData) {
            const container = document.getElementById('gameSelectionContainer');
            if (!container) return;
            
            // í‘œì‹œ ë°ì´í„° ì•ˆì „ êµ¬ì„± (ë‘ ë²ˆì§¸ ì´í›„ ë¹ˆ ê°’ìœ¼ë¡œ ë³´ì´ëŠ” ë¬¸ì œ ë°©ì§€)
            const base = (gameData && (gameData.gameNumber || gameData.number)) ? gameData : (typeof selectedGame === 'object' ? selectedGame : {});
            
            // DBì—ì„œ ì½ì–´ì˜¨ ë°ì´í„° ì‚¬ìš© + í•©ë¦¬ì  í´ë°±
            const bettingStart = base && base.bettingStart ? base.bettingStart : 'ì¤‘ì§€';
            const progressStatus = base && base.progressStatus
                ? base.progressStatus
                : (bettingStart === 'ì‹œì‘' ? 'ê²½ê¸°ì¤‘' : 'ê²½ê¸°ì „');
            const startTime = (base && base.startTime) ? base.startTime : (selectedGame && selectedGame.startTime) ? selectedGame.startTime : 'ì‹œê°„ ë¯¸ì •';
            const date = (base && base.date) ? base.date : (selectedGame && selectedGame.date) ? selectedGame.date : 'ë‚ ì§œ ë¯¸ì •';
            // matchup ì•ˆì „ í´ë°±: ì¸ì â†’ gameData.matchup â†’ home/away ì¡°í•© â†’ selectedGame
            const displayMatchup = (typeof matchup === 'string' && matchup)
                ? matchup
                : (base && base.matchup)
                    ? base.matchup
                    : (base && base.homeTeam && base.awayTeam)
                        ? `${base.homeTeam} vs ${base.awayTeam}`
                        : (selectedGame && (selectedGame.matchup || (selectedGame.homeTeam && selectedGame.awayTeam ? `${selectedGame.homeTeam} vs ${selectedGame.awayTeam}` : '')));
            
            const isActive = progressStatus === 'ê²½ê¸°ì¤‘' && bettingStart === 'ì‹œì‘';
            const statusClass = isActive ? 'text-green-300' : 'text-red-300';
            const statusText = isActive ? 'ê²½ê¸°ì¤‘ + ë² íŒ…ê°€ëŠ¥' : `${progressStatus} + ${bettingStart}`;
            
            container.innerHTML = `
                <div class="w-full">
                    <div class="grid gap-2">
                        <div onclick="resetGameSelection()" class="bg-blue-600 rounded-lg p-2 cursor-pointer hover:bg-blue-700 transition-colors">
                            <div class="flex justify-between items-center">
                                <div class="flex-1 min-w-0">
                                    <div class="font-bold text-white text-xs truncate">${getMatchupWithLogos(displayMatchup)}</div>
                                </div>
                                <div class="text-xs text-blue-200 opacity-75 flex-shrink-0 ml-2">
                                    ${startTime} | ${progressStatus}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ê²½ê¸° ì„ íƒ ì´ˆê¸°í™” í•¨ìˆ˜
        function resetGameSelection() {
            window.selectedChoice = null;
            selectedGame = null;
            
            // ê²Œì„ ì„ íƒ ë²„íŠ¼ ì´ˆê¸°í™”
            document.querySelectorAll('.game-select-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600', 'border-blue-400');
                btn.classList.add('bg-green-600', 'border-green-500');
            });
            
            // ë°°íŒ… ì„ íƒ ì´ˆê¸°í™”
            const selectedBettingText = document.getElementById('selectedBettingText');
            const bettingSelectionBtn = document.getElementById('bettingSelectionBtn');
            if (selectedBettingText) {
                selectedBettingText.textContent = 'ë°°íŒ… ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”';
                selectedBettingText.className = 'font-bold text-gray-300';
            }
            if (bettingSelectionBtn) {
                bettingSelectionBtn.className = 'w-full p-3 bg-gray-700 rounded cursor-pointer hover:bg-gray-600 transition-colors text-left';
                bettingSelectionBtn.disabled = true;
                bettingSelectionBtn.classList.add('opacity-50', 'cursor-not-allowed');
                bettingSelectionBtn.classList.remove('cursor-pointer');
            }
            
            // ì˜ˆì¸¡í•˜ê¸° ë²„íŠ¼ ë¹„í™œì„±í™”
            const betBtn = document.getElementById('betBtn');
            betBtn.disabled = true;
            betBtn.classList.add('opacity-50', 'cursor-not-allowed');
            betBtn.classList.remove('cursor-pointer');

            // ê²½ê¸° ì„ íƒ ëª¨ë‹¬ ë‹¤ì‹œ í‘œì‹œ
            if (typeof loadSimpleGames === 'function') {
                loadSimpleGames();
            }
        }



        // ê²Œì„ì„ íƒ ë²„íŠ¼ ì„ íƒ í•¨ìˆ˜
        function selectGameType(button) {
            // ì´ì „ ì„ íƒ í•´ì œ
            document.querySelectorAll('.game-type-btn').forEach(b => {
                b.classList.remove('bg-yellow-800', 'border-yellow-600', 'ring-2', 'ring-yellow-400');
                b.classList.add('bg-yellow-500');
            });
            
            // í˜„ì¬ ì„ íƒ í‘œì‹œ (í™•ì‹¤í•˜ê²Œ ì§„í•˜ê²Œ)
            button.classList.remove('bg-yellow-500');
            button.classList.add('bg-yellow-800', 'border-yellow-600', 'ring-2', 'ring-yellow-400');
        }

        // ë°°íŒ…í¬ì¸íŠ¸ ë²„íŠ¼ ì„ íƒ í•¨ìˆ˜
        function selectBetAmount(button) {
            // ì´ì „ ì„ íƒ í•´ì œ
            document.querySelectorAll('.bet-amount-btn').forEach(b => {
                b.classList.remove('bg-yellow-800', 'border-yellow-600', 'ring-2', 'ring-yellow-400');
                b.classList.add('bg-yellow-500');
            });
            
            // í˜„ì¬ ì„ íƒ í‘œì‹œ (í™•ì‹¤í•˜ê²Œ ì§„í•˜ê²Œ)
            button.classList.remove('bg-yellow-500');
            button.classList.add('bg-yellow-800', 'border-yellow-600', 'ring-2', 'ring-yellow-400');
            
            // í¬ì¸íŠ¸ ì„ íƒ ì²˜ë¦¬
            selectedAmount = parseInt(button.dataset.amount);
            console.log('ğŸ’° ì„ íƒëœ í¬ì¸íŠ¸:', selectedAmount);
            
            // ì˜ˆì¸¡í•˜ê¸° ë²„íŠ¼ í™œì„±í™”
            enablePredictionButton();
        }

        // ë°°íŒ… í¬ì¸íŠ¸ ì„ íƒ í™œì„±í™” (1â†’3â†’2 ìˆœì„œ)
        let pointsInitialized = false; // ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€ í”Œë˜ê·¸
        
        function enableBettingPoints() {
            // ì´ë¯¸ ì´ˆê¸°í™”ë˜ì—ˆìœ¼ë©´ ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
            if (pointsInitialized) {
                return;
            }

            pointsInitialized = true;
            
            // í¬ì¸íŠ¸ ì„ íƒ UI í‘œì‹œ
            const pointsContainer = document.getElementById('bettingPointsContainer');
            if (pointsContainer) {
                pointsContainer.style.display = 'block';
            }
            // í¬ì¸íŠ¸ ì„ íƒ ë²„íŠ¼ë“¤ í™œì„±í™”
            const pointButtons = document.querySelectorAll('.bet-amount-btn');
            pointButtons.forEach(btn => {
                if (btn.dataset.amount === '100') {
                    btn.classList.add('bg-blue-700', 'text-white', 'font-bold', 'border-blue-900');
                    btn.classList.remove('bg-yellow-800', 'bg-yellow-500', 'text-black');
                    btn.disabled = true;
                    btn.classList.add('opacity-50', 'cursor-not-allowed');
                    btn.classList.remove('cursor-pointer');
                    window.selectedAmount = 100;
                    
                    // í¬ì¸íŠ¸ ì„ íƒ ìŒì„± ì•ˆë‚´ ì œê±° (ê²½ê¸° ì„ íƒ ì‹œ ì´ë¯¸ ì•ˆë‚´ë¨)
                } else {
                    btn.disabled = true;
                    btn.classList.add('opacity-50', 'cursor-not-allowed');
                    btn.classList.remove('cursor-pointer');
                }
                btn.onclick = null;
            });
            // ë°°íŒ… ì„ íƒ ë²„íŠ¼ ìƒíƒœëŠ” enableBettingChoicesì™€ enableBettingSelectionì—ì„œ ì²˜ë¦¬
            // ì•ˆë‚´ ë¬¸êµ¬ ìˆ¨ê¹€
            const guide = document.getElementById('bettingTypeGuide');
            if (guide) guide.style.display = 'none';
            // í¬ì¸íŠ¸ ë²„íŠ¼ì´ 1ê°œ ì´ìƒì´ë©´ ì²« ë²ˆì§¸ í¬ì¸íŠ¸ ìë™ ì„ íƒ
            if (pointButtons.length > 0) {
                pointButtons[0].click();
            }
        }

        // ë°°íŒ… ì„ íƒ í™œì„±í™”
        function enableBettingSelection() {
            const bettingOptionsContainer = document.getElementById('bettingOptionsContainer');
            
            if (selectedGame && selectedGame.bettingStart === 'ì‹œì‘') {
                if (bettingOptionsContainer) {
                    bettingOptionsContainer.style.display = 'block';
                }
            } else {
                if (bettingOptionsContainer) {
                    bettingOptionsContainer.style.display = 'none';
                }
            }
        }

        // ë°°íŒ… ì„ íƒ ë¹„í™œì„±í™”
        function disableBettingSelection() {
            const bettingOptionsContainer = document.getElementById('bettingOptionsContainer');
            if (bettingOptionsContainer) {
                bettingOptionsContainer.style.display = 'none';
            }
        }



        // ë°°íŒ… ì„ íƒ
        function selectBetChoiceFromModal(choice) {
            console.log(`ğŸ¯ ë°°íŒ… ì„ íƒ: ${choice}`);
            
            // ì„ íƒëœ ë°°íŒ… ìœ í˜• ì €ì¥
            window.selectedChoice = choice;
            console.log('ğŸ¯ ì„ íƒëœ ë°°íŒ…:', window.selectedChoice);
            
            // ì„ íƒëœ ë°°íŒ… í‘œì‹œ
            updateBettingSelectionDisplay(choice);
            
            // ë°°íŒ… ì„ íƒ ìŒì„± ì•ˆë‚´
            speakText(`${choice} ì„ íƒí–ˆìŠµë‹ˆë‹¤.`);
            
            // ì˜ˆì¸¡í•˜ê¸° ë²„íŠ¼ í™œì„±í™”
            enablePredictionButton();
        }

        // ë°°íŒ… ì„ íƒ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateBettingSelectionDisplay(choice) {
            const bettingOptionsContainer = document.getElementById('bettingOptionsContainer');
            
            if (bettingOptionsContainer) {
                // ëª¨ë“  ë°°íŒ… ë²„íŠ¼ ìˆ¨ê¸°ê¸°
                const betButtons = bettingOptionsContainer.querySelectorAll('.bet-choice-btn');
                betButtons.forEach(btn => {
                    btn.style.display = 'none';
                    btn.classList.remove('bg-blue-600', 'border-2', 'border-blue-400');
                    btn.classList.add('bg-gray-700');
                });
                
                // ì„ íƒëœ ë°°íŒ… ë²„íŠ¼ë§Œ í‘œì‹œí•˜ê³  ì„ íƒ ìƒíƒœ ì¶”ê°€
                const selectedButton = bettingOptionsContainer.querySelector(`[onclick*="${choice}"]`);
                if (selectedButton) {
                    selectedButton.style.display = 'block';
                    selectedButton.classList.remove('bg-gray-700');
                    selectedButton.classList.add('bg-blue-600', 'border-2', 'border-blue-400');
                    
                    // ì„ íƒëœ ë²„íŠ¼ì— "ë‹¤ì‹œ ì„ íƒ" í…ìŠ¤íŠ¸ ì¶”ê°€
                    const buttonContent = selectedButton.querySelector('.flex-1');
                    if (buttonContent) {
                        const originalText = buttonContent.innerHTML;
                        buttonContent.innerHTML = originalText + '<div class="text-xs text-blue-300 mt-1">(í´ë¦­í•˜ì—¬ ë‹¤ì‹œ ì„ íƒ)</div>';
                    }
                    
                    // ì„ íƒëœ ë²„íŠ¼ì— ë‹¤ì‹œ í´ë¦­í•˜ë©´ ëª¨ë“  ì˜µì…˜ì„ í‘œì‹œí•˜ëŠ” ì´ë²¤íŠ¸ ì¶”ê°€
                    selectedButton.onclick = function() {
                        showAllBettingOptions();
                    };
                }
            }
        }

        // ëª¨ë“  ë°°íŒ… ì˜µì…˜ í‘œì‹œ
        function showAllBettingOptions() {
            const bettingOptionsContainer = document.getElementById('bettingOptionsContainer');
            
            if (bettingOptionsContainer) {
                // ëª¨ë“  ë°°íŒ… ë²„íŠ¼ í‘œì‹œ
                const betButtons = bettingOptionsContainer.querySelectorAll('.bet-choice-btn');
                betButtons.forEach(btn => {
                    btn.style.display = 'block';
                    btn.classList.remove('bg-blue-600', 'border-2', 'border-blue-400');
                    btn.classList.add('bg-gray-700');
                    
                    // ì›ë˜ í…ìŠ¤íŠ¸ ë³µì›
                    const buttonContent = btn.querySelector('.flex-1');
                    if (buttonContent) {
                        const originalText = buttonContent.innerHTML.replace('<div class="text-xs text-blue-300 mt-1">(í´ë¦­í•˜ì—¬ ë‹¤ì‹œ ì„ íƒ)</div>', '');
                        buttonContent.innerHTML = originalText;
                    }
                    
                    // ì›ë˜ onclick ì´ë²¤íŠ¸ ë³µì›
                    const choice = btn.getAttribute('onclick').match(/'([^']+)'/)[1];
                    btn.onclick = function() {
                        selectBetChoiceFromModal(choice);
                    };
                });
                
                // ì„ íƒ ìƒíƒœ ì´ˆê¸°í™”
                window.selectedChoice = null;
                enablePredictionButton();
            }
        }

        // ë°°íŒ… ì„ íƒ í•¨ìˆ˜ (ê¸°ì¡´ ì²´í¬ë°•ìŠ¤ ë°©ì‹ - í˜¸í™˜ì„± ìœ ì§€)
        function selectBetChoice(choice) {
            selectBetChoiceFromModal(choice);
        }

        // ë°°íŒ… ì„ íƒ ì˜µì…˜ í™œì„±í™”
        function enableBettingChoices() {
            const bettingOptionsContainer = document.getElementById('bettingOptionsContainer');
            
            if (selectedGame && selectedGame.bettingStart === 'ì‹œì‘') {
                if (bettingOptionsContainer) {
                    bettingOptionsContainer.style.display = 'block';
                }
            } else {
                if (bettingOptionsContainer) {
                    bettingOptionsContainer.style.display = 'none';
                }
            }
        }

        // ë°°íŒ… ì„ íƒ ì˜µì…˜ ë¹„í™œì„±í™”
        function disableBettingChoices() {
            const bettingOptionsContainer = document.getElementById('bettingOptionsContainer');
            if (bettingOptionsContainer) {
                bettingOptionsContainer.style.display = 'none';
            }
        }

        // team-games ì»¬ë ‰ì…˜ì˜ ì˜ˆì¸¡í•˜ê¸° ë²„íŠ¼ í™œì„±í™”
        function enablePredictionButton() {
            const betBtn = document.getElementById('betBtn');
            if (
                selectedGame &&
                selectedGame.bettingStart === 'ì‹œì‘' &&
                window.selectedChoice
            ) {
                betBtn.disabled = false;
                betBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                betBtn.classList.add('cursor-pointer');
            } else {
                betBtn.disabled = true;
                betBtn.classList.add('opacity-50', 'cursor-not-allowed');
                betBtn.classList.remove('cursor-pointer');
            }
        }

        // team-games ì»¬ë ‰ì…˜ì˜ ì˜ˆì¸¡í•˜ê¸° ë²„íŠ¼ ë¹„í™œì„±í™”
        function disablePredictionButton() {
            const betBtn = document.getElementById('betBtn');
            betBtn.disabled = true;
            betBtn.classList.add('opacity-50', 'cursor-not-allowed');
            betBtn.classList.remove('cursor-pointer');
        }

        // team-games ì»¬ë ‰ì…˜ì˜ ë°°íŒ… ì²˜ë¦¬ í•¨ìˆ˜
        async function handleBetting() {
            // ì˜ˆì¸¡í•˜ê¸° ë²„íŠ¼ì´ ë¹„í™œì„±í™”ë©´ ì•„ë¬´ ë™ì‘ë„ í•˜ì§€ ì•ŠìŒ
            const betBtn = document.getElementById('betBtn');
            if (betBtn.disabled) return;
            if (!window.selectedChoice) {
                speakText('ë°°íŒ… ìœ í˜•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                alert('ë°°íŒ… ìœ í˜•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            if (!currentUser || currentUser.isGuest) {
                speakText('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }
            if (!selectedGame) {
                speakText('ê²½ê¸°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                alert('ê²½ê¸°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            console.log('ğŸ¯ ë°°íŒ… ì²˜ë¦¬ ì‹œì‘:', {
                selectedGame: selectedGame.gameNumber || selectedGame.number,
                selectedChoice: window.selectedChoice,
                bettingStart: selectedGame.bettingStart,
                bettingStop: selectedGame.bettingStop
            });
            if (selectedGame.bettingStart !== 'ì‹œì‘') {
                alert('ì•„ì§ ë°°íŒ…ì´ ì‹œì‘ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }
            if (selectedGame.bettingStop === 'ì¤‘ì§€') {
                showWaitingModal();
                return;
            }
            if (currentUser.points < selectedAmount) {
                alert('í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.');
                return;
            }
            showBettingConfirmModal();
        }

        // ë°°íŒ… í™•ì¸ ëª¨ë‹¬ í‘œì‹œ
        function showBettingConfirmModal() {
            // ê¸°ì¡´ ëª¨ë‹¬ ì œê±°
            const oldModal = document.getElementById('bettingConfirmModal');
            if (oldModal) oldModal.remove();
            const modal = document.createElement('div');
            modal.id = 'bettingConfirmModal';
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            // ì•ˆì „í•˜ê²Œ ê°’ ì½ê¸°
            const gameNumber = selectedGame && (selectedGame.gameNumber || selectedGame.number || '-');
            let matchup = '-';
            if (selectedGame) {
                if (selectedGame.matchup && selectedGame.matchup !== '-') {
                    matchup = selectedGame.matchup;
                } else if (selectedGame.homeTeam && selectedGame.awayTeam) {
                    matchup = selectedGame.homeTeam + ' vs ' + selectedGame.awayTeam;
                }
            }
            const date = selectedGame && (selectedGame.date || '-');
            const startTime = selectedGame && (selectedGame.startTime || '-');
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4">
                    <h3 class="text-lg font-bold mb-4">ğŸ¯ ë°°íŒ… í™•ì¸</h3>
                    <div class="space-y-3 mb-6">
                        <div class="flex justify-between">
                            <span class="text-gray-300">ê²½ê¸°:</span>
                            <span class="font-bold">${gameNumber}ê²½ê¸° ${matchup}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-300">ë‚ ì§œ/ì‹œê°„:</span>
                            <span class="font-bold">${date} ${startTime}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-300">ê²Œì„ íƒ€ì…:</span>
                            <span class="font-bold">íƒ€ì</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-300">ë°°íŒ… í¬ì¸íŠ¸:</span>
                            <span class="font-bold">100í¬ì¸íŠ¸ (ê³ ì •)</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-300">ì˜ˆì¸¡ ì„ íƒ:</span>
                            <span class="font-bold">${getBettingChoiceText(window.selectedChoice)}</span>
                        </div>
                        <div class="flex justify-between border-t border-gray-600 pt-3">
                            <span class="text-gray-300">ë°°íŒ… í›„ í¬ì¸íŠ¸:</span>
                            <span class="font-bold text-yellow-400">${currentUser.points - 100}í¬ì¸íŠ¸</span>
                        </div>
                    </div>
                    <div class="flex space-x-3">
                        <button id="confirmBetBtn" class="flex-1 bg-yellow-300 text-black font-bold py-3 rounded">
                            í™•ì¸
                        </button>
                        <button id="cancelBetBtn" class="flex-1 bg-gray-600 text-white font-bold py-3 rounded">
                            ì·¨ì†Œ
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            document.getElementById('confirmBetBtn').onclick = function() {
                // ë°°íŒ… í™•ì¸ ìŒì„± ì•ˆë‚´
                speakText('ë°°íŒ…ì„ ì§„í–‰í•©ë‹ˆë‹¤.');
                
                if (typeof confirmBet === 'function') {
                    confirmBet();
                } else {
                    processBetting();
                }
                modal.remove();
            };
            document.getElementById('cancelBetBtn').onclick = function() {
                modal.remove();
            };
        }

        // ë°°íŒ… ì²˜ë¦¬ (ì¤‘ë³µ ë°©ì§€)
        let isBettingInProgress = false; // ë°°íŒ… ì§„í–‰ ì¤‘ í”Œë˜ê·¸
        
        async function processBetting() {
            // ì¤‘ë³µ ë°°íŒ… ë°©ì§€
            if (isBettingInProgress) {
                console.log('âš ï¸ ë°°íŒ…ì´ ì´ë¯¸ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.');
                return;
            }
            
            try {
                isBettingInProgress = true; // ë°°íŒ… ì‹œì‘
                console.log('ğŸ¯ ë°°íŒ… ì‹œì‘ - ì¤‘ë³µ ë°©ì§€ í™œì„±í™”');
                
                const response = await fetch('/api/betting/submit', {
                method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                body: JSON.stringify({
                        userId: currentUser.userId,
                        userName: currentUser.name || currentUser.userName || 'ì‚¬ìš©ì',
                    gameNumber: selectedGame.gameNumber,
                        prediction: selectedChoice,
                        points: selectedAmount
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // í¬ì¸íŠ¸ ì°¨ê°
                    // ì„œë²„ ê¸°ì¤€ í¬ì¸íŠ¸ ì—…ë°ì´íŠ¸
                    currentUser.points -= selectedAmount;
                    document.getElementById('userPoints').textContent = `${currentUser.points}í¬ì¸íŠ¸`;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    // ì„œë²„ì— ì¦‰ì‹œ ë™ê¸°í™”
                    await updateServerPoints(currentUser.points);
                    
                    alert('ë°°íŒ…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                    
                    // ê²°ê³¼ í™•ì¸ ëŒ€ê¸°
                    waitForResult();
                } else {
                    alert('ë°°íŒ… ì‹¤íŒ¨: ' + data.message);
                    // ë°°íŒ… ì‹¤íŒ¨ ì‹œ ìƒíƒœ ì´ˆê¸°í™”
                    isBetting = false;
                    if (window.bettingStatusInterval) {
                        clearInterval(window.bettingStatusInterval);
                        console.log('âœ… ë°°íŒ… ì‹¤íŒ¨ ì‹œ ì¸í„°ë²Œ ì •ë¦¬ë¨');
                    }
                }
            } catch (error) {
                console.error('ë°°íŒ… ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                alert('ë°°íŒ… ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                // ì˜¤ë¥˜ ì‹œì—ë„ ìƒíƒœ ì´ˆê¸°í™”
                isBetting = false;
                if (window.bettingStatusInterval) {
                    clearInterval(window.bettingStatusInterval);
                    console.log('âœ… ì˜¤ë¥˜ ì‹œ ì¸í„°ë²Œ ì •ë¦¬ë¨');
                }
            } finally {
                isBettingInProgress = false; // ë°°íŒ… ì™„ë£Œ (ì„±ê³µ/ì‹¤íŒ¨ ìƒê´€ì—†ì´)
                console.log('âœ… ë°°íŒ… ì™„ë£Œ - ì¤‘ë³µ ë°©ì§€ í•´ì œ');
            }
        }

        // ê²°ê³¼ ëŒ€ê¸°
        function waitForResult() {
            console.log('ğŸ”„ ê²°ê³¼ ëŒ€ê¸° ì‹œì‘...');
            let checkCount = 0;
            
            // ë°°íŒ… ìƒíƒœ í™•ì¸ ì¸í„°ë²Œ ì •ë¦¬
            if (window.bettingStatusInterval) {
                clearInterval(window.bettingStatusInterval);
                console.log('âœ… ë°°íŒ… ìƒíƒœ í™•ì¸ ì¸í„°ë²Œ ì •ë¦¬ë¨');
            }
            
            const resultCheckInterval = setInterval(async () => {
                checkCount++;
                console.log(`ğŸ” ê²°ê³¼ í™•ì¸ ${checkCount}íšŒì°¨...`);
                
                try {
                    // ì‹¤ì‹œê°„ìœ¼ë¡œ ì„œë²„ì—ì„œ ìµœì‹  ê²Œì„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                    const response = await fetch('/api/team-games');
                    if (response.ok) {
                        const data = await response.json();
                        console.log('ğŸ“Š ì„œë²„ ê²Œì„ ë°ì´í„°:', data.games);
                        
                        const currentGame = data.games.find(game => 
                            game.gameNumber === selectedGame.gameNumber || 
                            game.number === selectedGame.gameNumber
                        );
                        
                        console.log('ğŸ¯ í˜„ì¬ ê²Œì„:', currentGame);
                        console.log('ğŸ¯ ì„ íƒëœ ê²Œì„ ë²ˆí˜¸:', selectedGame.gameNumber);
                        
                        if (currentGame) {
                            console.log('ğŸ“ ì˜ˆì¸¡ê²°ê³¼:', currentGame.predictionResult);
                            
                            if (currentGame.predictionResult && currentGame.predictionResult !== '') {
                                clearInterval(resultCheckInterval);
                                const waitModal = document.getElementById('waitingForResultModal');
                                if (waitModal) waitModal.remove();
                                
                                console.log('âœ… ì˜ˆì¸¡ê²°ê³¼ ê°ì§€:', currentGame.predictionResult);
                                console.log('ğŸ‘¤ ì‚¬ìš©ì ì„ íƒ:', window.selectedChoice);
                                
                                // ì‹¤ì œ ë°°íŒ… ë°ì´í„°ì—ì„œ ì‚¬ìš©ìì˜ ì„ íƒ í™•ì¸
                                const userChoice = window.selectedChoice;
                                const adminResult = currentGame.predictionResult;
                                
                                // ë” ì •í™•í•œ ë¹„êµë¥¼ ìœ„í•´ ê³µë°± ì œê±° ë° ì •ê·œí™”
                                const normalizedUserChoice = userChoice ? userChoice.trim() : '';
                                const normalizedAdminResult = adminResult ? adminResult.trim() : '';
                                
                                // ì„±ê³µ/ì‹¤íŒ¨ íŒì •
                                const isSuccess = normalizedUserChoice === normalizedAdminResult;
                                
                                console.log('ğŸ† ìŠ¹ë¦¬/ì‹¤íŒ¨ íŒì • (ì •ê·œí™”):', {
                                    userChoice: userChoice,
                                    adminResult: adminResult,
                                    normalizedUserChoice: normalizedUserChoice,
                                    normalizedAdminResult: normalizedAdminResult,
                                    isSuccess: isSuccess,
                                    userChoiceType: typeof userChoice,
                                    adminResultType: typeof adminResult
                                });
                                
                                if (isSuccess) {
                                    // ì„±ê³µ ì‹œ íšë“ í¬ì¸íŠ¸ ê³„ì‚° (ì‹¤ì œ ë¡œì§ì— ë§ê²Œ ìˆ˜ì •)
                                    const winAmount = selectedAmount * 2; // ì˜ˆì‹œ: 2ë°°
                                    console.log('ğŸ’° íšë“ í¬ì¸íŠ¸:', winAmount);
                                    showSuccessAndDonationModal(winAmount);
                                } else {
                                    // ì‹¤íŒ¨ì‹œ ë°”ë¡œ ë‹¤ìŒ ê²Œì„ìœ¼ë¡œ ì§„í–‰
                                    console.log('âŒ ì˜ˆì¸¡ ì‹¤íŒ¨');
                                    alert('ì˜ˆì¸¡ ì‹¤íŒ¨! ë‹¤ìŒ ê²Œì„ìœ¼ë¡œ ì§„í–‰í•©ë‹ˆë‹¤.');
                                    resetGameSelection();
                                }
                            }
                        } else {
                            console.log('âŒ í˜„ì¬ ê²Œì„ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                        }
                    } else {
                        console.log('âŒ ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜:', response.status);
                    }
                } catch (error) {
                    console.error('ê²°ê³¼ í™•ì¸ ì¤‘ ì˜¤ë¥˜:', error);
                }
                
                // íƒ€ì„ì•„ì›ƒ ì œê±° - ê´€ë¦¬ìê°€ ì˜ˆì¸¡ê²°ê³¼ë¥¼ ì…ë ¥í•  ë•Œê¹Œì§€ ë¬´í•œì • ëŒ€ê¸°
                // if (checkCount >= 60) {
                //     clearInterval(resultCheckInterval);
                //     console.log('â° ê²°ê³¼ ëŒ€ê¸° íƒ€ì„ì•„ì›ƒ');
                //     const waitModal = document.getElementById('waitingForResultModal');
                //     if (waitModal) waitModal.remove();
                //     alert('ê²°ê³¼ ëŒ€ê¸° ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                //     resetGameSelection();
                // }
            }, 1000); // 1ì´ˆë§ˆë‹¤ í™•ì¸
        }

        // ë°°íŒ… ê²°ê³¼ í™•ì¸
        async function checkBettingResult() {
            try {
                // ì„œë²„ì—ì„œ ìµœì‹  ê²Œì„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const response = await fetch(`/api/game/${selectedGame.date}/${selectedGame.gameNumber}`);
                const data = await response.json();
                
                if (data.success && data.game.predictionResult) {
                    const actualResult = data.game.predictionResult;
                    const isWin = actualResult === selectedChoice;
                    
                    if (isWin) {
                        // ìŠ¹ë¦¬
                        const winAmount = calculateWinAmount();
                        // ì„œë²„ ê¸°ì¤€ í¬ì¸íŠ¸ ì—…ë°ì´íŠ¸
                        currentUser.points += winAmount;
                        document.getElementById('userPoints').textContent = `${currentUser.points}í¬ì¸íŠ¸`;
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                        // ì„œë²„ì— ì¦‰ì‹œ ë™ê¸°í™”
                        await updateServerPoints(currentUser.points);

                        showWinModal(winAmount);
                    } else {
                        // ì‹¤íŒ¨
                        showLoseModal();
                    }
                } else {
                    console.log('ì•„ì§ ê²°ê³¼ê°€ ë‚˜ì˜¤ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ê²°ê³¼ í™•ì¸ ì˜¤ë¥˜:', error);
            }
        }

        // ìŠ¹ë¦¬ ê¸ˆì•¡ ê³„ì‚°
        function calculateWinAmount() {
            // ê¸°ë³¸ì ìœ¼ë¡œ ë°°íŒ… ê¸ˆì•¡ì˜ 4ë°° ë°˜í™˜ (ì˜ˆì‹œ)
            return selectedAmount * 4;
        }

        // ìŠ¹ë¦¬ ëª¨ë‹¬ í‘œì‹œ
        function showWinModal(winAmount) {
            showDonationModal(winAmount);
        }

        // ì‹¤íŒ¨ ëª¨ë‹¬ í‘œì‹œ
        function showLoseModal() {
            const modal = document.createElement('div');
            modal.id = 'loseResultModal';
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 text-center">
                    <h3 class="text-lg font-bold mb-4 text-red-400">ğŸ˜ ì•„ì‰½ë„¤ìš”!</h3>
                    <p class="text-gray-300 mb-6">ì´ë²ˆì—” ì˜ˆì¸¡ì´ ë§ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br>ë‹¤ìŒ ê¸°íšŒì— ë„ì „í•´ë³´ì„¸ìš”!</p>
                    
                    <button id="loseConfirmBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 rounded font-bold">
                        ê²Œì„ ì„ íƒìœ¼ë¡œ ëŒì•„ê°€ê¸°
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            document.getElementById('loseConfirmBtn').onclick = function() {
                document.body.removeChild(modal);
                resetGame(); // ê²Œì„ ì´ˆê¸°í™”
            };
        }

        // ê²Œì„ ì´ˆê¸°í™” (ì‹¤íŒ¨ í›„ ë‹¤ì‹œ ì‹œì‘)
        function resetGame() {
            window.selectedChoice = null;
            selectedGame = null;
            
            // ê²Œì„ ì„ íƒ ë²„íŠ¼ ì´ˆê¸°í™”
            document.querySelectorAll('.game-select-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600', 'border-blue-400');
                btn.classList.add('bg-green-600', 'border-green-500');
            });
            
            // ë°°íŒ… ì„ íƒ ì´ˆê¸°í™”
            const selectedBettingText = document.getElementById('selectedBettingText');
            const bettingSelectionBtn = document.getElementById('bettingSelectionBtn');
            if (selectedBettingText) {
                selectedBettingText.textContent = 'ë°°íŒ… ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”';
                selectedBettingText.className = 'font-bold text-gray-300';
            }
            if (bettingSelectionBtn) {
                bettingSelectionBtn.className = 'w-full p-3 bg-gray-700 rounded cursor-pointer hover:bg-gray-600 transition-colors text-left';
                bettingSelectionBtn.disabled = true;
                bettingSelectionBtn.classList.add('opacity-50', 'cursor-not-allowed');
                bettingSelectionBtn.classList.remove('cursor-pointer');
            }
            
            // ì˜ˆì¸¡í•˜ê¸° ë²„íŠ¼ ë¹„í™œì„±í™”
            const betBtn = document.getElementById('betBtn');
            betBtn.disabled = true;
            betBtn.classList.add('opacity-50', 'cursor-not-allowed');
            betBtn.classList.remove('cursor-pointer');
            
            // ê²½ê¸° ëª©ë¡ ë‹¤ì‹œ ë¡œë“œ
            loadSimpleGames();
        }

        // ëŒ€ê¸° ëª¨ë‹¬ í‘œì‹œ (bettingStopì´ 'ì¤‘ì§€'ì¼ ë•Œ)
        function showWaitingModal() {
            const modal = document.getElementById('waitingModal');
            if (modal) {
                modal.classList.remove('hidden');
                modal.style.display = 'flex';
                
                // 3ì´ˆ í›„ ìë™ìœ¼ë¡œ ë‹«ê¸°
                setTimeout(() => {
                    modal.style.display = 'none';
                    modal.classList.add('hidden');
                }, 3000);
            }
        }

        // ë°°íŒ… ì„ íƒ í…ìŠ¤íŠ¸ ë³€í™˜
        function getBettingChoiceText(choice) {
            const choices = {
                '1base': '1ë£¨',
                '2base': '2ë£¨', 
                '3base': '3ë£¨',
                'homerun': 'í™ˆëŸ°',
                'strikeout': 'ì‚¼ì§„',
                'out': 'ì•„ì›ƒ'
            };
            return choices[choice] || choice;
        }

        // ë°°íŒ… ìƒíƒœ í™•ì¸ ë° í‘œì‹œ í•¨ìˆ˜ (ìˆ˜ì •)
        let previousBettingStart = null; // ì´ì „ ë°°íŒ… ìƒíƒœ ì €ì¥
        
        async function checkBettingStatus() {
            if (!selectedGame) return;
            
            // ì´ë¯¸ ë°°íŒ…ì´ ì™„ë£Œëœ ê²½ìš° ìƒíƒœ í™•ì¸ ì¤‘ë‹¨
            if (isBetting) return;
            
            console.log('ğŸ”„ ë°°íŒ… ìƒíƒœ í™•ì¸ ì‹œì‘...');
            
            try {
            // ì„œë²„ì—ì„œ ìµœì‹  ë°°íŒ… ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
                const response = await fetch('/api/team-games');
                const data = await response.json();
                
                    console.log('ğŸ“Š ì„œë²„ ë°ì´í„°:', data);
                    if (data && data.games) {
                    // ìš´ì˜ìê°€ ì„ íƒí•œ í™œì„± ê²Œì„ ì°¾ê¸° (bettingStartê°€ 'ì‹œì‘'ì¸ ê²Œì„)
                    const activeGame = data.games.find(game => game.bettingStart === 'ì‹œì‘');
                    
                    // í˜„ì¬ ì„ íƒëœ ê²Œì„ì˜ ìƒíƒœ í™•ì¸
                        const currentGame = data.games.find(game => 
                            game.number === selectedGame.number || 
                            game.gameNumber === selectedGame.gameNumber ||
                            game._id === selectedGame._id ||
                            game.id === selectedGame.id
                        );
                        
                        console.log('ğŸ¯ í˜„ì¬ ê²Œì„:', currentGame);
                        
                        if (currentGame) {
                            // ë°°íŒ… ì‹œì‘ ìƒíƒœ ë³€ê²½ ê°ì§€
                            if (previousBettingStart !== 'ì‹œì‘' && currentGame.bettingStart === 'ì‹œì‘') {
                                console.log('ğŸ¤ ë°°íŒ… ì‹œì‘ ê°ì§€!');
                            
                            // ì„ íƒëœ ê²Œì„ ì •ë³´ ì—…ë°ì´íŠ¸
                            selectedGame.bettingStart = currentGame.bettingStart;
                            selectedGame.bettingStop = currentGame.bettingStop;
                            
                            // ë°°íŒ…ì„ íƒ í™œì„±í™”
                            enableBettingChoices();
                            enableBettingSelection();
                            enablePredictionButton();
                            
                                // ê¸‰í•œ ëª©ì†Œë¦¬ë¡œ ë‘ ë²ˆ ë°˜ë³µ
                                speakText('ì´ì œë¶€í„° ë°°íŒ…ì„ íƒì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 1.3);
                                setTimeout(() => {
                                    speakText('ì´ì œë¶€í„° ë°°íŒ…ì„ íƒì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 1.3);
                                }, 2000);
                            }
                            
                            // ë°°íŒ… ì¤‘ì§€ ìƒíƒœ ë³€ê²½ ê°ì§€
                            if (previousBettingStart !== 'ì¤‘ì§€' && currentGame.bettingStart === 'ì¤‘ì§€') {
                                console.log('ğŸ¤ ë°°íŒ… ì¤‘ì§€ ê°ì§€!');
                            
                            // ì„ íƒëœ ê²Œì„ ì •ë³´ ì—…ë°ì´íŠ¸
                            selectedGame.bettingStart = currentGame.bettingStart;
                            selectedGame.bettingStop = currentGame.bettingStop;
                            
                            // ë°°íŒ…ì„ íƒ ë¹„í™œì„±í™”
                            disableBettingChoices();
                            disableBettingSelection();
                            disablePredictionButton();
                            
                                // ì—„ê²©í•œ ëª©ì†Œë¦¬ë¡œ ì„¸ ë²ˆ ë°˜ë³µ
                                speakText('ì´ì œë¶€í„° ë°°íŒ…ì„ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 0.8);
                                setTimeout(() => {
                                    speakText('ì´ì œë¶€í„° ë°°íŒ…ì„ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 0.8);
                                }, 2000);
                                setTimeout(() => {
                                    speakText('ì´ì œë¶€í„° ë°°íŒ…ì„ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 0.8);
                                }, 4000);
                            }
                            
                        // ê²Œì„ì´ ì¢…ë£Œ/ëŒ€ê¸°/ì¢…ë£Œ ìƒíƒœë©´ ìë™ ì „í™˜í•˜ì§€ ì•ŠìŒ: UIë§Œ ë¹„í™œì„±í™”
                        if (currentGame.progressStatus === 'ê²½ê¸°ì¢…ë£Œ' || 
                            currentGame.bettingStart === 'ì¢…ë£Œ' || 
                            currentGame.bettingStart === 'ëŒ€ê¸°') {
                            disableBettingChoices();
                            disableBettingSelection();
                            disablePredictionButton();
                        } else {
                            // ì´ì „ ìƒíƒœ ì—…ë°ì´íŠ¸
                            previousBettingStart = currentGame.bettingStart;
                            
                            // ì„ íƒëœ ê²Œì„ ì •ë³´ ì—…ë°ì´íŠ¸
                            selectedGame.bettingStart = currentGame.bettingStart;
                            selectedGame.bettingStop = currentGame.bettingStop;
                            
                            console.log('âœ… ê²Œì„ ì •ë³´ ì—…ë°ì´íŠ¸:', {
                                bettingStart: selectedGame.bettingStart,
                                bettingStop: selectedGame.bettingStop
                            });
                            
                            // ê²Œì„ ìƒíƒœì— ë”°ë¥¸ UI ì—…ë°ì´íŠ¸
                            if (currentGame.bettingStart === 'ì‹œì‘') {
                                // ë°°íŒ… ê°€ëŠ¥í•œ ìƒíƒœ
                            enableBettingChoices();
                            enableBettingSelection();
                            enablePredictionButton();
                            } else if (currentGame.bettingStart === 'ì¤‘ì§€' || currentGame.bettingStart === 'ì¢…ë£Œ') {
                                // ë°°íŒ… ë¶ˆê°€ëŠ¥í•œ ìƒíƒœ - ë‹¤ìŒ ê²Œì„ìœ¼ë¡œ ë„˜ì–´ê°€ê¸°
                                console.log('ğŸ”„ í˜„ì¬ ê²Œì„ì´ ë¹„í™œì„± ìƒíƒœì…ë‹ˆë‹¤. ë‹¤ìŒ ê²Œì„ì„ ì°¾ìŠµë‹ˆë‹¤.');
                                
                                const nextGame = data.games.find(game => {
                                    const currentNum = currentGame.gameNumber || currentGame.number;
                                    const nextNum = game.gameNumber || game.number;
                                    return nextNum > currentNum && game.bettingStart === 'ì‹œì‘';
                                });
                                
                                if (nextGame) {
                                    console.log('ğŸ¯ ë‹¤ìŒ í™œì„± ê²Œì„ ë°œê²¬:', nextGame);
                                    
                                    // ì´ì „ ê²Œì„ì—ì„œ ì‚¬ìš©ì ë°°íŒ… ë°ì´í„° ì´ˆê¸°í™”
                                    if (currentUser && currentUser.userId && selectedGame) {
                                        try {
                                            console.log('ğŸ§¹ ì´ì „ ê²Œì„ ë°°íŒ… ë°ì´í„° ì´ˆê¸°í™” ì¤‘...');
                                            const response = await fetch('/api/clear-user-betting', {
                                                method: 'POST',
                                                headers: { 'Content-Type': 'application/json' },
                                                body: JSON.stringify({
                                                    userId: currentUser.userId,
                                                    gameNumber: selectedGame.gameNumber || selectedGame.number
                                                })
                                            });
                                            
                                            const clearData = await response.json();
                                            if (clearData.success) {
                                                console.log('âœ… ì´ì „ ê²Œì„ ë°°íŒ… ë°ì´í„° ì´ˆê¸°í™” ì™„ë£Œ');
                                            } else {
                                                console.log('âš ï¸ ì´ì „ ê²Œì„ ë°°íŒ… ë°ì´í„° ì´ˆê¸°í™” ì‹¤íŒ¨:', clearData.message);
                                            }
                                        } catch (error) {
                                            console.error('âŒ ì´ì „ ê²Œì„ ë°°íŒ… ë°ì´í„° ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                                        }
                                    }
                                    
                                    selectedGame = nextGame;
                                    previousBettingStart = nextGame.bettingStart;
                                    
                                    resetBettingSelection();
                                    
                                    speakText(`ë‹¤ìŒ ê²½ê¸° ${nextGame.gameNumber || nextGame.number}ê²½ê¸°ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.`, 1.0);
                                } else {
                                    // ë‹¤ìŒ ê²Œì„ì´ ì—†ìœ¼ë©´ ì²« ë²ˆì§¸ ê²Œì„ìœ¼ë¡œ
                                    const firstActiveGame = data.games.find(game => game.bettingStart === 'ì‹œì‘');
                                    if (firstActiveGame) {
                                        // ì´ì „ ê²Œì„ì—ì„œ ì‚¬ìš©ì ë°°íŒ… ë°ì´í„° ì´ˆê¸°í™”
                                        if (currentUser && currentUser.userId && selectedGame) {
                                            try {
                                                console.log('ğŸ§¹ ì´ì „ ê²Œì„ ë°°íŒ… ë°ì´í„° ì´ˆê¸°í™” ì¤‘...');
                                                const response = await fetch('/api/clear-user-betting', {
                                                    method: 'POST',
                                                    headers: { 'Content-Type': 'application/json' },
                                                    body: JSON.stringify({
                                                        userId: currentUser.userId,
                                                        gameNumber: selectedGame.gameNumber || selectedGame.number
                                                    })
                                                });
                                                
                                                const clearData = await response.json();
                                                if (clearData.success) {
                                                    console.log('âœ… ì´ì „ ê²Œì„ ë°°íŒ… ë°ì´í„° ì´ˆê¸°í™” ì™„ë£Œ');
                                                } else {
                                                    console.log('âš ï¸ ì´ì „ ê²Œì„ ë°°íŒ… ë°ì´í„° ì´ˆê¸°í™” ì‹¤íŒ¨:', clearData.message);
                                                }
                                            } catch (error) {
                                                console.error('âŒ ì´ì „ ê²Œì„ ë°°íŒ… ë°ì´í„° ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                                            }
                                        }
                                        
                                        selectedGame = firstActiveGame;
                                        previousBettingStart = firstActiveGame.bettingStart;
                                        
                                        resetBettingSelection();
                                        
                                        speakText(`ì²« ë²ˆì§¸ ê²½ê¸° ${firstActiveGame.gameNumber || firstActiveGame.number}ê²½ê¸°ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.`, 1.0);
                                    }
                                }
                            }
                        }
                    }
                }
            } catch (error) {
                    console.error('ë°°íŒ… ìƒíƒœ í™•ì¸ ì˜¤ë¥˜:', error);
            }
        }

        // ë°°íŒ… ì„ íƒ ì´ˆê¸°í™” í•¨ìˆ˜
        async function resetBettingSelection() {
            console.log('ğŸ”„ ë°°íŒ… ì„ íƒ ì´ˆê¸°í™” ì‹œì‘...');
            
            // ì„ íƒëœ ë°°íŒ… ìœ í˜• ì´ˆê¸°í™”
            window.selectedChoice = null;
            selectedChoice = null;
            selectedAmount = 100;
            
            // ë°°íŒ… ì„ íƒ í…ìŠ¤íŠ¸ ì´ˆê¸°í™”
            const selectedBettingText = document.getElementById('selectedBettingText');
            if (selectedBettingText) {
                selectedBettingText.textContent = 'ë°°íŒ… ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”';
                selectedBettingText.className = 'font-bold text-gray-300';
            }
            
            // ë°°íŒ… ì„ íƒ ë²„íŠ¼ ì´ˆê¸°í™”
            const bettingSelectionBtn = document.getElementById('bettingSelectionBtn');
            if (bettingSelectionBtn) {
                bettingSelectionBtn.className = 'w-full p-3 bg-gray-700 rounded cursor-pointer hover:bg-gray-600 transition-colors text-left';
                bettingSelectionBtn.disabled = true;
                bettingSelectionBtn.classList.add('opacity-50', 'cursor-not-allowed');
                bettingSelectionBtn.classList.remove('cursor-pointer');
            }
            
            // ì˜ˆì¸¡í•˜ê¸° ë²„íŠ¼ ë¹„í™œì„±í™”
            const betBtn = document.getElementById('betBtn');
            if (betBtn) {
                betBtn.disabled = true;
                betBtn.classList.add('opacity-50', 'cursor-not-allowed');
                betBtn.classList.remove('cursor-pointer');
            }
            
            // ë°°íŒ… ì„ íƒ ë²„íŠ¼ë“¤ ì´ˆê¸°í™”
            document.querySelectorAll('.bet-choice-btn').forEach(btn => {
                btn.classList.remove('bg-blue-500', 'bg-blue-600');
                btn.classList.add('bg-gray-600');
            });
            
            console.log('âœ… ë°°íŒ… ì„ íƒ ì´ˆê¸°í™” ì™„ë£Œ');
        }

        // ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜
        async function logout() {
            try {
                const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                console.log('ğŸ” ë¡œê·¸ì•„ì›ƒ - í˜„ì¬ ì‚¬ìš©ì ì •ë³´:', currentUser);
                
                // userId ë˜ëŠ” id í•„ë“œ í™•ì¸
                const userId = currentUser.userId || currentUser.id;
                
                if (userId) {
                    console.log('ğŸ” ë¡œê·¸ì•„ì›ƒ ìš”ì²­:', { userId });
                    
                    // ì„œë²„ì— ë¡œê·¸ì•„ì›ƒ ìš”ì²­
                    const logoutUrl = '/api/logout';
                    const response = await fetch(logoutUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            userId: userId
                        })
                    });
                    
                    const data = await response.json();
                    console.log('ğŸ” ë¡œê·¸ì•„ì›ƒ ì‘ë‹µ:', data);
                } else {
                    console.log('ğŸ” ë¡œê·¸ì•„ì›ƒ: userIdê°€ ì—†ìŒ, ë°”ë¡œ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬');
                }
            } catch (error) {
                console.error('âŒ ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', error);
            } finally {
                // localStorage ì‚­ì œ ë° í˜ì´ì§€ ì´ë™
            localStorage.removeItem('currentUser');
            window.location.href = '/login.html';
            }
        }

        // ë°°íŒ… ì„ íƒ ë²„íŠ¼ ì„¤ì • í•¨ìˆ˜
        function setupBetChoiceButtons() {
            const betChoiceButtons = document.querySelectorAll('.bet-choice-btn');
            betChoiceButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // ë°°íŒ… ìƒíƒœ í™•ì¸ - ë¹„í™œì„±í™”ëœ ê²½ìš° í´ë¦­ ë¬´ì‹œ
                    if (this.disabled || this.classList.contains('opacity-50')) {
                        showWaitingModal();
                        return;
                    }
                    
                    // ëª¨ë“  ë²„íŠ¼ì—ì„œ ì„ íƒ ìƒíƒœ ì œê±°
                    betChoiceButtons.forEach(btn => {
                        btn.classList.remove('bg-blue-500', 'bg-blue-600');
                        btn.classList.add('bg-gray-600');
                    });
                    
                    // í´ë¦­ëœ ë²„íŠ¼ì— ì„ íƒ ìƒíƒœ ì¶”ê°€
                    this.classList.remove('bg-gray-600');
                    this.classList.add('bg-blue-500');
                    
                    // ì„ íƒëœ ë°°íŒ… ìœ í˜• ì €ì¥
                    selectedBetChoice = this.dataset.choice;
                    console.log('ë°°íŒ… ì„ íƒ:', selectedBetChoice);
                });
            });
        }

        // ëŒ€ê¸° ëª¨ë‹¬ í‘œì‹œ í•¨ìˆ˜
        function showWaitingModal() {
            document.getElementById('waitingModal').classList.remove('hidden');
            
            // 3ì´ˆ í›„ ìë™ìœ¼ë¡œ ëª¨ë‹¬ ë‹«ê¸°
            setTimeout(() => {
                document.getElementById('waitingModal').classList.add('hidden');
            }, 3000);
        }

        // ë°°íŒ… UI ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateBettingUIState(isActive) {
            const betChoiceButtons = document.querySelectorAll('.bet-choice-btn');
            const betBtn = document.getElementById('betBtn');
            
            if (isActive) {
                // ë°°íŒ… í™œì„±í™” - ë²„íŠ¼ë“¤ í™œì„±í™”
                betChoiceButtons.forEach(btn => {
                    btn.disabled = false;
                    btn.classList.remove('opacity-50', 'cursor-not-allowed');
                    btn.classList.add('cursor-pointer');
                });
                
                if (betBtn) {
                    betBtn.disabled = false;
                    betBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    betBtn.classList.add('cursor-pointer');
                }
            } else {
                // ë°°íŒ… ë¹„í™œì„±í™” - ë²„íŠ¼ë“¤ ë¹„í™œì„±í™”
                betChoiceButtons.forEach(btn => {
                    btn.disabled = true;
                    btn.classList.add('opacity-50', 'cursor-not-allowed');
                    btn.classList.remove('cursor-pointer', 'bg-blue-500');
                    btn.classList.add('bg-gray-600');
                });
                
                if (betBtn) {
                    betBtn.disabled = true;
                    betBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    betBtn.classList.remove('cursor-pointer');
                }
                
                // ì„ íƒ ì´ˆê¸°í™”
                selectedBetChoice = null;
            }
        }

        // ë°°íŒ… ì²˜ë¦¬ í•¨ìˆ˜
        async function handleBetting() {
            // ì˜ˆì¸¡í•˜ê¸° ë²„íŠ¼ì´ ë¹„í™œì„±í™”ë©´ ì•„ë¬´ ë™ì‘ë„ í•˜ì§€ ì•ŠìŒ
            const betBtn = document.getElementById('betBtn');
            if (betBtn.disabled) return;
            if (!window.selectedChoice) {
                alert('ë°°íŒ… ìœ í˜•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            if (!currentUser || currentUser.isGuest) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }
            if (!selectedGame) {
                alert('ê²½ê¸°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            console.log('ğŸ¯ ë°°íŒ… ì²˜ë¦¬ ì‹œì‘:', {
                selectedGame: selectedGame.gameNumber || selectedGame.number,
                selectedChoice: window.selectedChoice,
                bettingStart: selectedGame.bettingStart,
                bettingStop: selectedGame.bettingStop
            });
            if (selectedGame.bettingStart !== 'ì‹œì‘') {
                alert('ì•„ì§ ë°°íŒ…ì´ ì‹œì‘ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }
            if (selectedGame.bettingStop === 'ì¤‘ì§€') {
                showWaitingModal();
                return;
            }
            if (currentUser.points < selectedAmount) {
                alert('í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.');
                return;
            }
            showBettingConfirmModal();
        }

        // ì„ íƒëœ ê²½ê¸° ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        async function getSelectedGame() {
            if (!currentUser || !currentUser.userId) {
                return null;
            }
            
            try {
                const selectionResponse = await fetch(`/api/game-selection/${currentUser.userId}`);
                if (selectionResponse.ok) {
                    const selectionData = await selectionResponse.json();
                    if (selectionData.selection) {
                        // ê²½ê¸° ëª©ë¡ì—ì„œ ì„ íƒëœ ê²½ê¸° ì°¾ê¸°
                        const dailyGamesResponse = await fetch('/api/daily-games');
                        if (dailyGamesResponse.ok) {
                            const gamesData = await dailyGamesResponse.json();
                            const selectedGameData = gamesData.games.find(game => 
                                game.number === selectionData.selection.gameNumber
                            );
                            if (selectedGameData) {
                                return {
                                    gameNumber: selectedGameData.number,
                                    homeTeam: selectedGameData.homeTeam,
                                    awayTeam: selectedGameData.awayTeam
                                };
                            }
                        }
                    }
                }
            } catch (error) {
                console.error('ì„ íƒëœ ê²½ê¸° ì •ë³´ ì¡°íšŒ ì˜¤ë¥˜:', error);
            }
            return null;
        }

        // ìˆ˜ë™ ë°°íŒ… ì„¸ì…˜ ìƒì„± í•¨ìˆ˜ (í…ŒìŠ¤íŠ¸ìš©)
        async function createBettingSession() {
            try {
                // ê³µí†µ í•¨ìˆ˜ ì‚¬ìš©í•˜ì—¬ í•œêµ­ ì‹œê°„ ê³„ì‚°
                const today = getKoreanDate();
        
        const response = await fetch('/api/betting/create-session', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        date: today,
                        gameNumber: 1,
                        inning: 1
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    alert('ë°°íŒ… ì„¸ì…˜ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
                } else {
                    alert('ë°°íŒ… ì„¸ì…˜ ìƒì„± ì‹¤íŒ¨: ' + data.message);
                }
            } catch (error) {
                console.error('ë°°íŒ… ì„¸ì…˜ ìƒì„± ì˜¤ë¥˜:', error);
                alert('ë°°íŒ… ì„¸ì…˜ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë°°íŒ… ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜
        async function showBettingResult() {
            if (!isBetting) return;
            
            try {
                const selectedGame = await getSelectedGame();
                if (!selectedGame) {
                    alert('ì„ íƒëœ ê²½ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                // ê³µí†µ í•¨ìˆ˜ ì‚¬ìš©í•˜ì—¬ í•œêµ­ ì‹œê°„ ê³„ì‚°
                const today = getKoreanDate();
                
                // ì„œë²„ì—ì„œ ë°°íŒ… ê²°ê³¼ ì¡°íšŒ
                const response = await fetch(`/api/betting/results?date=${today}&gameNumber=${selectedGame.gameNumber}`);
                const data = await response.json();
                
                // ì‚¬ìš©ìì˜ ë°°íŒ… ê²°ê³¼ ì°¾ê¸°
                const myResult = data.bets.find(b => b.memberId === currentUser.userId);
                
                if (myResult) {
                    if (myResult.isWinner) {
                        // ìŠ¹ë¦¬ ì‹œ í¬ì¸íŠ¸ ì¶”ê°€
                        currentUser.points += myResult.winAmount;
                        document.getElementById('userPoints').textContent = `${currentUser.points}`;
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    if (currentUser.isGuest) {
                        showGuestWinModal();
                    } else {
                            showDonationModal(myResult.winAmount); // ìŠ¹ë¦¬ í¬ì¸íŠ¸ë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ì „ë‹¬
                        document.getElementById('donationOptions').style.display = 'block';
                    }
                } else {
                    showLoseModal();
                    }
                } else {
                    alert('ë°°íŒ… ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.');
                }

                // ë°°íŒ… ë²„íŠ¼ ë³µì›
                document.getElementById('betBtn').style.display = 'block';
                document.getElementById('resultBtn').style.display = 'none';
                
                // ë°°íŒ… ìƒíƒœ ì´ˆê¸°í™”
                isBetting = false;


            } catch (error) {
                console.error('ë°°íŒ… ê²°ê³¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:', error);
                alert('ë°°íŒ… ê²°ê³¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }



        // ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤ì€ ê·¸ëŒ€ë¡œ ìœ ì§€
        function showGuestWinModal() {
            document.getElementById('guestWinModal').style.display = 'flex';
        }

        function showDonationModal(winPoints = 0) {
            // ê¸°ë¶€ ëª¨ë‹¬ í‘œì‹œ ìŒì„± ì•ˆë‚´
            speakText('ê¸°ë¶€ ëª¨ë‹¬ì´ í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤. ì›í•˜ëŠ” ê¸°ë¶€ ë¹„ìœ¨ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
            
            const modal = document.getElementById('donationModal');
            if (modal) {
                modal.classList.remove('hidden');
                
                // ê¸°ë¶€ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
                const donationBtns = modal.querySelectorAll('.donation-btn');
                donationBtns.forEach(btn => {
                    btn.addEventListener('click', function() {
                        // ëª¨ë“  ë²„íŠ¼ì—ì„œ ì„ íƒ ìƒíƒœ ì œê±°
                        donationBtns.forEach(b => b.classList.remove('selected'));
                        // í´ë¦­ëœ ë²„íŠ¼ì— ì„ íƒ ìƒíƒœ ì¶”ê°€
                        this.classList.add('selected');
                        
                        const percent = this.getAttribute('data-percent');
                    
                    // ê¸°ë¶€ í™•ì¸ ì„¹ì…˜ í‘œì‹œ
                        const confirmSection = modal.querySelector('#donationConfirm');
                        const selectedPercentSpan = modal.querySelector('#selectedPercent');
                        if (confirmSection && selectedPercentSpan) {
                            selectedPercentSpan.textContent = `${percent}%`;
                            confirmSection.classList.remove('hidden');
                        }
                        
                        // ê¸°ë¶€í•˜ê¸° ë²„íŠ¼ ì—…ë°ì´íŠ¸
                        const donateBtn = document.getElementById('donateBtn');
                        if (donateBtn) {
                            donateBtn.onclick = function() {
                                handleDonation(parseInt(percent));
                            };
                        }
                    });
                });
                
                // ê¸°ë¶€í•˜ì§€ ì•Šê¸° ë²„íŠ¼
                const donateNoBtn = modal.querySelector('#donateNoBtn');
                if (donateNoBtn) {
                    donateNoBtn.onclick = function() {
                        speakText('ê¸°ë¶€í•˜ì§€ ì•Šê³  ê²Œì„ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.');
                        closeDonationModal();
                        // ê¸°ë¶€í•˜ì§€ ì•Šê³  ê²Œì„ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                        showSelectedGameOnly();
                        enableBettingSelection();
                        enableBettingPoints();
                    };
                }
                
                // ê¸°ë¶€ í™•ì¸ ë²„íŠ¼ë“¤
                const confirmYesBtn = modal.querySelector('#confirmYesBtn');
                const confirmNoBtn = modal.querySelector('#confirmNoBtn');
                
                if (confirmYesBtn) {
                    confirmYesBtn.onclick = function() {
                        const selectedBtn = modal.querySelector('.donation-btn.selected');
                        if (selectedBtn) {
                            const percent = selectedBtn.getAttribute('data-percent');
                            handleDonation(parseInt(percent));
                        }
                    };
                }
                
                if (confirmNoBtn) {
                    confirmNoBtn.onclick = function() {
                        speakText('ê¸°ë¶€ë¥¼ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.');
                        // ê¸°ë¶€ í™•ì¸ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
                        const confirmSection = modal.querySelector('#donationConfirm');
                        if (confirmSection) {
                            confirmSection.classList.add('hidden');
                        }
                        // ì„ íƒ ìƒíƒœ ì œê±°
                        donationBtns.forEach(b => b.classList.remove('selected'));
                    };
                }
                
                // ê¸°ë³¸ì ìœ¼ë¡œ 10% ì„ íƒ
                const defaultBtn = modal.querySelector('[data-percent="10"]');
                if (defaultBtn) {
                    defaultBtn.click();
                }
            }
        }

        function showLoseModal() {
            document.getElementById('loseModal').style.display = 'flex';
        }

        // ëª¨ë‹¬ ë‹«ê¸° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
        document.getElementById('donateNoBtn').addEventListener('click', () => {
            document.getElementById('donationModal').style.display = 'none';
            // ê¸°ë¶€í•˜ì§€ ì•Šì„ ê²½ìš° ì„œë²„ì— ìµœì¢… í¬ì¸íŠ¸ë§Œ ì—…ë°ì´íŠ¸
            if (!currentUser.isGuest) {
                updateServerPoints(currentUser.points);
            }
        });

        document.getElementById('loseConfirmBtn').addEventListener('click', () => {
            document.getElementById('loseModal').style.display = 'none';
        });

        document.getElementById('guestWinConfirmBtn').addEventListener('click', () => {
            document.getElementById('guestWinModal').style.display = 'none';
        });

        // ì„œë²„ í¬ì¸íŠ¸ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ì„œë²„ê°€ ê¸°ì¤€)
        async function updateServerPoints(points) {
            try {
                const response = await fetch('/api/update-points', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        userId: currentUser.userId,
                        points: points
                    })
                });

                const data = await response.json();
                if (data.success) {
                    // ì„œë²„ì—ì„œ ì—…ë°ì´íŠ¸ëœ í¬ì¸íŠ¸ë¡œ í´ë¼ì´ì–¸íŠ¸ ë™ê¸°í™”
                    currentUser.points = data.points;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    document.getElementById('userPoints').textContent = `${currentUser.points}í¬ì¸íŠ¸`;
                    console.log('âœ… ì„œë²„ ê¸°ì¤€ í¬ì¸íŠ¸ ë™ê¸°í™” ì™„ë£Œ:', currentUser.points);
                } else {
                    console.error('í¬ì¸íŠ¸ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', data.message);
                }
            } catch (error) {
                console.error('í¬ì¸íŠ¸ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
            }
        }

        // ê¸°ë¶€ ì²˜ë¦¬ í•¨ìˆ˜ (í†µí•©ëœ ë²„ì „)
        async function processDonation(percentage) {
            try {
                console.log('ğŸ¯ ê¸°ë¶€ ì²˜ë¦¬ ì‹œì‘:', { percentage });
                
                // ì„ íƒëœ ê²Œì„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ì „ì—­ ìƒíƒœ ì‚¬ìš©)
                const selectedGame = window.selectedGame;
                if (!selectedGame || !selectedGame.gameNumber) {
                    speakText('ê²Œì„ ì •ë³´ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ê²Œì„ì„ ë‹¤ì‹œ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    alert('ê²Œì„ ì •ë³´ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ê²Œì„ì„ ë‹¤ì‹œ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                // ì˜¤ëŠ˜ ë‚ ì§œ ê³„ì‚°
                const today = getKoreanDate();
                
                // predictionResultê°€ ì—†ìœ¼ë©´ ì„œë²„ì—ì„œ ìµœì‹  ê²Œì„ ì •ë³´ë¥¼ ê°€ì ¸ì™€ì„œ ì„¤ì •
                let actualResult = '';
                try {
                    const gameResponse = await fetch(`/api/game/${today}/${selectedGame.gameNumber}`);
                    const gameData = await gameResponse.json();
                    if (gameData.success && gameData.game.predictionResult) {
                        actualResult = gameData.game.predictionResult;
                    } else {
                        speakText('ê²Œì„ ê²°ê³¼ê°€ ì•„ì§ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                        alert('ê²Œì„ ê²°ê³¼ê°€ ì•„ì§ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                        return;
                    }
                } catch (error) {
                    console.error('ê²Œì„ ì •ë³´ ì¡°íšŒ ì˜¤ë¥˜:', error);
                    speakText('ê²Œì„ ì •ë³´ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    alert('ê²Œì„ ì •ë³´ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    return;
                }
                
                // ì„œë²„ì—ì„œ ì‹¤ì œ ìŠ¹ë¦¬ í¬ì¸íŠ¸ ê³„ì‚°
                const pointsResponse = await fetch('/api/betting/calculate-game-winners', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        gameNumber: selectedGame.gameNumber,
                        actualResult: actualResult,
                        date: today
                    })
                });
                
                const pointsData = await pointsResponse.json();
                const pointsPerWinner = pointsData.data.pointsPerWinner || 0;
                const totalWinAmount = calculateWinnings(pointsPerWinner);
                const originalBet = 100; // ì›ê¸ˆ (ê¸°ë¶€ ëŒ€ìƒ ì•„ë‹˜)
                const winningBonus = pointsPerWinner; // ìŠ¹ë¦¬ìˆ˜ë‹¹ë§Œ ê¸°ë¶€ ëŒ€ìƒ
                const calculatedDonationAmount = calculateDonation(winningBonus, percentage);
                
                // í˜¼ìì„œ ìŠ¹ë¦¬í•œ ê²½ìš° ê°ì§€
                const totalUniqueUsers = pointsData.data.totalUniqueUsers || 1;
                const winnerCount = pointsData.data.winnerCount || 1;
                
                if (totalUniqueUsers === 1 && winnerCount === 1) {
                    console.log('ğŸ¯ í˜¼ìì„œ ìŠ¹ë¦¬ ê°ì§€ - ê¸°ë¶€ ëª¨ë‹¬ ëŒ€ì‹  ì•ˆë‚´ ëª¨ë‹¬ í‘œì‹œ');
                    showSoloWinModal();
                    return; // ê¸°ë¶€ ì²˜ë¦¬ ì¤‘ë‹¨
                }
                
                console.log('ğŸ’° ê¸°ë¶€ ê³„ì‚°:', {
                    ì›ê¸ˆ: originalBet,
                    ìŠ¹ë¦¬ìˆ˜ë‹¹: winningBonus,
                    ì´íšë“: totalWinAmount,
                    ê¸°ë¶€ë¹„ìœ¨: percentage,
                    ê¸°ë¶€ê¸ˆì•¡: calculatedDonationAmount,
                    ê¸°ë¶€í›„ë°›ëŠ”í¬ì¸íŠ¸: totalWinAmount - calculatedDonationAmount
                });
                
                // ì‹¤ì œ ê¸°ë¶€ API í˜¸ì¶œ
                const response = await fetch('/api/donation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        userId: currentUser.userId,
                        userName: currentUser.name,
                        donationAmount: calculatedDonationAmount,
                        percentage: percentage
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    // ì„œë²„ì—ì„œ ì—…ë°ì´íŠ¸ëœ í¬ì¸íŠ¸ë¡œ ì‚¬ìš©ì ì •ë³´ ê°±ì‹ 
                    currentUser.points = data.data.remainingPoints;
                    document.getElementById('userPoints').textContent = `${currentUser.points}í¬ì¸íŠ¸`;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    // ê¸°ë¶€ ì™„ë£Œ ìŒì„± ì•ˆë‚´
                    speakText(`${percentage}í¼ì„¼íŠ¸ ê¸°ë¶€ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ${calculatedDonationAmount}í¬ì¸íŠ¸ë¥¼ ê¸°ë¶€í•˜ì…¨ìŠµë‹ˆë‹¤.`);
                    
                    // ê¸°ë¶€ ëª¨ë‹¬ ë‹«ê¸°
                    document.getElementById('donationModal').style.display = 'none';
                    document.getElementById('donationConfirm').classList.add('hidden');
                    
                    // ê¸°ë¶€ ì™„ë£Œ ëª¨ë‹¬ í‘œì‹œ
                    showDonationCompleteModal(calculatedDonationAmount, percentage);
                    
                    // ê¸°ë¶€ ì™„ë£Œ í›„ ë°°íŒ… ì„ íƒ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸° (ê²Œì„ ì„ íƒ ìœ ì§€)
                    try {
                        if (selectedGame) {
                            console.log('ğŸ¯ ê¸°ë¶€ ì™„ë£Œ í›„ ê²Œì„ í™”ë©´ ì—…ë°ì´íŠ¸:', selectedGame);
                            showSelectedGameOnly(
                                selectedGame.gameNumber,
                                selectedGame.matchup || `${selectedGame.homeTeam || ''} vs ${selectedGame.awayTeam || ''}`,
                                selectedGame
                            );
                        } else {
                            console.warn('âš ï¸ selectedGameì´ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.');
                        }
                    } catch (error) {
                        console.error('âŒ ê²Œì„ í™”ë©´ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
                    }
                    enableBettingSelection();
                    enableBettingPoints();
                } else {
                    speakText('ê¸°ë¶€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                    alert('ê¸°ë¶€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + data.message);
                }
            } catch (error) {
                console.error('ê¸°ë¶€ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                alert('ê¸°ë¶€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ê³µí†µ í•œêµ­ ì‹œê°„ ê³„ì‚° í•¨ìˆ˜
        function getKoreanDate() {
            const now = new Date();
            const koreaTime = new Date(now.getTime() + (9 * 60 * 60 * 1000)); // UTC+9
            return koreaTime.getFullYear().toString() + 
                   String(koreaTime.getMonth() + 1).padStart(2, '0') + 
                   String(koreaTime.getDate()).padStart(2, '0');
        }

        // í˜¼ìì„œ ìŠ¹ë¦¬ ì‹œ ì•ˆë‚´ ëª¨ë‹¬ í‘œì‹œ í•¨ìˆ˜
        function showSoloWinModal() {
            const modal = document.getElementById('soloWinModal');
            modal.style.display = 'flex';
            
            // ì¹œêµ¬ ì´ˆëŒ€ ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('inviteFriendsBtn').onclick = function() {
                window.location.href = '/invite.html';
            };
            
            // ë‹¤ìŒ ê²Œì„ ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('nextGameBtn').onclick = function() {
                modal.style.display = 'none';
                resetGame(); // ê²Œì„ ì´ˆê¸°í™”í•˜ê³  ë‹¤ì‹œ ì‹œì‘
            };
            
            // ìŒì„± ì•ˆë‚´
            speakText('í˜¼ìì„œ ê²Œì„í•˜ì…¨êµ°ìš”. ì´ ê²Œì„ì€ ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜ ì¦ê¸°ëŠ” ê²Œì„ì…ë‹ˆë‹¤.');
        }

        // ê¸°ë¶€ ì™„ë£Œ ëª¨ë‹¬ í‘œì‹œ í•¨ìˆ˜
        function showDonationCompleteModal(donationAmount, percentage) {
            const modal = document.getElementById('donationCompleteModal');
            const message = document.getElementById('donationCompleteMessage');
            
            message.textContent = `${percentage}% (${donationAmount}í¬ì¸íŠ¸) ê¸°ë¶€ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤!`;
            modal.style.display = 'flex';
            
            // ê¸°ë¶€ ì™„ë£Œ ìŒì„± ì•ˆë‚´
            speakText('ê¸°ë¶€ ì™„ë£Œ ëª¨ë‹¬ì´ í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤. ì›í•˜ëŠ” ê¸°ë¶€ ë¹„ìœ¨ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
            
            // í™•ì¸ ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('donationCompleteBtn').onclick = function() {
                modal.style.display = 'none';
                
                // ê²Œì„ ì´ˆê¸°í™”í•˜ê³  ë‹¤ì‹œ ì‹œì‘
                resetGame();
            };
        }

        // ê¸°ë¶€ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.querySelectorAll('.donation-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const percentage = parseInt(btn.dataset.percent);
                document.getElementById('selectedPercent').textContent = `${percentage}%`;
                document.getElementById('donationConfirm').classList.remove('hidden');
            });
        });

        // ê¸°ë¶€ í™•ì¸ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('confirmYesBtn').addEventListener('click', () => {
            const percentage = parseInt(document.querySelector('.donation-btn.selected')?.dataset.percent || '10');
            handleDonation(percentage);
        });

        document.getElementById('confirmNoBtn').addEventListener('click', () => {
            document.getElementById('donationConfirm').classList.add('hidden');
        });

        // ê¸°ë¶€ ì™„ë£Œ ëª¨ë‹¬ ë‹«ê¸° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('donationCompleteBtn').addEventListener('click', () => {
            document.getElementById('donationCompleteModal').style.display = 'none';
        });

        // í˜„ì¬ ë‚ ì§œ í‘œì‹œ í•¨ìˆ˜
        function updateCurrentDate() {
            const now = new Date();
            const options = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric', 
                weekday: 'long' 
            };
            const dateString = now.toLocaleDateString('ko-KR', options);
            document.getElementById('currentDate').textContent = dateString;
        }







            
        // í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± í•¨ìˆ˜
        async function createTestGames() {
            try {
                console.log('ğŸ§ª í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì‹œì‘');
                
                const response = await fetch('/api/create-test-games', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                console.log('ğŸ§ª í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ê²°ê³¼:', data);
                
                if (data.success) {
                    alert('í…ŒìŠ¤íŠ¸ ë°ì´í„°ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.');
                    location.reload();
                    } else {
                    alert('í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì‹¤íŒ¨: ' + data.message);
                }
            } catch (error) {
                console.error('âŒ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì˜¤ë¥˜:', error);
                alert('í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ê²½ê¸° ìƒíƒœ í…ìŠ¤íŠ¸ ë° í´ë˜ìŠ¤ í•¨ìˆ˜
        function getStatusText(game) {
            console.log('ğŸ” ê²½ê¸° ìƒíƒœ í™•ì¸:', {
                gameNumber: game.number,
                progressStatus: game.progressStatus,
                gameStatus: game.gameStatus,
                noGame: game.noGame,
                startTime: game.startTime,
                endTime: game.endTime
            });
            
            // ìš°ì²œì·¨ì†Œ, ê²½ê¸°ì·¨ì†Œ ë“± íŠ¹ë³„í•œ ìƒí™©ì€ ìš°ì„  ì²˜ë¦¬
            if (game.noGame === 'ìš°ì²œ' || game.noGame === 'ë²ˆê°œ/ì²œë‘¥' || game.noGame === 'ê²½ê¸°ì·¨ì†Œ' || game.noGame === 'ìš°ì²œì·¨ì†Œ') {
                return game.noGame;
            }
            
            // ì‹œê°„ ê¸°ë°˜ ì§„í–‰ìƒíƒœ ê³„ì‚°
            const currentStatus = calculateGameStatusByTime(game);
            if (currentStatus) {
                return currentStatus;
            }
            
            // ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ í•„ë“œ í™•ì¸ (ë°±ì—…)
            if (game.progressStatus) {
                if (game.progressStatus === 'ê²½ê¸°ì „') return 'ê²½ê¸°ì „';
                if (game.progressStatus === 'ê²½ê¸°ì¤‘') return 'ê²½ê¸°ì¤‘';
                if (game.progressStatus === 'ê²½ê¸°ì¢…ë£Œ' || game.progressStatus === 'ê²½ê¸°ë') return 'ê²½ê¸°ë';
                if (game.progressStatus === 'ê²½ê¸°ì·¨ì†Œ' || game.progressStatus === 'ìš°ì²œì·¨ì†Œ') return game.progressStatus;
                return game.progressStatus;
            }
            
            // team-games ì»¬ë ‰ì…˜ì—ì„œ ë³€í™˜ëœ noGame í•„ë“œ ì‚¬ìš©
            if (game.noGame) {
                if (game.noGame === 'ì •ìƒê²Œì„') {
                    if (game.progressStatus === 'ê²½ê¸°ì¤‘') return 'ê²½ê¸°ì¤‘';
                    if (game.progressStatus === 'ê²½ê¸°ì¢…ë£Œ' || game.progressStatus === 'ê²½ê¸°ë') return 'ê²½ê¸°ë';
                    return 'ê²½ê¸°ì „';
                }
                if (game.noGame === 'ê²½ê¸°ì¤‘') return 'ê²½ê¸°ì¤‘';
                if (game.noGame === 'ê²½ê¸°ì¢…ë£Œ' || game.noGame === 'ê²½ê¸°ë') return 'ê²½ê¸°ë';
                if (game.noGame === 'ìš°ì²œì·¨ì†Œ' || game.noGame === 'ì·¨ì†Œ') return game.noGame;
            return game.noGame;
        }

            
            return 'ê²½ê¸°ì „';
        }
        
        // ì‹œê°„ ê¸°ë°˜ ê²½ê¸° ìƒíƒœ ê³„ì‚° í•¨ìˆ˜
        function calculateGameStatusByTime(game) {
            if (!game.startTime || !game.endTime) {
                return null; // ì‹œê°„ ì •ë³´ê°€ ì—†ìœ¼ë©´ null ë°˜í™˜
            }
            
            const now = new Date();
            const koreaTime = new Date(now.getTime() + (9 * 60 * 60 * 1000)); // UTC+9
            
            // ê³µí†µ í•¨ìˆ˜ ì‚¬ìš©í•˜ì—¬ ì˜¤ëŠ˜ ë‚ ì§œ ê³„ì‚°
            const today = getKoreanDate();
            
            // ì‹œê°„ íŒŒì‹± (HH:MM í˜•ì‹)
            const parseTime = (timeStr) => {
                const [hours, minutes] = timeStr.split(':').map(Number);
                const gameDate = new Date(today + 'T' + timeStr + ':00+09:00');
                return gameDate;
            };
            
            try {
                const startTime = parseTime(game.startTime);
                const endTime = parseTime(game.endTime);
                const currentTime = koreaTime;
                
                console.log('â° ì‹œê°„ ê³„ì‚°:', {
                    gameNumber: game.number,
                    startTime: startTime.toISOString(),
                    endTime: endTime.toISOString(),
                    currentTime: currentTime.toISOString(),
                    startTimeMs: startTime.getTime(),
                    endTimeMs: endTime.getTime(),
                    currentTimeMs: currentTime.getTime()
                });
                
                // ì‹œê°„ ë¹„êµ
                if (currentTime < startTime) {
                    return 'ê²½ê¸°ì „';
                } else if (currentTime >= startTime && currentTime <= endTime) {
                    return 'ê²½ê¸°ì¤‘';
                } else if (currentTime > endTime) {
                    return 'ê²½ê¸°ë';
                }
            } catch (error) {
                console.error('ì‹œê°„ íŒŒì‹± ì˜¤ë¥˜:', error);
            }
            
            return null;
        }
        
        function getGameStatusClass(game) {
            if (game.noGame === 'ê²½ê¸°ì¤‘') {
                return 'bg-red-500 text-white';
            } else if (game.noGame === 'ê²½ê¸°ì¢…ë£Œ') {
                return 'bg-gray-600 text-white';
            } else if (game.noGame === 'ìš°ì²œì·¨ì†Œ' || game.noGame === 'ì·¨ì†Œ') {
                return 'bg-yellow-500 text-black';
                } else {
                return 'bg-blue-500 text-white';
            }
        }
        
        function getGameSituationText(game) {
            console.log('ğŸ” ê²½ê¸° ìƒí™© í™•ì¸:', {
                gameNumber: game.number,
                noGame: game.noGame,
                progressStatus: game.progressStatus
            });
            
            // team-games ì»¬ë ‰ì…˜ì—ì„œ ë³€í™˜ëœ ë°ì´í„° ì‚¬ìš©
            if (game.noGame) {
                return game.noGame;
            } else {
                return 'ê²½ê¸°ì „';
            }
        }

        function getStatusBadgeClass(game) {
            const status = getStatusText(game);
            
            if (status === 'ê²½ê¸°ì¤‘') {
                    return 'bg-red-500 text-white';
            } else if (status === 'ê²½ê¸°ë' || status === 'ê²½ê¸°ì¢…ë£Œ') {
                return 'bg-gray-600 text-white';
            } else if (status === 'ìš°ì²œì·¨ì†Œ' || status === 'ê²½ê¸°ì·¨ì†Œ' || status === 'ë²ˆê°œ/ì²œë‘¥') {
                    return 'bg-yellow-500 text-black';
            } else if (status === 'ê²½ê¸°ì „') {
                return 'bg-blue-500 text-white';
                } else {
                    return 'bg-gray-500 text-white';
            }
        }

        // ëª¨ë“  ê²½ê¸°ê°€ ê²½ê¸°ì „ì¸ì§€ í™•ì¸í•˜ëŠ” í•¨ìˆ˜
        function checkAllGamesStatus(games) {
            console.log('ğŸ” ì „ì²´ ê²½ê¸° ìƒíƒœ í™•ì¸:', games.map(game => ({
                gameNumber: game.number,
                progressStatus: game.progressStatus,
                gameStatus: game.gameStatus,
                noGame: game.noGame
            })));
            
            return games.every(game => 
                (game.progressStatus === 'ê²½ê¸°ì „') || 
                (game.gameStatus === 'ê²½ê¸°ì „') ||
                (game.noGame === 'ê²½ê¸°ì „' || game.noGame === 'ì •ìƒê²Œì„')
            );
        }
        
        // ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupButtonEventListeners() {
                    const betBtn = document.getElementById('betBtn');
            const resultBtn = document.getElementById('resultBtn');

            if (betBtn) {
                betBtn.addEventListener('click', handleBetting);
            }

            if (resultBtn) {
                resultBtn.addEventListener('click', showBettingResult);
            }
        }
        


        function getStatusColor(status) {
            switch (status) {
                case 'ë°°íŒ… ì¤‘':
                    return 'bg-yellow-500';
                case 'ë°°íŒ… ì¤‘ì§€':
                    return 'bg-red-500';
                case 'ê²°ê³¼ ì²˜ë¦¬ ì¤‘':
                    return 'bg-blue-500';
                default:
                    return 'bg-gray-600';
            }
        }
        
        // ì¶œì„ì²´í¬ í•¨ìˆ˜
        function checkAttendance() {
            // ì¶œì„ì²´í¬ í˜ì´ì§€ë¡œ ì´ë™
            window.location.href = '/attendance.html';
        }
        
            

        let bettingStatusInterval = null;

        function startBettingStatusPolling(gameId) {
            if (bettingStatusInterval) clearInterval(bettingStatusInterval);
            bettingStatusInterval = setInterval(async () => {
                try {
                    const res = await fetch('/api/team-games');
                    const data = await res.json();
                    if (data && data.games) {
                        const updatedGame = data.games.find(g => g._id === gameId || g.id === gameId);
                        if (updatedGame) {
                            selectedGame.bettingStart = updatedGame.bettingStart;
                            selectedGame.bettingStop = updatedGame.bettingStop;
                            console.log('í´ë§: bettingStart =', updatedGame.bettingStart, ', bettingStop =', updatedGame.bettingStop);
                            enablePredictionButton();
                            enableBettingSelection();
                            if (updatedGame.predictionResult) {
                                if (typeof showPredictionResult === 'function') {
                                    showPredictionResult(updatedGame.predictionResult);
                                }
                            }
                        }
                    }
                } catch (e) {
                    console.error('ë°°íŒ… ìƒíƒœ í´ë§ ì˜¤ë¥˜:', e);
                }
            }, 1000);
        }

        // selectSimpleGame í•¨ìˆ˜ ë‚´ polling ì‹œì‘ ì¶”ê°€
        // const originalSelectSimpleGame = selectSimpleGame;
        // selectSimpleGame = function(gameId, gameNumber, matchup) {
        //     originalSelectSimpleGame.apply(this, arguments);
        //     // pollingì€ ë‚˜ì¤‘ì— ì¶”ê°€
        // };

        // resetGameSelection í•¨ìˆ˜ ë‚´ polling ì¤‘ë‹¨ ì¶”ê°€
        const originalResetGameSelection = resetGameSelection;
        resetGameSelection = function() {
            if (bettingStatusInterval) clearInterval(bettingStatusInterval);
            bettingStatusInterval = null;
            originalResetGameSelection.apply(this, arguments);
        };

        // ê²Œì„ì„ íƒ(íƒ€ì) ë²„íŠ¼ ë¹„í™œì„±í™” ë° ìë™ ì„ íƒ
        function enableGameTypeSelection() {
            const batterBtn = document.getElementById('batterBtn');
            if (batterBtn) {
                batterBtn.classList.add('bg-blue-700', 'text-white', 'font-bold', 'border-blue-900');
                batterBtn.classList.remove('bg-yellow-800', 'bg-yellow-500', 'text-black');
                batterBtn.disabled = true;
                batterBtn.classList.add('opacity-50', 'cursor-not-allowed');
                batterBtn.classList.remove('cursor-pointer');
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ë° ê²½ê¸° ì„ íƒ ì‹œ ìë™ í˜¸ì¶œ
        if (typeof enableGameTypeSelection === 'function') enableGameTypeSelection();

        // ì˜ˆì¸¡ê²°ê³¼ ëŒ€ê¸° ëª¨ë‹¬
        function showWaitingForResultModal() {
            const oldModal = document.getElementById('waitingForResultModal');
            if (oldModal) oldModal.remove();
            const modal = document.createElement('div');
            modal.id = 'waitingForResultModal';
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 text-center">
                    <h3 class="text-lg font-bold mb-4">ì˜ˆì¸¡ê²°ê³¼ë¥¼ ê¸°ë‹¤ë¦½ë‹ˆë‹¤!</h3>
                    <div class="mb-4">
                        <p>ê²½ê¸°ì„ íƒ, ë°°íŒ…ì„ íƒ, ì˜ˆì¸¡ê²°ê³¼ë¥¼ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.<br>ê´€ë¦¬ìê°€ ì˜ˆì¸¡ê²°ê³¼ë¥¼ ì„ íƒí•  ë•Œê¹Œì§€ ëŒ€ê¸°í•©ë‹ˆë‹¤.</p>
                        <p class="text-sm mt-2">ë°°íŒ… ì„ íƒ: <span class="text-red-500 font-bold">${window.selectedChoice}</span></p>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // ì„±ê³µ/ê¸°ë¶€ ëª¨ë‹¬
        function showSuccessAndDonationModal(winAmount) {
            const oldModal = document.getElementById('successDonationModal');
            if (oldModal) oldModal.remove();
            const modal = document.createElement('div');
            modal.id = 'successDonationModal';
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 text-center">
                    <h3 class="text-lg font-bold mb-4 text-green-400">ì¶•í•˜í•©ë‹ˆë‹¤!</h3>
                    <div class="mb-4">
                        <p class="text-lg font-bold">íšë“ í¬ì¸íŠ¸: <span class="text-yellow-300">${winAmount}</span></p>
                    </div>
                    <div class="mb-4">
                        <p>ê¸°ë¶€ë¥¼ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
                        <div class="flex justify-center space-x-4 mt-2">
                            <button id="donateYesBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded">Y</button>
                            <button id="donateNoBtn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded">N</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Y ë²„íŠ¼ í´ë¦­ ì‹œ ì„±ê³µ ëª¨ë‹¬ ë‹«ê³  ê¸°ë¶€ ëª¨ë‹¬ í‘œì‹œ
            document.getElementById('donateYesBtn').onclick = function() {
                modal.remove(); // ì„±ê³µ ëª¨ë‹¬ ì œê±°
                showDonationModal(winAmount); // ê¸°ë¶€ ëª¨ë‹¬ í‘œì‹œ (ìŠ¹ë¦¬ í¬ì¸íŠ¸ ì „ë‹¬)
            };
            
            // N ë²„íŠ¼ í´ë¦­ ì‹œ ê²Œì„ìœ¼ë¡œ ëŒì•„ê°€ê¸°
            document.getElementById('donateNoBtn').onclick = function() {
                modal.remove(); // ì„±ê³µ ëª¨ë‹¬ ì œê±°
                // ê¸°ë¶€ ì•ˆí•¨ - ë°°íŒ… ì„ íƒ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸° (ê²Œì„ ì„ íƒ ìœ ì§€)
                showSelectedGameOnly();
                enableBettingSelection();
                enableBettingPoints();
            };
        }

        // ê¸°ë¶€ ëª¨ë‹¬(ê°„ë‹¨ ì˜ˆì‹œ)
        function showDonationModal(winPoints = 0) {
            const modal = document.getElementById('donationModal');
            if (modal) {
                modal.classList.remove('hidden');
                
                // ê¸°ë¶€ ëª¨ë‹¬ ìŒì„± ì•ˆë‚´
                speakText('ê¸°ë¶€ ëª¨ë‹¬ì´ í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤. ì›í•˜ëŠ” ê¸°ë¶€ ë¹„ìœ¨ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                
                // ê¸°ë¶€ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
                const donationBtns = modal.querySelectorAll('.donation-btn');
                donationBtns.forEach(btn => {
                    btn.addEventListener('click', function() {
                        // ëª¨ë“  ë²„íŠ¼ì—ì„œ ì„ íƒ ìƒíƒœ ì œê±°
                        donationBtns.forEach(b => b.classList.remove('selected'));
                        // í´ë¦­ëœ ë²„íŠ¼ì— ì„ íƒ ìƒíƒœ ì¶”ê°€
                        this.classList.add('selected');
                        
                        const percent = this.getAttribute('data-percent');
                        
                        // ê¸°ë¶€ í™•ì¸ ì„¹ì…˜ í‘œì‹œ
                        const confirmSection = modal.querySelector('#donationConfirm');
                        const selectedPercentSpan = modal.querySelector('#selectedPercent');
                        if (confirmSection && selectedPercentSpan) {
                            selectedPercentSpan.textContent = `${percent}%`;
                            confirmSection.classList.remove('hidden');
                        }
                        
                        // ê¸°ë¶€í•˜ê¸° ë²„íŠ¼ ì—…ë°ì´íŠ¸
                        const donateBtn = document.getElementById('donateBtn');
                        if (donateBtn) {
                            donateBtn.onclick = function() {
                                handleDonation(parseInt(percent));
                            };
                        }
                    });
                });
                
                // ê¸°ë¶€í•˜ì§€ ì•Šê¸° ë²„íŠ¼
                const donateNoBtn = modal.querySelector('#donateNoBtn');
                if (donateNoBtn) {
                    donateNoBtn.onclick = function() {
                        speakText('ê¸°ë¶€í•˜ì§€ ì•Šê³  ê²Œì„ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.');
                        closeDonationModal();
                        // ê¸°ë¶€í•˜ì§€ ì•Šê³  ê²Œì„ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                        showSelectedGameOnly();
                        enableBettingSelection();
                        enableBettingPoints();
                    };
                }
                
                // ê¸°ë¶€ í™•ì¸ ë²„íŠ¼ë“¤
                const confirmYesBtn = modal.querySelector('#confirmYesBtn');
                const confirmNoBtn = modal.querySelector('#confirmNoBtn');
                
                if (confirmYesBtn) {
                    confirmYesBtn.onclick = function() {
                        const selectedBtn = modal.querySelector('.donation-btn.selected');
                        if (selectedBtn) {
                            const percent = selectedBtn.getAttribute('data-percent');
                            handleDonation(parseInt(percent));
                        }
                    };
                }
                
                if (confirmNoBtn) {
                    confirmNoBtn.onclick = function() {
                        speakText('ê¸°ë¶€ë¥¼ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.');
                        // ê¸°ë¶€ í™•ì¸ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
                        const confirmSection = modal.querySelector('#donationConfirm');
                        if (confirmSection) {
                            confirmSection.classList.add('hidden');
                        }
                        // ì„ íƒ ìƒíƒœ ì œê±°
                        donationBtns.forEach(b => b.classList.remove('selected'));
                    };
                }
                
                // ê¸°ë³¸ì ìœ¼ë¡œ 10% ì„ íƒ
                const defaultBtn = modal.querySelector('[data-percent="10"]');
                if (defaultBtn) {
                    defaultBtn.click();
                }
            }
        }
        
        // ê¸°ë¶€ ë¹„ìœ¨ ì„ íƒ í•¨ìˆ˜
        function selectDonationPercent(percent) {
            // ëª¨ë“  ë²„íŠ¼ì—ì„œ ì„ íƒ ìƒíƒœ ì œê±°
            document.querySelectorAll('.donation-percent-btn').forEach(btn => {
                btn.classList.remove('ring-2', 'ring-yellow-400');
            });
            
            // ì„ íƒëœ ë²„íŠ¼ì— ì„ íƒ ìƒíƒœ ì¶”ê°€
            const selectedBtn = document.querySelector(`[data-percent="${percent}"]`);
            if (selectedBtn) {
                selectedBtn.classList.add('ring-2', 'ring-yellow-400');
            }
            
            // ì„ íƒëœ ë¹„ìœ¨ í‘œì‹œ
            document.getElementById('selectedDonationPercent').textContent = percent + '%';
            
            // ê¸°ë¶€í•˜ê¸° ë²„íŠ¼ì˜ onclick ì´ë²¤íŠ¸ ì—…ë°ì´íŠ¸
            const donateBtn = document.getElementById('donateBtn');
            if (donateBtn) {
                donateBtn.onclick = function() {
                    handleDonation(percent);
                };
            }
        }

        async function handleDonation(percent) {
            try {
                console.log('ğŸ¯ ê¸°ë¶€ ì²˜ë¦¬ ì‹œì‘:', { percent });
                
                // ì„ íƒëœ ê²Œì„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const selectedGame = await getSelectedGame();
                if (!selectedGame || !selectedGame.gameNumber) {
                    speakText('ê²Œì„ ì •ë³´ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ê²Œì„ì„ ë‹¤ì‹œ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    alert('ê²Œì„ ì •ë³´ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ê²Œì„ì„ ë‹¤ì‹œ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                // ì˜¤ëŠ˜ ë‚ ì§œ ê³„ì‚°
                const today = getKoreanDate();
                
                // predictionResultê°€ ì—†ìœ¼ë©´ ì„œë²„ì—ì„œ ìµœì‹  ê²Œì„ ì •ë³´ë¥¼ ê°€ì ¸ì™€ì„œ ì„¤ì •
                let actualResult = '';
                try {
                    const gameResponse = await fetch(`/api/game/${today}/${selectedGame.gameNumber}`);
                    const gameData = await gameResponse.json();
                    if (gameData.success && gameData.game.predictionResult) {
                        actualResult = gameData.game.predictionResult;
                    } else {
                        speakText('ê²Œì„ ê²°ê³¼ê°€ ì•„ì§ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                        alert('ê²Œì„ ê²°ê³¼ê°€ ì•„ì§ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                        return;
                    }
                } catch (error) {
                    console.error('ê²Œì„ ì •ë³´ ì¡°íšŒ ì˜¤ë¥˜:', error);
                    speakText('ê²Œì„ ì •ë³´ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    alert('ê²Œì„ ì •ë³´ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    return;
                }
                
                // ì„œë²„ì—ì„œ ì‹¤ì œ ìŠ¹ë¦¬ í¬ì¸íŠ¸ ê³„ì‚° ìš”ì²­
                const response = await fetch('/api/betting/calculate-game-winners', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        gameNumber: selectedGame.gameNumber,
                        actualResult: actualResult,
                        date: today
                    })
                });
                
                const data = await response.json();
                const pointsPerWinner = data.success ? data.data.pointsPerWinner : 0;
                const totalUniqueUsers = data.success ? data.data.totalUniqueUsers : 0;
                const winnerCount = data.success ? data.data.winnerCount : 0;
                const totalWinAmount = 100 + pointsPerWinner; // ê³ ì • ë°°íŒ… í¬ì¸íŠ¸(100) + ì„±ê³µìë‹¹ ë¶„ë°° í¬ì¸íŠ¸
                
                // í˜¼ìì„œ ê²Œì„í•  ë•Œ (ì°¸ê°€ì 1ëª…, ìŠ¹ì 1ëª…)
                if (totalUniqueUsers === 1 && winnerCount === 1) {
                    speakText('í˜¼ìì„œ ê²Œì„í•˜ì…¨ë„¤ìš”! ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜í•˜ë©´ ë” ì¬ë¯¸ìˆì–´ìš”!');
                    showSoloWinModal(totalWinAmount);
                    return;
                }
                
                const donationAmount = Math.floor(pointsPerWinner * (percent / 100)); // ê¸°ë¶€í•  í¬ì¸íŠ¸ (ìŠ¹ë¦¬ ìˆ˜ë‹¹ì—ì„œë§Œ)
                const remainingAmount = 100 + (pointsPerWinner - donationAmount); // ë‚¨ì€ í¬ì¸íŠ¸ (ì›ê¸ˆ + (ìŠ¹ë¦¬ ìˆ˜ë‹¹ - ê¸°ë¶€))
                
                // ì‹¤ì œ ê¸°ë¶€ API í˜¸ì¶œ
                const donationResponse = await fetch('/api/donation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        userId: currentUser.userId,
                        userName: currentUser.name,
                        donationAmount: donationAmount,
                        percentage: percent
                    })
                });
                
                const donationData = await donationResponse.json();
                
                if (donationData.success) {
                    // ì„œë²„ì—ì„œ ì—…ë°ì´íŠ¸ëœ í¬ì¸íŠ¸ë¡œ ì‚¬ìš©ì ì •ë³´ ê°±ì‹ 
                    currentUser.points = donationData.data.remainingPoints;
                    document.getElementById('userPoints').textContent = `${currentUser.points}í¬ì¸íŠ¸`;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    // ê¸°ë¶€ ì™„ë£Œ ìŒì„± ì•ˆë‚´
                    speakText(`${percent}í¼ì„¼íŠ¸ ê¸°ë¶€ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ${donationAmount}í¬ì¸íŠ¸ë¥¼ ê¸°ë¶€í•˜ì…¨ìŠµë‹ˆë‹¤.`);
                    
                    closeDonationModal();
                    // ê¸°ë¶€ ì™„ë£Œ í›„ ë°°íŒ… ì„ íƒ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸° (ê²Œì„ ì„ íƒ ìœ ì§€)
                    try {
                        if (selectedGame) {
                            console.log('ğŸ¯ ê¸°ë¶€ ì™„ë£Œ í›„ ê²Œì„ í™”ë©´ ì—…ë°ì´íŠ¸:', selectedGame);
                            showSelectedGameOnly(
                                selectedGame.gameNumber,
                                selectedGame.matchup || `${selectedGame.homeTeam || ''} vs ${selectedGame.awayTeam || ''}`,
                                selectedGame
                            );
                        } else {
                            console.warn('âš ï¸ selectedGameì´ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.');
                            loadSimpleGames(); // ê¸°ë³¸ ê²Œì„ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                        }
                    } catch (error) {
                        console.error('âŒ ê²Œì„ í™”ë©´ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
                        loadSimpleGames(); // ì˜¤ë¥˜ ì‹œ ê¸°ë³¸ ê²Œì„ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                    }
                    enableBettingSelection();
                    enableBettingPoints();
                } else {
                    speakText('ê¸°ë¶€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                    alert('ê¸°ë¶€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + donationData.message);
                }
            } catch (error) {
                console.error('ê¸°ë¶€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:', error);
                
                // ê¸°ë¶€ ì²˜ë¦¬ ì˜¤ë¥˜ ìŒì„± ì•ˆë‚´
                speakText('ê¸°ë¶€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                
                alert('ê¸°ë¶€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        function closeDonationModal() {
            const modal = document.getElementById('donationModal');
            if (modal) modal.remove();
        }

        // ë°°íŒ… ì„±ê³µ í›„ ëŒ€ê¸° ëª¨ë‹¬ ë„ìš°ê¸°
        async function processBetting(isRetry) {
            try {
                // í•„ìˆ˜ í•„ë“œë“¤ì´ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸
            if (!currentUser || !currentUser.userId) {
                    speakText('ì‚¬ìš©ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                    alert('ì‚¬ìš©ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                        return;
                    }
                if (!window.selectedChoice) {
                    speakText('ë°°íŒ… ì„ íƒì´ ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    alert('ë°°íŒ… ì„ íƒì´ ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }
                if (!selectedAmount) {
                    speakText('ë°°íŒ… ê¸ˆì•¡ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    alert('ë°°íŒ… ê¸ˆì•¡ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    return;
                }
                if (!selectedGame || !selectedGame.date || !selectedGame.gameNumber) {
                    speakText('ê²Œì„ ì •ë³´ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ê²Œì„ì„ ë‹¤ì‹œ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    alert('ê²Œì„ ì •ë³´ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ê²Œì„ì„ ë‹¤ì‹œ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }
                // ê³ ì • ë°°íŒ… í¬ì¸íŠ¸ 100
                const fixedPoints = 100;
                
                const requestData = {
                    userId: currentUser.userId,
                    gameNumber: selectedGame.gameNumber,
                    prediction: window.selectedChoice,
                    points: 100
                };
                console.log('ë°°íŒ… ìš”ì²­ ë°ì´í„°:', requestData);
                // ì•ˆì „ì¥ì¹˜: ë™ì¼ ê²½ê¸°ì˜ ê¸°ì¡´ ë°°íŒ…ì´ ë‚¨ì•„ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì‚¬ì „ ì •ë¦¬
                try {
                    await fetch('/api/clear-user-betting', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            userId: currentUser.userId,
                            gameNumber: selectedGame.gameNumber
                        })
                    });
                } catch (e) {
                    console.warn('clear-user-betting ì‚¬ì „ ì •ë¦¬ ì‹¤íŒ¨(ë¬´ì‹œ):', e);
                }
                const response = await fetch('/api/betting/submit', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                });
                
                const data = await response.json();
                console.log('ë°°íŒ… ì‘ë‹µ:', data);
                
                if (data.success) {
                    console.log('âœ… ë°°íŒ… ì„±ê³µ - game-member ì»¬ë ‰ì…˜ì— ì €ì¥ë¨');
                    console.log('ğŸ“Š ì €ì¥ëœ ë°°íŒ… ë°ì´í„°:', requestData);
                    
                    // ë°°íŒ… ì„±ê³µ ìŒì„± ì•ˆë‚´ (ë” ëª…í™•í•˜ê²Œ)
                    const successMessage = `${window.selectedChoice}ì— 100í¬ì¸íŠ¸ ë°°íŒ…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`;
                    console.log('ğŸ¤ ì„±ê³µ ìŒì„± ì¬ìƒ:', successMessage);
                    speakText(successMessage);
                    
                    // ë°°íŒ… ì„±ê³µ ì²˜ë¦¬ ì™„ë£Œ
                    console.log('ğŸ“ˆ ë°°íŒ… ì™„ë£Œ');
                    
                    // ê³ ì • ë°°íŒ… í¬ì¸íŠ¸ 100 ì°¨ê°
                    currentUser.points -= 100;
                    document.getElementById('userPoints').textContent = `${currentUser.points}í¬ì¸íŠ¸`;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    showWaitingForResultModal();
                    waitForResult();
                } else if (!isRetry && data.message && data.message.includes('ë°°íŒ…ì´ í™œì„±í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤')) {
                    // ê²½ê¸°ë³„ ì»¬ë ‰ì…˜ì´ ì—†ì„ ë•Œ ìë™ ì´ˆê¸°í™” í›„ 1íšŒ ì¬ì‹œë„
                    console.log('ğŸ”„ ê²½ê¸°ë³„ ì»¬ë ‰ì…˜ ìë™ ì´ˆê¸°í™” ì¤‘...');
                    await initializeGameCollection(selectedGame.gameNumber);
                    setTimeout(() => processBetting(true), 1000); // 1ì´ˆ ë”œë ˆì´ í›„ ì¬ì‹œë„
                } else {
                    console.log('âŒ ë°°íŒ… ì‹¤íŒ¨:', data.message);
                    const errorMessage = data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
                    
                    // ì´ë¯¸ ë°°íŒ…í•œ ê²½ìš°: ì•„ë¬´ ë™ì‘ë„ í•˜ì§€ ì•Šê³  ì‚¬ìš©ìê°€ íë¦„ì„ ê³„ì† ì„ íƒí•˜ë„ë¡ ë‘ 
                    if (errorMessage.includes('ì´ë¯¸ ì´ ê²Œì„ì— ë°°íŒ…í•˜ì…¨ìŠµë‹ˆë‹¤')) {
                        // no-op: ì‚¬ìš©ì ì„ íƒ ëŒ€ê¸°
                    } else {
                        // ê·¸ ì™¸ ì˜¤ë¥˜ëŠ” ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
                        speakText(`ë°°íŒ…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ${errorMessage}`);
                        alert('ë°°íŒ… ì‹¤íŒ¨: ' + errorMessage);
                    }
                }
            } catch (error) {
                console.error('ë°°íŒ… ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                
                // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë“± ì˜ˆì™¸ ìƒí™© ìŒì„± ì•ˆë‚´
                speakText('ë°°íŒ… ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                
                alert('ë°°íŒ… ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë‹¤ìŒ ê²½ê¸°ë¡œ ì´ë™ (ì‚¬ìš©ì ì„ íƒ ìœ ì§€ ì›ì¹™: ìš´ì˜ì í™œì„± ê²½ê¸°ì™€ ì¼ì¹˜ ì‹œ í™œì„±í™”)
        async function skipToNextGame() {
            try {
                const res = await fetch('/api/team-games');
                const data = await res.json();
                if (!data || !data.games || !selectedGame) return;
                const currentNum = selectedGame.gameNumber || selectedGame.number;
                // í˜„ì¬ ë²ˆí˜¸ë³´ë‹¤ í° ê²½ê¸° ì¤‘ ê°€ì¥ ì•ì˜ ê²½ê¸°ë¡œ ì´ë™
                const next = data.games
                    .filter(g => (g.gameNumber || g.number) > currentNum)
                    .sort((a,b) => (a.gameNumber||a.number) - (b.gameNumber||b.number))[0];
                if (next) {
                    selectedGame = {
                        ...selectedGame,
                        ...next
                    };
                    resetBettingSelection();
                    showSelectedGameOnly(
                        next.gameNumber || next.number,
                        next.matchup || `${next.homeTeam || ''} vs ${next.awayTeam || ''}`,
                        next
                    );
                    // ìš´ì˜ìê°€ ì‹œì‘í•˜ë©´ ìë™ í™œì„±í™”ë˜ë„ë¡ ìƒíƒœ í´ë§ì€ ìœ ì§€
                    if (window.bettingStatusInterval) clearInterval(window.bettingStatusInterval);
                    window.bettingStatusInterval = setInterval(checkBettingStatus, 500);
                }
            } catch (e) {
                console.error('ë‹¤ìŒ ê²½ê¸° ì´ë™ ì˜¤ë¥˜:', e);
            }
        }

        // í†µê³„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        async function updateGameStats(gameNumber, date) {
            try {
                const response = await fetch('/api/betting/update-game-stats', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        gameNumber: gameNumber,
                        date: date
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    console.log('í†µê³„ ì—…ë°ì´íŠ¸ ì„±ê³µ:', data.message);
                } else {
                    console.error('í†µê³„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', data.message);
                }
            } catch (error) {
                console.error('í†µê³„ ì—…ë°ì´íŠ¸ API í˜¸ì¶œ ì˜¤ë¥˜:', error);
            }
        }

        // ê²½ê¸°ë³„ ì»¬ë ‰ì…˜ ì´ˆê¸°í™” í•¨ìˆ˜
        async function initializeGameCollection(gameNumber) {
            try {
                const response = await fetch('/api/betting/initialize-game-collections', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                const data = await response.json();
                console.log('ê²½ê¸°ë³„ ì»¬ë ‰ì…˜ ì´ˆê¸°í™” ì‘ë‹µ:', data);
                return data.success;
            } catch (error) {
                console.error('ê²½ê¸°ë³„ ì»¬ë ‰ì…˜ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                return false;
            }
        }

        // ê²°ê³¼ ëŒ€ê¸° ë° ì„±ê³µ/ê¸°ë¶€ ëª¨ë‹¬ ì—°ë™
        function waitForResult() {
            console.log('ğŸ”„ ê²°ê³¼ ëŒ€ê¸° ì‹œì‘...');
            let checkCount = 0;
            
            const resultCheckInterval = setInterval(async () => {
                checkCount++;
                console.log(`ğŸ” ê²°ê³¼ í™•ì¸ ${checkCount}íšŒì°¨...`);
                
                try {
                    // ì‹¤ì‹œê°„ìœ¼ë¡œ ì„œë²„ì—ì„œ ìµœì‹  ê²Œì„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                    const response = await fetch('/api/team-games');
                    if (response.ok) {
                        const data = await response.json();
                        console.log('ğŸ“Š ì„œë²„ ê²Œì„ ë°ì´í„°:', data.games);
                        
                        const currentGame = data.games.find(game => 
                            game.gameNumber === selectedGame.gameNumber || 
                            game.number === selectedGame.gameNumber
                        );
                        
                        console.log('ğŸ¯ í˜„ì¬ ê²Œì„:', currentGame);
                        console.log('ğŸ¯ ì„ íƒëœ ê²Œì„ ë²ˆí˜¸:', selectedGame.gameNumber);
                        
                        if (currentGame) {
                            console.log('ğŸ“ ì˜ˆì¸¡ê²°ê³¼:', currentGame.predictionResult);
                            
                            if (currentGame.predictionResult && currentGame.predictionResult !== '') {
                                clearInterval(resultCheckInterval);
                                const waitModal = document.getElementById('waitingForResultModal');
                                if (waitModal) waitModal.remove();
                                
                                console.log('âœ… ì˜ˆì¸¡ê²°ê³¼ ê°ì§€:', currentGame.predictionResult);
                                console.log('ğŸ‘¤ ì‚¬ìš©ì ì„ íƒ:', window.selectedChoice);
                                
                                // ì‹¤ì œ ë°°íŒ… ë°ì´í„°ì—ì„œ ì‚¬ìš©ìì˜ ì„ íƒ í™•ì¸
                                const userChoice = window.selectedChoice;
                                const adminResult = currentGame.predictionResult;
                                // ì¤‘ë³µ ì²˜ë¦¬ ë°©ì§€ ê°€ë“œ
                                if (window.resultFlowActive) {
                                    console.log('â›” ê²°ê³¼ ì²˜ë¦¬ ì´ë¯¸ ì§„í–‰ ì¤‘ - ì¤‘ë³µ ì²˜ë¦¬ ì°¨ë‹¨');
                                    return;
                                }
                                window.resultFlowActive = true;
                                
                                // ë” ì •í™•í•œ ë¹„êµë¥¼ ìœ„í•´ ê³µë°± ì œê±° ë° ì •ê·œí™”
                                const normalizedUserChoice = userChoice ? userChoice.trim() : '';
                                const normalizedAdminResult = adminResult ? adminResult.trim() : '';
                                
                                // ì„±ê³µ/ì‹¤íŒ¨ íŒì •
                                const isSuccess = normalizedUserChoice === normalizedAdminResult;
                                
                                console.log('ğŸ† ìŠ¹ë¦¬/ì‹¤íŒ¨ íŒì • (ì •ê·œí™”):', {
                                    userChoice: userChoice,
                                    adminResult: adminResult,
                                    normalizedUserChoice: normalizedUserChoice,
                                    normalizedAdminResult: normalizedAdminResult,
                                    isSuccess: isSuccess,
                                    userChoiceType: typeof userChoice,
                                    adminResultType: typeof adminResult
                                });
                                
                                if (isSuccess) {
                                    // ì„±ê³µ ì‹œ íšë“ í¬ì¸íŠ¸ ê³„ì‚°
                                    try {
                                        // ìŠ¹ë¦¬ í¬ì¸íŠ¸ ê³„ì‚° API í˜¸ì¶œ
                                        const pointsResponse = await fetch('/api/betting/calculate-game-winners', {
                    method: 'POST',
                                            headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                                                gameNumber: selectedGame.gameNumber,
                                                actualResult: currentGame.predictionResult,
                                                date: selectedGame.date
                    })
                });
                                        const pointsData = await pointsResponse.json();
                                        
                                        if (pointsData.success) {
                                            const pointsPerWinner = pointsData.data.pointsPerWinner || 0;
                                            const winAmount = calculateWinnings(pointsPerWinner);
                                            console.log('ğŸ’° ìˆ˜ë‹¹ ê³„ì‚°:', {
                                                ì›ê¸ˆ: 100,
                                                ìŠ¹ë¦¬ìˆ˜ë‹¹: pointsPerWinner,
                                                ì´íšë“: winAmount
                                            });
                                            showSuccessModal(winAmount);
                } else {
                                            // ì˜¤ë¥˜ ì‹œ ê¸°ë³¸ê°’ ì‚¬ìš© (ë°°íŒ… í¬ì¸íŠ¸ë§Œ)
                                            const winAmount = 100;
                                            showSuccessModal(winAmount);
                }
            } catch (error) {
                                        console.error('í¬ì¸íŠ¸ ê³„ì‚° ì˜¤ë¥˜:', error);
                                        // ì˜¤ë¥˜ ì‹œ ê¸°ë³¸ê°’ ì‚¬ìš© (ë°°íŒ… í¬ì¸íŠ¸ë§Œ)
                                        const winAmount = 100;
                                        showSuccessModal(winAmount);
                }
            } else {
                                    // ì‹¤íŒ¨ì‹œ ì‹¤íŒ¨ ëª¨ë‹¬ í‘œì‹œ
                                    console.log('âŒ ì˜ˆì¸¡ ì‹¤íŒ¨');
                                    showFailureModal();
                                }
                            }
            } else {
                            console.log('âŒ í˜„ì¬ ê²Œì„ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                        }
                    } else {
                        console.log('âŒ ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜:', response.status);
                    }
                } catch (error) {
                    console.error('ê²°ê³¼ í™•ì¸ ì¤‘ ì˜¤ë¥˜:', error);
                }
                
                // íƒ€ì„ì•„ì›ƒ ì œê±° - ê´€ë¦¬ìê°€ ì˜ˆì¸¡ê²°ê³¼ë¥¼ ì…ë ¥í•  ë•Œê¹Œì§€ ë¬´í•œì • ëŒ€ê¸°
                // if (checkCount >= 60) {
                //     clearInterval(resultCheckInterval);
                //     console.log('â° ê²°ê³¼ ëŒ€ê¸° íƒ€ì„ì•„ì›ƒ');
                //     const waitModal = document.getElementById('waitingForResultModal');
                //     if (waitModal) waitModal.remove();
                //     alert('ê²°ê³¼ ëŒ€ê¸° ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                //     resetGameSelection();
                // }
            }, 1000); // 1ì´ˆë§ˆë‹¤ í™•ì¸
        }

        // ìŠ¹ë¦¬ ëª¨ë‹¬ (í´ë¦­ ì‹œ ê¸°ë¶€ ëª¨ë‹¬ë¡œ ì „í™˜)
        function showSuccessModal(winAmount) {
            // ìŠ¹ë¦¬ ìŒì„± ì•ˆë‚´ (ì¶•í•˜í•˜ëŠ” í†¤)
            const celebrationText = `ì™€! ì¶•í•˜í•©ë‹ˆë‹¤! ${winAmount}í¬ì¸íŠ¸ë¥¼ íšë“í•˜ì…¨ìŠµë‹ˆë‹¤!`;
            speakText(celebrationText, 1.1); // ì†ë„ë¥¼ ì•½ê°„ ë¹ ë¥´ê²Œ, ë” ê¸°ìœ í†¤
            
            // ìˆ˜ë‹¹ ê³„ì‚° ë¶„ë¦¬ í‘œì‹œ
            const originalBet = 100; // ì›ê¸ˆ
            const winningBonus = winAmount - originalBet; // ìŠ¹ë¦¬ ìˆ˜ë‹¹
            
            const oldModal = document.getElementById('successModal');
            if (oldModal) oldModal.remove();
            const modal = document.createElement('div');
            modal.id = 'successModal';
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 text-center cursor-pointer">
                    <h3 class="text-lg font-bold mb-4 text-green-400">ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤!</h3>
                    <div class="mb-4 space-y-2">
                        <p class="text-lg font-bold">ì´ íšë“ í¬ì¸íŠ¸: <span class="text-yellow-300">${winAmount}</span></p>
                        <p class="text-sm text-gray-300">ì›ê¸ˆ: <span class="text-blue-300">${originalBet}</span></p>
                        <p class="text-sm text-gray-300">ìŠ¹ë¦¬ ìˆ˜ë‹¹: <span class="text-green-300">${winningBonus}</span></p>
                    </div>
                    <p class="text-sm text-gray-300">í´ë¦­í•˜ì—¬ ê¸°ë¶€ ëª¨ë‹¬ë¡œ ì´ë™</p>
                </div>
            `;
            document.body.appendChild(modal);
            
            // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ê¸°ë¶€ ëª¨ë‹¬ë¡œ ì „í™˜
            modal.onclick = function(e) {
                // ëª¨ë‹¬ ë‚´ë¶€ ì»¨í…ì¸ ë¥¼ í´ë¦­í•œ ê²½ìš° ì´ë²¤íŠ¸ ì „íŒŒ ë°©ì§€
                if (e.target.closest('.bg-gray-800')) {
                    e.stopPropagation();
                    return;
                }
                // ëª¨ë‹¬ ë°°ê²½ì„ í´ë¦­í•œ ê²½ìš°ì—ë§Œ ê¸°ë¶€ ëª¨ë‹¬ë¡œ ì „í™˜
                modal.remove();
                showDonationModal();
            };
            
            // ëª¨ë‹¬ ë‚´ë¶€ ì»¨í…ì¸  í´ë¦­ ì‹œì—ë„ ê¸°ë¶€ ëª¨ë‹¬ë¡œ ì „í™˜
            const modalContent = modal.querySelector('.bg-gray-800');
            modalContent.onclick = function() {
                modal.remove();
                showDonationModal();
            };
        }

        // í˜¼ìì„œ ê²Œì„í•  ë•Œ ìŠ¹ë¦¬ ëª¨ë‹¬ (ê¸°ë¶€ ëª¨ë‹¬ ëŒ€ì‹ )
        function showSoloWinModal(winAmount) {
            const celebrationText = `ì™€! ì¶•í•˜í•©ë‹ˆë‹¤! ${winAmount}í¬ì¸íŠ¸ë¥¼ íšë“í•˜ì…¨ìŠµë‹ˆë‹¤!`;
            speakText(celebrationText, 1.1);
            
            const oldModal = document.getElementById('soloWinModal');
            if (oldModal) oldModal.remove();
            const modal = document.createElement('div');
            modal.id = 'soloWinModal';
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 text-center cursor-pointer">
                    <h3 class="text-lg font-bold mb-4 text-green-400">ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤!</h3>
                    <div class="mb-4 space-y-2">
                        <p class="text-lg font-bold">ì´ íšë“ í¬ì¸íŠ¸: <span class="text-yellow-300">${winAmount}</span></p>
                        <p class="text-sm text-gray-300">ì›ê¸ˆ: <span class="text-blue-300">100</span></p>
                        <p class="text-sm text-gray-300">ìŠ¹ë¦¬ ìˆ˜ë‹¹: <span class="text-green-300">${winAmount - 100}</span></p>
                    </div>
                    <p class="text-sm text-red-400 font-bold mb-3">í˜¼ìì„œ ê²Œì„í•˜ì…¨ë„¤ìš”!</p>
                    <p class="text-sm text-gray-300">ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜í•˜ë©´ ë” ì¬ë¯¸ìˆì–´ìš”!</p>
                    <p class="text-sm text-gray-300">í´ë¦­í•˜ì—¬ ë‹¤ìŒ ê²Œì„ìœ¼ë¡œ</p>
                </div>
            `;
            document.body.appendChild(modal);
            
            // ëª¨ë‹¬ í´ë¦­ ì‹œ ê²Œì„ìœ¼ë¡œ ëŒì•„ê°
            modal.onclick = function() {
                modal.remove();
                showSelectedGameOnly();
                enableBettingSelection();
                enableBettingPoints();
            };
        }

        // ì‹¤íŒ¨ ëª¨ë‹¬ (í´ë¦­ ì‹œ ê²Œì„ìœ¼ë¡œ ëŒì•„ê°)
        function showFailureModal() {
            // ì‹¤íŒ¨ ìŒì„± ì•ˆë‚´ (ì•ˆíƒ€ê¹Œìš´ í†¤)
            const failureText = 'ì•„ì‰½ë„¤ìš”... ì˜ˆì¸¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë„ì „í•´ë³´ì„¸ìš”.';
            speakText(failureText, 0.7); // ì†ë„ë¥¼ ëŠ¦ì¶°ì„œ ì•ˆíƒ€ê¹Œìš´ í†¤
            
            const oldModal = document.getElementById('failureModal');
            if (oldModal) oldModal.remove();
            const modal = document.createElement('div');
            modal.id = 'failureModal';
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 text-center cursor-pointer">
                    <h3 class="text-lg font-bold mb-4 text-red-400">ğŸ˜” ì•„ì‰½ìŠµë‹ˆë‹¤!</h3>
                    <div class="mb-4">
                        <p class="text-lg">ì˜ˆì¸¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>
                        <p class="text-sm text-gray-300">ë‹¤ì‹œ ë„ì „í•´ë³´ì„¸ìš”!</p>
                    </div>
                    <p class="text-sm text-gray-300">í´ë¦­í•˜ì—¬ ê²Œì„ìœ¼ë¡œ ëŒì•„ê°€ê¸°</p>
                </div>
            `;
            document.body.appendChild(modal);
            
            // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ê²Œì„ìœ¼ë¡œ ëŒì•„ê°
            modal.onclick = function(e) {
                // ëª¨ë‹¬ ë‚´ë¶€ ì»¨í…ì¸ ë¥¼ í´ë¦­í•œ ê²½ìš° ì´ë²¤íŠ¸ ì „íŒŒ ë°©ì§€
                if (e.target.closest('.bg-gray-800')) {
                    e.stopPropagation();
                    return;
                }
                // ëª¨ë‹¬ ë°°ê²½ì„ í´ë¦­í•œ ê²½ìš°ì—ë§Œ ê²Œì„ìœ¼ë¡œ ëŒì•„ê°
                modal.remove();
                showSelectedGameOnly();
                enableBettingSelection();
                enableBettingPoints();
            };
            
            // ëª¨ë‹¬ ë‚´ë¶€ ì»¨í…ì¸  í´ë¦­ ì‹œì—ë„ ê²Œì„ìœ¼ë¡œ ëŒì•„ê°
            const modalContent = modal.querySelector('.bg-gray-800');
            modalContent.onclick = function() {
                modal.remove();
                showSelectedGameOnly();
                enableBettingSelection();
                enableBettingPoints();
            };
        }

        // ê³µí†µ í•¨ìˆ˜ë“¤
        function getKoreanDate() {
            const now = new Date();
            const koreaTime = new Date(now.getTime() + (9 * 60 * 60 * 1000)); // UTC+9
            return koreaTime.getFullYear().toString() +
                   '-' + String(koreaTime.getMonth() + 1).padStart(2, '0') +
                   '-' + String(koreaTime.getDate()).padStart(2, '0');
        }
        
        function calculateWinnings(pointsPerWinner) {
            return 100 + pointsPerWinner; // ì›ê¸ˆ + ìŠ¹ë¦¬ ìˆ˜ë‹¹
        }
        
        function calculateDonation(winningBonus, percentage) {
            return Math.floor(winningBonus * (percentage / 100)); // ìŠ¹ë¦¬ ìˆ˜ë‹¹ì—ì„œë§Œ ê¸°ë¶€ ê³„ì‚°
        }
        
        // ë§¤ì¹˜ì—…ì„ ì¼ë°˜ í…ìŠ¤íŠ¸ë¡œ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
        function getMatchupWithLogos(matchup) {
            return matchup || '';
        }

        // ë°°íŒ… ì„ íƒ ë²„íŠ¼ í™œì„±í™”
        function enableBettingChoices() {
            const betChoiceButtons = document.querySelectorAll('.bet-choice-btn');
            
            if (
                selectedGame &&
                selectedGame.bettingStart === 'ì‹œì‘' &&
                selectedGame.bettingStop === 'ì§„í–‰'
            ) {
                betChoiceButtons.forEach(btn => {
                    btn.disabled = false;
                    btn.classList.remove('opacity-50', 'cursor-not-allowed');
                    btn.classList.add('cursor-pointer');
                    });
                } else {
                betChoiceButtons.forEach(btn => {
                    btn.disabled = true;
                    btn.classList.add('opacity-50', 'cursor-not-allowed');
                    btn.classList.remove('cursor-pointer');
                });
            }
        }


    </script>
</body>
</html> 
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>경기 관리</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body class="bg-black text-white">
    <!-- 상단 네비게이션 -->
    <header class="flex justify-between items-center px-6 py-4 border-b border-gray-700">
        <div class="flex items-center space-x-3">
            <a href="index.html" class="cursor-pointer">
                <img src="/img/logo.png" width="40" height="8" alt="PPADUN 로고">
            </a>
            <span class="text-xs font-bold text-red-200">관리자 페이지</span>
        </div>
        <div class="flex space-x-6">
            <div class="text-center cursor-pointer" onclick="location.href='/'">
                <i class="fas fa-home text-2xl"></i>
                <p class="text-[0.4rem] mt-1">홈</p>
            </div>
        </div>
    </header>

    <!-- 메인 컨테이너 -->
    <main class="p-4">
        <div class="bg-gray-800 max-w-4xl mx-auto p-6 rounded-lg">
            <h2 class="text-xl font-bold mb-6">오늘의 경기 관리</h2>
            
            <!-- 경기 추가 폼 -->
            <div class="mb-8 p-4 bg-gray-700 rounded-lg">
                <h3 class="text-lg font-bold mb-4">새 경기 추가</h3>
                <div class="grid grid-cols-1 md:grid-cols-6 gap-4">
                    <div>
                        <label class="block text-sm font-bold mb-2">경기 번호</label>
                        <select id="gameNumber" class="w-full p-2 rounded bg-gray-600 text-white">
                            <option value="1">1경기</option>
                            <option value="2">2경기</option>
                            <option value="3">3경기</option>
                            <option value="4">4경기</option>
                            <option value="5">5경기</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-2">홈팀</label>
                        <input type="text" id="homeTeam" class="w-full p-2 rounded bg-gray-600 text-white" placeholder="홈팀명">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-2">원정팀</label>
                        <input type="text" id="awayTeam" class="w-full p-2 rounded bg-gray-600 text-white" placeholder="원정팀명">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-2">시작 시간</label>
                        <input type="time" id="startTime" class="w-full p-2 rounded bg-gray-600 text-white">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-2">종료 시간</label>
                        <input type="time" id="endTime" class="w-full p-2 rounded bg-gray-600 text-white">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-2">게임상황</label>
                        <select id="noGame" class="w-full p-2 rounded bg-gray-600 text-white">
                            <option value="정상게임">정상게임</option>
                            <option value="우천취소">우천취소</option>
                            <option value="경기연기">경기연기</option>
                        </select>
                    </div>
                </div>
                <div class="mt-4">
                    <button onclick="addGame()" class="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded">
                        경기 추가
                    </button>
                </div>
            </div>

            <!-- 경기 목록 -->
            <div>
                <h3 class="text-lg font-bold mb-4">오늘의 경기 목록</h3>
                <div id="gamesList" class="space-y-3">
                    <!-- 경기 목록이 여기에 동적으로 추가됨 -->
                </div>
            </div>

            <!-- 배팅 제어 섹션 -->
            <div class="mt-8 p-4 bg-gray-700 rounded-lg">
                <h3 class="text-lg font-bold mb-4">배팅 제어</h3>
                
                <!-- 배팅 상태 표시 -->
                <div id="bettingStatus" class="mb-4 p-3 rounded-lg">
                    <div class="flex items-center space-x-3">
                        <div id="statusIndicator" class="w-4 h-4 rounded-full"></div>
                        <span id="statusText" class="font-bold">배팅 상태 확인 중...</span>
                    </div>
                </div>
                
                <!-- 배팅 제어 버튼 -->
                <div class="flex space-x-4">
                    <button id="startBettingBtn" onclick="startBetting()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-bold flex items-center space-x-2">
                        <i class="fas fa-play"></i>
                        <span>배팅 시작</span>
                    </button>
                    <button id="stopBettingBtn" onclick="stopBetting()" class="bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-lg font-bold flex items-center space-x-2" style="display: none;">
                        <i class="fas fa-stop"></i>
                        <span>배팅 중지</span>
                    </button>
                </div>
                
                <!-- 배팅 통계 -->
                <div id="bettingStats" class="mt-4 p-3 bg-gray-600 rounded-lg" style="display: none;">
                    <h4 class="font-bold mb-2">배팅 통계</h4>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <span class="text-gray-300">총 배팅 수:</span>
                            <span id="totalBets" class="ml-2 font-bold">0</span>
                        </div>
                        <div>
                            <span class="text-gray-300">총 배팅 금액:</span>
                            <span id="totalAmount" class="ml-2 font-bold">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 배팅 결과 입력 섹션 -->
            <div class="mt-8 p-4 bg-gray-700 rounded-lg">
                <h3 class="text-lg font-bold mb-4">배팅 결과 입력</h3>
                
                <!-- 결과 입력 폼 -->
                <div class="mb-4">
                    <label class="block text-sm font-bold mb-2">실제 결과 선택</label>
                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="setResult('1base')" class="result-btn bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded text-sm">
                            1루
                        </button>
                        <button onclick="setResult('2base')" class="result-btn bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded text-sm">
                            2루
                        </button>
                        <button onclick="setResult('3base')" class="result-btn bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded text-sm">
                            3루
                        </button>
                        <button onclick="setResult('homerun')" class="result-btn bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded text-sm">
                            홈런
                        </button>
                        <button onclick="setResult('strikeout')" class="result-btn bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded text-sm">
                            삼진
                        </button>
                        <button onclick="setResult('out')" class="result-btn bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded text-sm">
                            아웃
                        </button>
                    </div>
                </div>
                
                <!-- 선택된 결과 표시 -->
                <div id="selectedResult" class="mb-4 p-3 bg-gray-600 rounded-lg" style="display: none;">
                    <h4 class="font-bold mb-2">선택된 결과</h4>
                    <div class="flex items-center space-x-3">
                        <span id="resultText" class="font-bold text-lg"></span>
                        <button onclick="clearResult()" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">
                            다시 선택
                        </button>
                    </div>
                </div>
                
                <!-- 결과 처리 버튼 -->
                <div class="flex space-x-4">
                    <button id="processResultBtn" onclick="processResult()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-bold flex items-center space-x-2" disabled>
                        <i class="fas fa-trophy"></i>
                        <span>결과 처리</span>
                    </button>
                    <button onclick="viewResults()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-bold flex items-center space-x-2">
                        <i class="fas fa-chart-bar"></i>
                        <span>결과 보기</span>
                    </button>
                </div>
                
                <!-- 결과 통계 -->
                <div id="resultStats" class="mt-4 p-3 bg-gray-600 rounded-lg" style="display: none;">
                    <h4 class="font-bold mb-2">결과 통계</h4>
                    <div class="grid grid-cols-3 gap-4 text-sm">
                        <div>
                            <span class="text-gray-300">승리자 수:</span>
                            <span id="winnerCount" class="ml-2 font-bold">0</span>
                        </div>
                        <div>
                            <span class="text-gray-300">총 배당금:</span>
                            <span id="totalPrize" class="ml-2 font-bold">0</span>
                        </div>
                        <div>
                            <span class="text-gray-300">처리 상태:</span>
                            <span id="processStatus" class="ml-2 font-bold">대기중</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 경기 상황 변경 모달 -->
    <div id="statusModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-gray-800 p-6 rounded-lg max-w-sm w-full mx-4">
            <h3 class="text-lg font-bold mb-4">경기 상황 변경</h3>
            <div class="space-y-3">
                <button onclick="updateGameStatus('정상게임')" class="w-full bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                    정상게임
                </button>
                <button onclick="updateGameStatus('경기중')" class="w-full bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                    경기중
                </button>
                <button onclick="updateGameStatus('우천취소')" class="w-full bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">
                    우천취소
                </button>
                <button onclick="updateGameStatus('경기연기')" class="w-full bg-yellow-500 hover:bg-yellow-600 text-black px-4 py-2 rounded">
                    경기연기
                </button>
                <button onclick="closeStatusModal()" class="w-full bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded">
                    취소
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentGameNumber = null;

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', () => {
            loadGames();
            checkBettingStatus(); // 배팅 상태 확인 추가
            // 배팅 상태 주기적 확인 (0.1초마다 - 실시간)
            setInterval(checkBettingStatus, 100);
        });

        // 배팅 상태 확인 함수
        async function checkBettingStatus() {
            try {
                const today = new Date().toISOString().split('T')[0].replace(/-/g, '');
                const response = await fetch(`/api/betting/admin-status?date=${today}`);
                const data = await response.json();
                
                updateBettingStatusUI(data.isActive);
                updateBettingStats(data.stats);
            } catch (error) {
                console.error('배팅 상태 확인 오류:', error);
                updateBettingStatusUI(false);
            }
        }

        // 배팅 상태 UI 업데이트
        function updateBettingStatusUI(isActive) {
            const statusIndicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            const startBtn = document.getElementById('startBettingBtn');
            const stopBtn = document.getElementById('stopBettingBtn');
            
            if (isActive) {
                // 배팅 활성화 상태
                statusIndicator.className = 'w-4 h-4 rounded-full bg-green-500';
                statusText.textContent = '배팅 활성화됨';
                statusText.className = 'font-bold text-green-400';
                startBtn.style.display = 'none';
                stopBtn.style.display = 'inline-flex';
            } else {
                // 배팅 비활성화 상태
                statusIndicator.className = 'w-4 h-4 rounded-full bg-red-500';
                statusText.textContent = '배팅 비활성화됨';
                statusText.className = 'font-bold text-red-400';
                startBtn.style.display = 'inline-flex';
                stopBtn.style.display = 'none';
            }
        }

        // 배팅 통계 업데이트
        function updateBettingStats(stats) {
            const statsDiv = document.getElementById('bettingStats');
            const totalBets = document.getElementById('totalBets');
            const totalAmount = document.getElementById('totalAmount');
            
            if (stats && (stats.totalBets > 0 || stats.totalAmount > 0)) {
                statsDiv.style.display = 'block';
                totalBets.textContent = stats.totalBets || 0;
                totalAmount.textContent = `${stats.totalAmount || 0}포인트`;
            } else {
                statsDiv.style.display = 'none';
            }
        }

        // 배팅 시작 함수
        async function startBetting() {
            try {
                const today = new Date().toISOString().split('T')[0].replace(/-/g, '');
                const response = await fetch('/api/betting/admin-start', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        date: today,
                        gameNumber: 1 // 기본값, 필요시 수정
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('배팅이 시작되었습니다!');
                    checkBettingStatus(); // 상태 즉시 업데이트
                } else {
                    alert('배팅 시작 실패: ' + data.message);
                }
            } catch (error) {
                console.error('배팅 시작 오류:', error);
                alert('배팅 시작 중 오류가 발생했습니다.');
            }
        }

        // 배팅 중지 함수
        async function stopBetting() {
            try {
                const today = new Date().toISOString().split('T')[0].replace(/-/g, '');
                const response = await fetch('/api/betting/admin-stop', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        date: today,
                        gameNumber: 1 // 기본값, 필요시 수정
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('배팅이 중지되었습니다!');
                    checkBettingStatus(); // 상태 즉시 업데이트
                } else {
                    alert('배팅 중지 실패: ' + data.message);
                }
            } catch (error) {
                console.error('배팅 중지 오류:', error);
                alert('배팅 중지 중 오류가 발생했습니다.');
            }
        }

        // 결과 선택 함수
        let selectedResult = null;
        
        function setResult(result) {
            selectedResult = result;
            
            // 모든 결과 버튼 비활성화
            document.querySelectorAll('.result-btn').forEach(btn => {
                btn.classList.remove('bg-blue-500');
                btn.classList.add('bg-gray-600');
            });
            
            // 선택된 버튼 활성화
            event.target.classList.remove('bg-gray-600');
            btn.classList.add('bg-blue-500');
            
            // 선택된 결과 표시
            const resultText = document.getElementById('resultText');
            const resultLabels = {
                '1base': '1루',
                '2base': '2루', 
                '3base': '3루',
                'homerun': '홈런',
                'strikeout': '삼진',
                'out': '아웃'
            };
            
            resultText.textContent = resultLabels[result];
            document.getElementById('selectedResult').style.display = 'block';
            
            // 결과 처리 버튼 활성화
            document.getElementById('processResultBtn').disabled = false;
        }
        
        // 결과 초기화 함수
        function clearResult() {
            selectedResult = null;
            
            // 모든 결과 버튼 초기화
            document.querySelectorAll('.result-btn').forEach(btn => {
                btn.classList.remove('bg-blue-500');
                btn.classList.add('bg-gray-600');
            });
            
            // 선택된 결과 숨기기
            document.getElementById('selectedResult').style.display = 'none';
            
            // 결과 처리 버튼 비활성화
            document.getElementById('processResultBtn').disabled = true;
        }
        
        // 결과 처리 함수
        async function processResult() {
            if (!selectedResult) {
                alert('결과를 선택해주세요.');
                return;
            }
            
            try {
                const today = new Date().toISOString().split('T')[0].replace(/-/g, '');
                const response = await fetch('/api/betting/process-result', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        date: today,
                        gameNumber: 1,
                        result: selectedResult
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('결과가 처리되었습니다!');
                    clearResult();
                    updateResultStats(data.stats);
                } else {
                    alert('결과 처리 실패: ' + data.message);
                }
            } catch (error) {
                console.error('결과 처리 오류:', error);
                alert('결과 처리 중 오류가 발생했습니다.');
            }
        }
        
        // 결과 보기 함수
        async function viewResults() {
            try {
                const today = new Date().toISOString().split('T')[0].replace(/-/g, '');
                const response = await fetch(`/api/betting/results?date=${today}&gameNumber=1`);
                const data = await response.json();
                
                if (data.success) {
                    updateResultStats(data.stats);
                    alert(`결과 조회 완료!\n승리자: ${data.stats.winnerCount}명\n총 배당금: ${data.stats.totalPrize}포인트`);
                } else {
                    alert('결과 조회 실패: ' + data.message);
                }
            } catch (error) {
                console.error('결과 조회 오류:', error);
                alert('결과 조회 중 오류가 발생했습니다.');
            }
        }
        
        // 결과 통계 업데이트 함수
        function updateResultStats(stats) {
            const resultStats = document.getElementById('resultStats');
            const winnerCount = document.getElementById('winnerCount');
            const totalPrize = document.getElementById('totalPrize');
            const processStatus = document.getElementById('processStatus');
            
            if (stats) {
                resultStats.style.display = 'block';
                winnerCount.textContent = stats.winnerCount || 0;
                totalPrize.textContent = `${stats.totalPrize || 0}포인트`;
                processStatus.textContent = stats.isProcessed ? '완료' : '대기중';
                processStatus.className = stats.isProcessed ? 'ml-2 font-bold text-green-400' : 'ml-2 font-bold text-yellow-400';
            } else {
                resultStats.style.display = 'none';
            }
        }

        // 경기 목록 로드
        async function loadGames() {
            const gamesList = document.getElementById('gamesList');
            
            try {
                // 로딩 상태 표시
                gamesList.innerHTML = '<div class="text-center text-gray-400 py-4">경기 정보를 불러오는 중...</div>';
                
                const response = await fetch('/api/daily-games');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                gamesList.innerHTML = '';
                
                if (data.games && data.games.length > 0) {
                    // 전체 경기 상태 확인
                    const allGamesBeforeStart = checkAllGamesStatus(data.games);
                    
                    // 전체 경기 상태 알림 표시
                    if (allGamesBeforeStart) {
                        const statusAlert = document.createElement('div');
                        statusAlert.className = 'mb-4 p-4 border border-blue-500 bg-blue-900 bg-opacity-20 rounded-lg';
                        statusAlert.innerHTML = `
                            <div class="flex items-center space-x-3">
                                <div class="text-blue-400">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <div class="text-blue-200 font-bold">아직 경기전입니다.</div>
                                    <div class="text-blue-300 text-sm">1경기부터 5경기 중 하나라도 경기중이 없습니다.</div>
                                </div>
                            </div>
                        `;
                        gamesList.appendChild(statusAlert);
                    }
                    
                    data.games.forEach(game => {
                        const gameItem = document.createElement('div');
                        gameItem.className = `border rounded-lg p-4 ${getGameStatusClass(game.noGame)}`;
                        
                        const statusText = getStatusText(game.noGame);
                        
                        gameItem.innerHTML = `
                            <div class="flex justify-between items-center">
                                <div class="flex-1">
                                    <div class="text-lg font-bold">${game.homeTeam} vs ${game.awayTeam}</div>
                                    <div class="text-sm text-gray-400">경기 ${game.number} • ${getStatusText(game.noGame)}</div>
                                    <div class="text-xs text-gray-500">상태: ${statusText}</div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <button onclick="openStatusModal(${game.number})" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm">
                                        상황 변경
                                    </button>
                                    <button onclick="deleteGame(${game.number})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">
                                        삭제
                                    </button>
                                </div>
                            </div>
                        `;
                        gamesList.appendChild(gameItem);
                    });
                } else {
                    gamesList.innerHTML = '<div class="text-center text-gray-400 py-4">오늘의 경기가 없습니다.</div>';
                }
            } catch (error) {
                console.error('경기 정보 로드 중 오류:', error);
                gamesList.innerHTML = `
                    <div class="text-center text-red-400 py-4">
                        <p>경기 정보를 불러오는 중 오류가 발생했습니다.</p>
                        <p class="text-xs mt-2">${error.message}</p>
                        <button onclick="loadGames()" class="mt-2 px-4 py-2 bg-blue-500 rounded hover:bg-blue-600">
                            다시 시도
                        </button>
                    </div>
                `;
            }
        }

        // 경기 상태에 따른 CSS 클래스 반환
        function getGameStatusClass(noGame) {
            switch (noGame) {
                case '정상게임':
                    return 'border-green-500 bg-green-900 bg-opacity-20';
                case '경기중':
                    return 'border-blue-500 bg-blue-900 bg-opacity-20';
                case '우천취소':
                    return 'border-red-500 bg-red-900 bg-opacity-20';
                case '경기연기':
                    return 'border-yellow-500 bg-yellow-900 bg-opacity-20';
                default:
                    return 'border-gray-600 bg-gray-700';
            }
        }

        // 경기 상태 텍스트 반환
        function getStatusText(noGame) {
            switch (noGame) {
                case '정상게임':
                    return '경기전';
                case '경기중':
                    return '경기중';
                case '경기끝':
                    return '경기 끝';
                case '우천취소':
                    return '우천취소';
                case '경기연기':
                    return '경기연기';
                default:
                    return noGame || '알 수 없음';
            }
        }

        // 전체 경기 상태 확인 함수 (1경기부터 5경기 중 하나라도 경기중이 없으면 true)
        function checkAllGamesStatus(games) {
            if (!games || games.length === 0) {
                return true; // 경기가 없으면 경기전으로 간주
            }
            
            // 1경기부터 5경기까지 확인
            for (let i = 1; i <= 5; i++) {
                const game = games.find(g => g.number === i);
                if (game) {
                    const status = getStatusText(game.noGame);
                    if (status.includes('경기중')) {
                        return false; // 하나라도 경기중이 있으면 false
                    }
                }
            }
            return true; // 모든 경기가 경기중이 아니면 true
        }

        // 경기 추가
        async function addGame() {
            const gameNumber = document.getElementById('gameNumber').value;
            const homeTeam = document.getElementById('homeTeam').value;
            const awayTeam = document.getElementById('awayTeam').value;
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            const noGame = document.getElementById('noGame').value;
            
            if (!homeTeam || !awayTeam || !startTime || !endTime || !noGame) {
                alert('모든 필드를 입력해주세요.');
                return;
            }
            
            // 한국 시간대로 오늘 날짜 계산
            const today = new Date();
            const koreaTime = new Date(today.getTime() + (9 * 60 * 60 * 1000)); // UTC+9
            const todayString = koreaTime.getFullYear().toString() + 
                               String(koreaTime.getMonth() + 1).padStart(2, '0') + 
                               String(koreaTime.getDate()).padStart(2, '0');
            
            console.log('📅 관리자 페이지 - 오늘 날짜:', todayString);
            console.log('📅 관리자 페이지 - 원본 날짜:', today.toISOString());
            console.log('📅 관리자 페이지 - 한국 시간:', koreaTime.toISOString());
            
            try {
                const response = await fetch('/api/daily-games', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        number: parseInt(gameNumber),
                        homeTeam,
                        awayTeam,
                        date: todayString,
                        startTime,
                        endTime,
                        noGame,
                        isActive: true
                    })
                });
                
                const data = await response.json();
                
                if (data.message) {
                    alert('경기가 추가되었습니다.');
                    // 폼 초기화
                    document.getElementById('homeTeam').value = '';
                    document.getElementById('awayTeam').value = '';
                    document.getElementById('startTime').value = '';
                    document.getElementById('endTime').value = '';
                    document.getElementById('noGame').value = '정상게임';
                    // 경기 목록 새로고침
                    loadGames();
                } else {
                    alert(data.error || '경기 추가에 실패했습니다.');
                }
            } catch (error) {
                console.error('경기 추가 오류:', error);
                alert('경기 추가 중 오류가 발생했습니다.');
            }
        }

        // 상태 변경 모달 열기
        function openStatusModal(gameNumber) {
            currentGameNumber = gameNumber;
            document.getElementById('statusModal').style.display = 'flex';
        }

        // 상태 변경 모달 닫기
        function closeStatusModal() {
            document.getElementById('statusModal').style.display = 'none';
            currentGameNumber = null;
        }

        // 경기 상황 업데이트
        async function updateGameStatus(noGame) {
            if (!currentGameNumber) {
                alert('경기 번호가 없습니다.');
                return;
            }
            
            try {
                const response = await fetch(`/api/daily-games/${currentGameNumber}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ noGame })
                });
                
                const data = await response.json();
                
                if (data.message) {
                    alert('경기 상황이 업데이트되었습니다.');
                    closeStatusModal();
                    loadGames();
                } else {
                    alert(data.error || '상황 업데이트에 실패했습니다.');
                }
            } catch (error) {
                console.error('상황 업데이트 오류:', error);
                alert('상황 업데이트 중 오류가 발생했습니다.');
            }
        }

        // 경기 삭제
        async function deleteGame(gameNumber) {
            if (!confirm(`경기 ${gameNumber}을(를) 삭제하시겠습니까?`)) {
                return;
            }
            
            try {
                const response = await fetch(`/api/daily-games/${gameNumber}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('경기가 삭제되었습니다.');
                    loadGames();
                } else {
                    const data = await response.json();
                    alert(data.error || '경기 삭제에 실패했습니다.');
                }
            } catch (error) {
                console.error('경기 삭제 오류:', error);
                alert('경기 삭제 중 오류가 발생했습니다.');
            }
        }
    </script>
</body>
</html> 
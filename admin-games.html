<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²½ê¸° ê´€ë¦¬</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body class="bg-black text-white">
    <!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
    <header class="flex justify-between items-center px-6 py-4 border-b border-gray-700">
        <div class="flex items-center space-x-3">
            <a href="index.html" class="cursor-pointer">
                <img src="/img/logo.png" width="40" height="8" alt="PPADUN ë¡œê³ ">
            </a>
            <span class="text-xs font-bold text-red-200">ê´€ë¦¬ì í˜ì´ì§€</span>
        </div>
        <div class="flex space-x-6">
            <div class="text-center cursor-pointer" onclick="location.href='/'">
                <i class="fas fa-home text-2xl"></i>
                <p class="text-[0.4rem] mt-1">í™ˆ</p>
            </div>
        </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <main class="p-4">
        <div class="bg-gray-800 max-w-4xl mx-auto p-6 rounded-lg">
            <h2 class="text-xl font-bold mb-6">ì˜¤ëŠ˜ì˜ ê²½ê¸° ê´€ë¦¬</h2>
            
            <!-- ê²½ê¸° ì¶”ê°€ í¼ -->
            <div class="mb-8 p-4 bg-gray-700 rounded-lg">
                <h3 class="text-lg font-bold mb-4">ìƒˆ ê²½ê¸° ì¶”ê°€</h3>
                <div class="grid grid-cols-1 md:grid-cols-6 gap-4">
                    <div>
                        <label class="block text-sm font-bold mb-2">ê²½ê¸° ë²ˆí˜¸</label>
                        <select id="gameNumber" class="w-full p-2 rounded bg-gray-600 text-white">
                            <option value="1">1ê²½ê¸°</option>
                            <option value="2">2ê²½ê¸°</option>
                            <option value="3">3ê²½ê¸°</option>
                            <option value="4">4ê²½ê¸°</option>
                            <option value="5">5ê²½ê¸°</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-2">í™ˆíŒ€</label>
                        <input type="text" id="homeTeam" class="w-full p-2 rounded bg-gray-600 text-white" placeholder="í™ˆíŒ€ëª…">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-2">ì›ì •íŒ€</label>
                        <input type="text" id="awayTeam" class="w-full p-2 rounded bg-gray-600 text-white" placeholder="ì›ì •íŒ€ëª…">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-2">ì‹œì‘ ì‹œê°„</label>
                        <input type="time" id="startTime" class="w-full p-2 rounded bg-gray-600 text-white">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-2">ì¢…ë£Œ ì‹œê°„</label>
                        <input type="time" id="endTime" class="w-full p-2 rounded bg-gray-600 text-white">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-2">ê²Œì„ìƒí™©</label>
                        <select id="noGame" class="w-full p-2 rounded bg-gray-600 text-white">
                            <option value="ì •ìƒê²Œì„">ì •ìƒê²Œì„</option>
                            <option value="ìš°ì²œì·¨ì†Œ">ìš°ì²œì·¨ì†Œ</option>
                            <option value="ê²½ê¸°ì—°ê¸°">ê²½ê¸°ì—°ê¸°</option>
                        </select>
                    </div>
                </div>
                <div class="mt-4">
                    <button onclick="addGame()" class="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded">
                        ê²½ê¸° ì¶”ê°€
                    </button>
                </div>
            </div>

            <!-- ê²½ê¸° ëª©ë¡ -->
            <div>
                <h3 class="text-lg font-bold mb-4">ì˜¤ëŠ˜ì˜ ê²½ê¸° ëª©ë¡</h3>
                <div id="gamesList" class="space-y-3">
                    <!-- ê²½ê¸° ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
                </div>
            </div>
        </div>
    </main>

    <!-- ê²½ê¸° ìƒí™© ë³€ê²½ ëª¨ë‹¬ -->
    <div id="statusModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-gray-800 p-6 rounded-lg max-w-sm w-full mx-4">
            <h3 class="text-lg font-bold mb-4">ê²½ê¸° ìƒí™© ë³€ê²½</h3>
            <div class="space-y-3">
                <button onclick="updateGameStatus('ì •ìƒê²Œì„')" class="w-full bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                    ì •ìƒê²Œì„
                </button>
                <button onclick="updateGameStatus('ê²½ê¸°ì¤‘')" class="w-full bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                    ê²½ê¸°ì¤‘
                </button>
                <button onclick="updateGameStatus('ìš°ì²œì·¨ì†Œ')" class="w-full bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">
                    ìš°ì²œì·¨ì†Œ
                </button>
                <button onclick="updateGameStatus('ê²½ê¸°ì—°ê¸°')" class="w-full bg-yellow-500 hover:bg-yellow-600 text-black px-4 py-2 rounded">
                    ê²½ê¸°ì—°ê¸°
                </button>
                <button onclick="closeStatusModal()" class="w-full bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded">
                    ì·¨ì†Œ
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentGameNumber = null;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            loadGames();
        });

        // ê²½ê¸° ëª©ë¡ ë¡œë“œ
        async function loadGames() {
            const gamesList = document.getElementById('gamesList');
            
            try {
                // ë¡œë”© ìƒíƒœ í‘œì‹œ
                gamesList.innerHTML = '<div class="text-center text-gray-400 py-4">ê²½ê¸° ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
                
                const response = await fetch('/api/daily-games');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                gamesList.innerHTML = '';
                
                if (data.games && data.games.length > 0) {
                    // ì „ì²´ ê²½ê¸° ìƒíƒœ í™•ì¸
                    const allGamesBeforeStart = checkAllGamesStatus(data.games);
                    
                    // ì „ì²´ ê²½ê¸° ìƒíƒœ ì•Œë¦¼ í‘œì‹œ
                    if (allGamesBeforeStart) {
                        const statusAlert = document.createElement('div');
                        statusAlert.className = 'mb-4 p-4 border border-blue-500 bg-blue-900 bg-opacity-20 rounded-lg';
                        statusAlert.innerHTML = `
                            <div class="flex items-center space-x-3">
                                <div class="text-blue-400">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <div class="text-blue-200 font-bold">ì•„ì§ ê²½ê¸°ì „ì…ë‹ˆë‹¤.</div>
                                    <div class="text-blue-300 text-sm">1ê²½ê¸°ë¶€í„° 5ê²½ê¸° ì¤‘ í•˜ë‚˜ë¼ë„ ê²½ê¸°ì¤‘ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                                </div>
                            </div>
                        `;
                        gamesList.appendChild(statusAlert);
                    }
                    
                    data.games.forEach(game => {
                        const gameItem = document.createElement('div');
                        gameItem.className = `border rounded-lg p-4 ${getGameStatusClass(game.noGame)}`;
                        
                        const statusText = getStatusText(game.noGame);
                        
                        gameItem.innerHTML = `
                            <div class="flex justify-between items-center">
                                <div class="flex-1">
                                    <div class="text-lg font-bold">${game.homeTeam} vs ${game.awayTeam}</div>
                                    <div class="text-sm text-gray-400">ê²½ê¸° ${game.number} â€¢ ${getStatusText(game.noGame)}</div>
                                    <div class="text-xs text-gray-500">ìƒíƒœ: ${statusText}</div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <button onclick="openStatusModal(${game.number})" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm">
                                        ìƒí™© ë³€ê²½
                                    </button>
                                    <button onclick="deleteGame(${game.number})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">
                                        ì‚­ì œ
                                    </button>
                                </div>
                            </div>
                        `;
                        gamesList.appendChild(gameItem);
                    });
                } else {
                    gamesList.innerHTML = '<div class="text-center text-gray-400 py-4">ì˜¤ëŠ˜ì˜ ê²½ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                }
            } catch (error) {
                console.error('ê²½ê¸° ì •ë³´ ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
                gamesList.innerHTML = `
                    <div class="text-center text-red-400 py-4">
                        <p>ê²½ê¸° ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
                        <p class="text-xs mt-2">${error.message}</p>
                        <button onclick="loadGames()" class="mt-2 px-4 py-2 bg-blue-500 rounded hover:bg-blue-600">
                            ë‹¤ì‹œ ì‹œë„
                        </button>
                    </div>
                `;
            }
        }

        // ê²½ê¸° ìƒíƒœì— ë”°ë¥¸ CSS í´ë˜ìŠ¤ ë°˜í™˜
        function getGameStatusClass(noGame) {
            switch (noGame) {
                case 'ì •ìƒê²Œì„':
                    return 'border-green-500 bg-green-900 bg-opacity-20';
                case 'ê²½ê¸°ì¤‘':
                    return 'border-blue-500 bg-blue-900 bg-opacity-20';
                case 'ìš°ì²œì·¨ì†Œ':
                    return 'border-red-500 bg-red-900 bg-opacity-20';
                case 'ê²½ê¸°ì—°ê¸°':
                    return 'border-yellow-500 bg-yellow-900 bg-opacity-20';
                default:
                    return 'border-gray-600 bg-gray-700';
            }
        }

        // ê²½ê¸° ìƒíƒœ í…ìŠ¤íŠ¸ ë°˜í™˜
        function getStatusText(noGame) {
            switch (noGame) {
                case 'ì •ìƒê²Œì„':
                    return 'ê²½ê¸°ì „';
                case 'ê²½ê¸°ì¤‘':
                    return 'ê²½ê¸°ì¤‘';
                case 'ê²½ê¸°ë':
                    return 'ê²½ê¸° ë';
                case 'ìš°ì²œì·¨ì†Œ':
                    return 'ìš°ì²œì·¨ì†Œ';
                case 'ê²½ê¸°ì—°ê¸°':
                    return 'ê²½ê¸°ì—°ê¸°';
                default:
                    return noGame || 'ì•Œ ìˆ˜ ì—†ìŒ';
            }
        }

        // ì „ì²´ ê²½ê¸° ìƒíƒœ í™•ì¸ í•¨ìˆ˜ (1ê²½ê¸°ë¶€í„° 5ê²½ê¸° ì¤‘ í•˜ë‚˜ë¼ë„ ê²½ê¸°ì¤‘ì´ ì—†ìœ¼ë©´ true)
        function checkAllGamesStatus(games) {
            if (!games || games.length === 0) {
                return true; // ê²½ê¸°ê°€ ì—†ìœ¼ë©´ ê²½ê¸°ì „ìœ¼ë¡œ ê°„ì£¼
            }
            
            // 1ê²½ê¸°ë¶€í„° 5ê²½ê¸°ê¹Œì§€ í™•ì¸
            for (let i = 1; i <= 5; i++) {
                const game = games.find(g => g.number === i);
                if (game) {
                    const status = getStatusText(game.noGame);
                    if (status.includes('ê²½ê¸°ì¤‘')) {
                        return false; // í•˜ë‚˜ë¼ë„ ê²½ê¸°ì¤‘ì´ ìˆìœ¼ë©´ false
                    }
                }
            }
            return true; // ëª¨ë“  ê²½ê¸°ê°€ ê²½ê¸°ì¤‘ì´ ì•„ë‹ˆë©´ true
        }

        // ê²½ê¸° ì¶”ê°€
        async function addGame() {
            const gameNumber = document.getElementById('gameNumber').value;
            const homeTeam = document.getElementById('homeTeam').value;
            const awayTeam = document.getElementById('awayTeam').value;
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            const noGame = document.getElementById('noGame').value;
            
            if (!homeTeam || !awayTeam || !startTime || !endTime || !noGame) {
                alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // í•œêµ­ ì‹œê°„ëŒ€ë¡œ ì˜¤ëŠ˜ ë‚ ì§œ ê³„ì‚°
            const today = new Date();
            const koreaTime = new Date(today.getTime() + (9 * 60 * 60 * 1000)); // UTC+9
            const todayString = koreaTime.getFullYear().toString() + 
                               String(koreaTime.getMonth() + 1).padStart(2, '0') + 
                               String(koreaTime.getDate()).padStart(2, '0');
            
            console.log('ğŸ“… ê´€ë¦¬ì í˜ì´ì§€ - ì˜¤ëŠ˜ ë‚ ì§œ:', todayString);
            console.log('ğŸ“… ê´€ë¦¬ì í˜ì´ì§€ - ì›ë³¸ ë‚ ì§œ:', today.toISOString());
            console.log('ğŸ“… ê´€ë¦¬ì í˜ì´ì§€ - í•œêµ­ ì‹œê°„:', koreaTime.toISOString());
            
            try {
                const response = await fetch('/api/daily-games', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        number: parseInt(gameNumber),
                        homeTeam,
                        awayTeam,
                        date: todayString,
                        startTime,
                        endTime,
                        noGame,
                        isActive: true
                    })
                });
                
                const data = await response.json();
                
                if (data.message) {
                    alert('ê²½ê¸°ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    // í¼ ì´ˆê¸°í™”
                    document.getElementById('homeTeam').value = '';
                    document.getElementById('awayTeam').value = '';
                    document.getElementById('startTime').value = '';
                    document.getElementById('endTime').value = '';
                    document.getElementById('noGame').value = 'ì •ìƒê²Œì„';
                    // ê²½ê¸° ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    loadGames();
                } else {
                    alert(data.error || 'ê²½ê¸° ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ê²½ê¸° ì¶”ê°€ ì˜¤ë¥˜:', error);
                alert('ê²½ê¸° ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ìƒíƒœ ë³€ê²½ ëª¨ë‹¬ ì—´ê¸°
        function openStatusModal(gameNumber) {
            currentGameNumber = gameNumber;
            document.getElementById('statusModal').style.display = 'flex';
        }

        // ìƒíƒœ ë³€ê²½ ëª¨ë‹¬ ë‹«ê¸°
        function closeStatusModal() {
            document.getElementById('statusModal').style.display = 'none';
            currentGameNumber = null;
        }

        // ê²½ê¸° ìƒí™© ì—…ë°ì´íŠ¸
        async function updateGameStatus(noGame) {
            if (!currentGameNumber) {
                alert('ê²½ê¸° ë²ˆí˜¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            try {
                const response = await fetch(`/api/daily-games/${currentGameNumber}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ noGame })
                });
                
                const data = await response.json();
                
                if (data.message) {
                    alert('ê²½ê¸° ìƒí™©ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    closeStatusModal();
                    loadGames();
                } else {
                    alert(data.error || 'ìƒí™© ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ìƒí™© ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
                alert('ìƒí™© ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ê²½ê¸° ì‚­ì œ
        async function deleteGame(gameNumber) {
            if (!confirm(`ê²½ê¸° ${gameNumber}ì„(ë¥¼) ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            try {
                const response = await fetch(`/api/daily-games/${gameNumber}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('ê²½ê¸°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    loadGames();
                } else {
                    const data = await response.json();
                    alert(data.error || 'ê²½ê¸° ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ê²½ê¸° ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('ê²½ê¸° ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
    </script>
</body>
</html> 